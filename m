Return-Path: <iommu-bounces@lists.linux-foundation.org>
X-Original-To: lists.iommu@lfdr.de
Delivered-To: lists.iommu@lfdr.de
Received: from mail.linuxfoundation.org (mail.linuxfoundation.org [140.211.169.12])
	by mail.lfdr.de (Postfix) with ESMTPS id B82CEE7010
	for <lists.iommu@lfdr.de>; Mon, 28 Oct 2019 11:59:12 +0100 (CET)
Received: from mail.linux-foundation.org (localhost [127.0.0.1])
	by mail.linuxfoundation.org (Postfix) with ESMTP id 89EEE10C0;
	Mon, 28 Oct 2019 10:59:08 +0000 (UTC)
X-Original-To: iommu@lists.linux-foundation.org
Delivered-To: iommu@mail.linuxfoundation.org
Received: from smtp1.linuxfoundation.org (smtp1.linux-foundation.org
	[172.17.192.35])
	by mail.linuxfoundation.org (Postfix) with ESMTPS id A29E010B9
	for <iommu@lists.linux-foundation.org>;
	Mon, 28 Oct 2019 10:59:07 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
	by smtp1.linuxfoundation.org (Postfix) with ESMTP id EAD9514D
	for <iommu@lists.linux-foundation.org>;
	Mon, 28 Oct 2019 10:59:06 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
	by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 588041F1;
	Mon, 28 Oct 2019 03:59:06 -0700 (PDT)
Received: from [10.1.31.199] (e121487-lin.cambridge.arm.com [10.1.31.199])
	by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id C3A1F3F71E;
	Mon, 28 Oct 2019 03:59:04 -0700 (PDT)
Subject: Re: [BUG] dma-ranges, reserved memory regions, dma_alloc_coherent:
	possible bug?
To: Alexandre Torgue <alexandre.torgue@st.com>,
	Robin Murphy <robin.murphy@arm.com>,
	Daniele Alessandrelli <daniele.alessandrelli@gmail.com>,
	Christoph Hellwig <hch@lst.de>, Marek Szyprowski <m.szyprowski@samsung.com>
References: <CAA2QUqLv+eLXuA_TdJ7zM4oBnGoFVOjRjAimuct2y=0MDuaZVQ@mail.gmail.com>
	<d983cf57-f13d-a680-21c4-09b5ca93bc64@arm.com>
	<acf0dd2c-7e12-fba6-b7f8-dfd78c892fe5@arm.com>
	<417fa080-08f9-9f35-687b-c0b82a61628d@arm.com>
	<376133e3-25f2-ffe7-ef9f-4613388b2bf7@arm.com>
	<84747008-85e9-e71a-b9ad-cefcc6c0f661@st.com>
	<3305c91e-e630-b7fd-4c6f-598583504d67@arm.com>
	<6b024e69-f612-6850-8a04-9b3049549092@st.com>
From: Vladimir Murzin <vladimir.murzin@arm.com>
Message-ID: <2153b504-8c98-6c43-6ae3-9fb355d88417@arm.com>
Date: Mon, 28 Oct 2019 10:59:03 +0000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <6b024e69-f612-6850-8a04-9b3049549092@st.com>
Content-Language: en-US
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	smtp1.linux-foundation.org
Cc: iommu@lists.linux-foundation.org, Arnd Bergmann <arnd@arndb.de>
X-BeenThere: iommu@lists.linux-foundation.org
X-Mailman-Version: 2.1.12
Precedence: list
List-Id: Development issues for Linux IOMMU support
	<iommu.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/iommu>,
	<mailto:iommu-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/iommu/>
List-Post: <mailto:iommu@lists.linux-foundation.org>
List-Help: <mailto:iommu-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/iommu>,
	<mailto:iommu-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: iommu-bounces@lists.linux-foundation.org
Errors-To: iommu-bounces@lists.linux-foundation.org

T24gMTAvMjgvMTkgMTA6NTUgQU0sIEFsZXhhbmRyZSBUb3JndWUgd3JvdGU6Cj4gSGkgVmxhZCwK
PiAKPiBPbiAxMC8yNC8xOSA1OjI3IFBNLCBWbGFkaW1pciBNdXJ6aW4gd3JvdGU6Cj4+IEhpIEFs
ZXgsCj4+Cj4+IE9uIDEwLzI0LzE5IDQ6MjAgUE0sIEFsZXhhbmRyZSBUb3JndWUgd3JvdGU6Cj4+
PiBIaSBWbGFkLAo+Pj4KPj4+IE9uIDEwLzI0LzE5IDI6NDMgUE0sIFZsYWRpbWlyIE11cnppbiB3
cm90ZToKPj4+PiBPbiAxMC8xNy8xOSAxMDo0NiBBTSwgVmxhZGltaXIgTXVyemluIHdyb3RlOgo+
Pj4+PiBJJ20gd29uZGVyaW5nIGlmIEkndmUgbWlzc2VkIHNvbWV0aGluZyB3aXRoIGRpZmYgYmVs
bG93IChpdCB3YXMgYSBsb25nIHRpbWUgYWdvIHdoZW4gSSB0b3VjaGVkIERNQSk/Cj4+Pj4KPj4+
PiBBbnkgY29tbWVudHMgb24gdGhhdD8gSSBjYW4gb25seSBidWlsZCB0ZXN0IGl0LCBzbyBsYWNr
IG9mIHRlc3Rpbmcgc3RvcHBpbmcgbWUgZnJvbSBzZW5kaW5nIGl0IGFzIGEKPj4+PiBwcm9wZXIg
cGF0Y2ggOigKPj4+Cj4+PiBJIGNhbiBtYWtlIHNvbWUgdGVzdHMgdG9tb3Jyb3cuIFdoaWNoIHBh
cnRpY3VsYXIgc2V0dXAgSSBuZWVkIHRvIHRlc3Q6IGNvcnRleCBNNyArIGNhY2hlICsgZG1hICsg
eGlwID8gTGV0IG1lIGtub3cuCj4+Cj4+IEkgYXNzdW1lIHhpcCBpbXBsaWVzIGRtYS1yYW5nZXMg
aW4gZHQsIHRoZW4geWVzIGl0IGxvb2tzIGxpa2Ugd2hhdCB3ZSBuZWVkLgo+Pgo+IAo+IEkgdGVz
dGVkIHlvdXIgcGF0Y2ggb24gc3RtMzJoNzQzMS1ldmFsIGJvYXJkIChjb3J0ZXgtTTcpLiBObyBp
c3N1ZXMgcmVwb3J0ZWQuIEkgdXNlIHJlc2VydmVkIGRtYSBtZW1vcnkgcG9vbCBmb3IgZG1hIGFj
Y2VzcyAoIERjYWNoZSBkaXNhYmxlZCkgYW5kIGRtYV9hbGxvY19jb2hlcmVudCBpcyBvay4gTm90
ZSB0aGVyZSBpcyBubyAiZG1hLXJhbmdlcyIgZm9yIHRoaXMgYm9hcmQuCj4gCj4gSSBhbHNvIHRl
c3RlZCBpdCBvbiBzdG0zMmY0NjktZGlzY28gKGNvcnRleC1NNCkgd2hpY2ggdXNlcyBkbWEtcmFu
Z2VzLiBObyBpc3N1ZXMgcmVwb3J0ZWQgdG9vLiBOb3RlIHRoZXJlIGlzIG5vIGRhdGEgY2FjaGUg
YXQgYWxsIGluIHRoaXMgY2FzZS4KCkhhcHB5IHRvIGhlYXIgaXQgZG9lc24ndCBpbnRyb2R1Y2Ug
cmVncmVzc2lvbiBmb3IgTk9NTSAtIHRoYW5rcyBnb3QgZ2l2aW5nIGl0IGEgdHJ5IQoKQERhbmll
bGUsIGl0J2QgYmUgaGFuZHkgdG8ga25vdyBpZiB0aGF0IGZpeCBpc3N1ZSBmb3IgeW91Li4uCgpD
aGVlcnMKVmxhZGltaXIKCj4gCj4gcmVnYXJkcwo+IAo+IEFsZXgKPiAKPj4gR3JlYXQgdGhhbmtz
IQo+Pgo+PiBWbGFkaW1pcgo+Pgo+Pj4KPj4+IHJlZ2FyZHMKPj4+IGFsZXgKPj4+Cj4+Pj4KPj4+
Pj4KPj4+Pj4gZGlmZiAtLWdpdCBhL2FyY2gvYXJtL21tL2RtYS1tYXBwaW5nLW5vbW11LmMgYi9h
cmNoL2FybS9tbS9kbWEtbWFwcGluZy1ub21tdS5jCj4+Pj4+IGluZGV4IGRiOTI0NzguLjI4N2Vm
ODkgMTAwNjQ0Cj4+Pj4+IC0tLSBhL2FyY2gvYXJtL21tL2RtYS1tYXBwaW5nLW5vbW11LmMKPj4+
Pj4gKysrIGIvYXJjaC9hcm0vbW0vZG1hLW1hcHBpbmctbm9tbXUuYwo+Pj4+PiBAQCAtMzUsNyAr
MzUsNyBAQCBzdGF0aWMgdm9pZCAqYXJtX25vbW11X2RtYV9hbGxvYyhzdHJ1Y3QgZGV2aWNlICpk
ZXYsIHNpemVfdCBzaXplLAo+Pj4+PiDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKg
wqDCoCB1bnNpZ25lZCBsb25nIGF0dHJzKQo+Pj4+PiDCoMKgIMKgIHsKPj4+Pj4gLcKgwqDCoCB2
b2lkICpyZXQgPSBkbWFfYWxsb2NfZnJvbV9nbG9iYWxfY29oZXJlbnQoc2l6ZSwgZG1hX2hhbmRs
ZSk7Cj4+Pj4+ICvCoMKgwqAgdm9pZCAqcmV0ID0gZG1hX2FsbG9jX2Zyb21fZ2xvYmFsX2NvaGVy
ZW50KGRldiwgc2l6ZSwgZG1hX2hhbmRsZSk7Cj4+Pj4+IMKgwqAgwqDCoMKgwqDCoCAvKgo+Pj4+
PiDCoMKgwqDCoMKgwqDCoCAqIGRtYV9hbGxvY19mcm9tX2dsb2JhbF9jb2hlcmVudCgpIG1heSBm
YWlsIGJlY2F1c2U6Cj4+Pj4+IGRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1tYXBwaW5n
LmggYi9pbmNsdWRlL2xpbnV4L2RtYS1tYXBwaW5nLmgKPj4+Pj4gaW5kZXggNGExYzRmYy4uMTA5
MThjNSAxMDA2NDQKPj4+Pj4gLS0tIGEvaW5jbHVkZS9saW51eC9kbWEtbWFwcGluZy5oCj4+Pj4+
ICsrKyBiL2luY2x1ZGUvbGludXgvZG1hLW1hcHBpbmcuaAo+Pj4+PiBAQCAtMTYyLDcgKzE2Miw3
IEBAIGludCBkbWFfcmVsZWFzZV9mcm9tX2Rldl9jb2hlcmVudChzdHJ1Y3QgZGV2aWNlICpkZXYs
IGludCBvcmRlciwgdm9pZCAqdmFkZHIpOwo+Pj4+PiDCoMKgIGludCBkbWFfbW1hcF9mcm9tX2Rl
dl9jb2hlcmVudChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1h
LAo+Pj4+PiDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqAgdm9pZCAqY3B1X2Fk
ZHIsIHNpemVfdCBzaXplLCBpbnQgKnJldCk7Cj4+Pj4+IMKgwqAgLXZvaWQgKmRtYV9hbGxvY19m
cm9tX2dsb2JhbF9jb2hlcmVudChzc2l6ZV90IHNpemUsIGRtYV9hZGRyX3QgKmRtYV9oYW5kbGUp
Owo+Pj4+PiArdm9pZCAqZG1hX2FsbG9jX2Zyb21fZ2xvYmFsX2NvaGVyZW50KHN0cnVjdCBkZXZp
Y2UgKmRldiwgc3NpemVfdCBzaXplLCBkbWFfYWRkcl90ICpkbWFfaGFuZGxlKTsKPj4+Pj4gwqDC
oCBpbnQgZG1hX3JlbGVhc2VfZnJvbV9nbG9iYWxfY29oZXJlbnQoaW50IG9yZGVyLCB2b2lkICp2
YWRkcik7Cj4+Pj4+IMKgwqAgaW50IGRtYV9tbWFwX2Zyb21fZ2xvYmFsX2NvaGVyZW50KHN0cnVj
dCB2bV9hcmVhX3N0cnVjdCAqdm1hLCB2b2lkICpjcHVfYWRkciwKPj4+Pj4gwqDCoMKgwqDCoMKg
wqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoCBzaXplX3Qgc2l6ZSwgaW50ICpyZXQpOwo+Pj4+
PiBAQCAtMTcyLDcgKzE3Miw3IEBAIGludCBkbWFfbW1hcF9mcm9tX2dsb2JhbF9jb2hlcmVudChz
dHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwgdm9pZCAqY3B1X2FkZHIsCj4+Pj4+IMKgwqAgI2Rl
ZmluZSBkbWFfcmVsZWFzZV9mcm9tX2Rldl9jb2hlcmVudChkZXYsIG9yZGVyLCB2YWRkcikgKDAp
Cj4+Pj4+IMKgwqAgI2RlZmluZSBkbWFfbW1hcF9mcm9tX2Rldl9jb2hlcmVudChkZXYsIHZtYSwg
dmFkZHIsIG9yZGVyLCByZXQpICgwKQo+Pj4+PiDCoMKgIC1zdGF0aWMgaW5saW5lIHZvaWQgKmRt
YV9hbGxvY19mcm9tX2dsb2JhbF9jb2hlcmVudChzc2l6ZV90IHNpemUsCj4+Pj4+ICtzdGF0aWMg
aW5saW5lIHZvaWQgKmRtYV9hbGxvY19mcm9tX2dsb2JhbF9jb2hlcmVudChzdHJ1Y3QgZGV2aWNl
ICpkZXYsIHNzaXplX3Qgc2l6ZSwKPj4+Pj4gwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKg
wqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoCBkbWFfYWRkcl90ICpkbWFfaGFuZGxlKQo+Pj4+
PiDCoMKgIHsKPj4+Pj4gwqDCoMKgwqDCoMKgIHJldHVybiBOVUxMOwo+Pj4+PiBkaWZmIC0tZ2l0
IGEva2VybmVsL2RtYS9jb2hlcmVudC5jIGIva2VybmVsL2RtYS9jb2hlcmVudC5jCj4+Pj4+IGlu
ZGV4IDU0NWUzODYuLjU1MWIwZWIgMTAwNjQ0Cj4+Pj4+IC0tLSBhL2tlcm5lbC9kbWEvY29oZXJl
bnQuYwo+Pj4+PiArKysgYi9rZXJuZWwvZG1hL2NvaGVyZW50LmMKPj4+Pj4gQEAgLTEyMyw4ICsx
MjMsOSBAQCBpbnQgZG1hX2RlY2xhcmVfY29oZXJlbnRfbWVtb3J5KHN0cnVjdCBkZXZpY2UgKmRl
diwgcGh5c19hZGRyX3QgcGh5c19hZGRyLAo+Pj4+PiDCoMKgwqDCoMKgwqAgcmV0dXJuIHJldDsK
Pj4+Pj4gwqDCoCB9Cj4+Pj4+IMKgwqAgLXN0YXRpYyB2b2lkICpfX2RtYV9hbGxvY19mcm9tX2Nv
aGVyZW50KHN0cnVjdCBkbWFfY29oZXJlbnRfbWVtICptZW0sCj4+Pj4+IC3CoMKgwqDCoMKgwqDC
oCBzc2l6ZV90IHNpemUsIGRtYV9hZGRyX3QgKmRtYV9oYW5kbGUpCj4+Pj4+ICtzdGF0aWMgdm9p
ZCAqX19kbWFfYWxsb2NfZnJvbV9jb2hlcmVudChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4+Pj4+ICvC
oMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoCBzdHJ1Y3QgZG1hX2Nv
aGVyZW50X21lbSAqbWVtLAo+Pj4+PiArwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDC
oMKgwqDCoMKgwqAgc3NpemVfdCBzaXplLCBkbWFfYWRkcl90ICpkbWFfaGFuZGxlKQo+Pj4+PiDC
oMKgIHsKPj4+Pj4gwqDCoMKgwqDCoMKgIGludCBvcmRlciA9IGdldF9vcmRlcihzaXplKTsKPj4+
Pj4gwqDCoMKgwqDCoMKgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4+Pj4+IEBAIC0xNDMsNyArMTQ0
LDcgQEAgc3RhdGljIHZvaWQgKl9fZG1hX2FsbG9jX2Zyb21fY29oZXJlbnQoc3RydWN0IGRtYV9j
b2hlcmVudF9tZW0gKm1lbSwKPj4+Pj4gwqDCoMKgwqDCoMKgIC8qCj4+Pj4+IMKgwqDCoMKgwqDC
oMKgICogTWVtb3J5IHdhcyBmb3VuZCBpbiB0aGUgY29oZXJlbnQgYXJlYS4KPj4+Pj4gwqDCoMKg
wqDCoMKgwqAgKi8KPj4+Pj4gLcKgwqDCoCAqZG1hX2hhbmRsZSA9IG1lbS0+ZGV2aWNlX2Jhc2Ug
KyAocGFnZW5vIDw8IFBBR0VfU0hJRlQpOwo+Pj4+PiArwqDCoMKgICpkbWFfaGFuZGxlID0gZG1h
X2dldF9kZXZpY2VfYmFzZShkZXYsIG1lbSkgKyAocGFnZW5vIDw8IFBBR0VfU0hJRlQpOwo+Pj4+
PiDCoMKgwqDCoMKgwqAgcmV0ID0gbWVtLT52aXJ0X2Jhc2UgKyAocGFnZW5vIDw8IFBBR0VfU0hJ
RlQpOwo+Pj4+PiDCoMKgwqDCoMKgwqAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmbWVtLT5zcGlu
bG9jaywgZmxhZ3MpOwo+Pj4+PiDCoMKgwqDCoMKgwqAgbWVtc2V0KHJldCwgMCwgc2l6ZSk7Cj4+
Pj4+IEBAIC0xNzUsMTcgKzE3NiwxOCBAQCBpbnQgZG1hX2FsbG9jX2Zyb21fZGV2X2NvaGVyZW50
KHN0cnVjdCBkZXZpY2UgKmRldiwgc3NpemVfdCBzaXplLAo+Pj4+PiDCoMKgwqDCoMKgwqAgaWYg
KCFtZW0pCj4+Pj4+IMKgwqDCoMKgwqDCoMKgwqDCoMKgIHJldHVybiAwOwo+Pj4+PiDCoMKgIC3C
oMKgwqAgKnJldCA9IF9fZG1hX2FsbG9jX2Zyb21fY29oZXJlbnQobWVtLCBzaXplLCBkbWFfaGFu
ZGxlKTsKPj4+Pj4gK8KgwqDCoCAqcmV0ID0gX19kbWFfYWxsb2NfZnJvbV9jb2hlcmVudChkZXYs
IG1lbSwgc2l6ZSwgZG1hX2hhbmRsZSk7Cj4+Pj4+IMKgwqDCoMKgwqDCoCByZXR1cm4gMTsKPj4+
Pj4gwqDCoCB9Cj4+Pj4+IMKgwqAgLXZvaWQgKmRtYV9hbGxvY19mcm9tX2dsb2JhbF9jb2hlcmVu
dChzc2l6ZV90IHNpemUsIGRtYV9hZGRyX3QgKmRtYV9oYW5kbGUpCj4+Pj4+ICt2b2lkICpkbWFf
YWxsb2NfZnJvbV9nbG9iYWxfY29oZXJlbnQoc3RydWN0IGRldmljZSAqZGV2LCBzc2l6ZV90IHNp
emUsCj4+Pj4+ICvCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgIGRtYV9h
ZGRyX3QgKmRtYV9oYW5kbGUpCj4+Pj4+IMKgwqAgewo+Pj4+PiDCoMKgwqDCoMKgwqAgaWYgKCFk
bWFfY29oZXJlbnRfZGVmYXVsdF9tZW1vcnkpCj4+Pj4+IMKgwqDCoMKgwqDCoMKgwqDCoMKgIHJl
dHVybiBOVUxMOwo+Pj4+PiDCoMKgIC3CoMKgwqAgcmV0dXJuIF9fZG1hX2FsbG9jX2Zyb21fY29o
ZXJlbnQoZG1hX2NvaGVyZW50X2RlZmF1bHRfbWVtb3J5LCBzaXplLAo+Pj4+PiAtwqDCoMKgwqDC
oMKgwqDCoMKgwqDCoCBkbWFfaGFuZGxlKTsKPj4+Pj4gK8KgwqDCoCByZXR1cm4gX19kbWFfYWxs
b2NfZnJvbV9jb2hlcmVudChkZXYsIGRtYV9jb2hlcmVudF9kZWZhdWx0X21lbW9yeSwgc2l6ZSwK
Pj4+Pj4gK8KgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqAgZG1hX2hhbmRs
ZSk7Cj4+Pj4+IMKgwqAgfQo+Pj4+PiDCoMKgIMKgIHN0YXRpYyBpbnQgX19kbWFfcmVsZWFzZV9m
cm9tX2NvaGVyZW50KHN0cnVjdCBkbWFfY29oZXJlbnRfbWVtICptZW0sCj4+Pj4KPj4+Pgo+Pj4+
IFRoYW5rcwo+Pj4+IFZsYWRpbWlyCj4+Pj4KPj4KCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCmlvbW11IG1haWxpbmcgbGlzdAppb21tdUBsaXN0cy5saW51
eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1h
bi9saXN0aW5mby9pb21tdQ==
