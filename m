Return-Path: <iommu-bounces@lists.linux-foundation.org>
X-Original-To: lists.iommu@lfdr.de
Delivered-To: lists.iommu@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id 7D9F84E745D
	for <lists.iommu@lfdr.de>; Fri, 25 Mar 2022 14:42:19 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id 117AB41C6A;
	Fri, 25 Mar 2022 13:42:18 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id wDtr88OrRDRr; Fri, 25 Mar 2022 13:42:16 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTPS id 5F61641C2B;
	Fri, 25 Mar 2022 13:42:16 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 3D1D5C0073;
	Fri, 25 Mar 2022 13:42:16 +0000 (UTC)
X-Original-To: iommu@lists.linux-foundation.org
Delivered-To: iommu@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 6C03AC0012
 for <iommu@lists.linux-foundation.org>; Fri, 25 Mar 2022 13:42:14 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id 53AC18440F
 for <iommu@lists.linux-foundation.org>; Fri, 25 Mar 2022 13:42:14 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Authentication-Results: smtp1.osuosl.org (amavisd-new);
 dkim=pass (1024-bit key) header.d=foxmail.com
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 8BF9JkyH-jdh for <iommu@lists.linux-foundation.org>;
 Fri, 25 Mar 2022 13:42:12 +0000 (UTC)
X-Greylist: delayed 00:07:51 by SQLgrey-1.8.0
Received: from out203-205-221-240.mail.qq.com (out203-205-221-240.mail.qq.com
 [203.205.221.240])
 by smtp1.osuosl.org (Postfix) with ESMTPS id 13E588440B
 for <iommu@lists.linux-foundation.org>; Fri, 25 Mar 2022 13:42:10 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=foxmail.com;
 s=s201512; t=1648215728;
 bh=QQwVDGD8oOKcI53tbJIu5zeSFqME8ho6LLmA81Kew9k=;
 h=Subject:To:Cc:References:From:Date:In-Reply-To;
 b=iIg+T5tJN+4564zXJWyUBAoL8wphTUdQVWuNbMweLaIRVioE1JghBqOC6LnMpx40N
 ZcgkXeAdu6R57yQ/jIHYw9rKFxmMhCBIoSR7yxoORU8S9pp2szyQJDDvToZT38zaCz
 1P6gj+cv8nArQHmP6i7GHYkCt/9LD3v98Da+ViSM=
Received: from [IPv6:240e:362:43d:2e00:a8cc:839b:6dc9:9656]
 ([240e:362:43d:2e00:a8cc:839b:6dc9:9656])
 by newxmesmtplogicsvrsza9.qq.com (NewEsmtp) with SMTP
 id 888B0671; Fri, 25 Mar 2022 21:34:08 +0800
X-QQ-mid: xmsmtpt1648215248t8xgz82xf
Message-ID: <tencent_084E04DAF68A9A6613541A74836007D02006@qq.com>
X-QQ-XMAILINFO: NhUkPfKlCtQwLcveN0dwLOb1cLWfBFBFbdKtiQ51BSOxyt0Qg8TGaPIWGwX/MQ
 9zQcOwQYUfxXIjY82SWPrIS8dqMC+N/PxVg80oCkOQ208iiKZVPkkvO81q4h1af0Wpe+lyU+30ef
 3xW7esnqQpanJdtoUlE0AkqFr5Yp+tXn60CUTOfpvry86IsmRBzF0IH/GgWgpZkhKTN4hFvVjDPg
 Hj8R2jl+eCiz8SL/yFUBTNIrOP6P9qyEJ+89ES1vMf1Rtk7fCdRpmQQvHwAC0Mg1y9y3DrY5pods
 fnPGiRXzgBV3cv5oKuksPV50jRAYttX4PbTpgkkevQTtoo1p6z5eue6BsXX9SOge+J56Q6C6AhDQ
 F304qM5F89IXRVy2p/BtjqR3iL2oxv2sTj/TslLDIMnudXYbzWPTUHEmOLliH+J0ojopEP7/ioJn
 np9maFx/UetYZ4tEgf+8dvyyzBmYUzep9DWIlDX69e18JqVdcKZZO6o6D3sPT95+N0Kh+rmcjVPy
 F3xP0vcKrMHaYifFadKmfVlrXwQZuYRm4BGYNwCQIcBo4DtMq182LYuwxcdcG4Q4TD+rHDt+GC6B
 fjcuUfIe2Px9YJiwQ6j8wSErUIES+byFvtjxqTZ0UbTa06kwuabaGsNBBzyYL3KKDcwwuwOz3orl
 rZM2LDovIY/BFcSzO0jOJ+THWTKJMz5c4y/2WgjTuqqEHFgpcTxtNdAF7uLjZ98SS8weSRPtpKnY
 qabJnN9z/KnIJ1hhb9EmZCs87kIkor/AisRA90Q2V3kiPgAZ1faxYyvvRYJnKUbXWZBj8PwCFvKV
 1lurxz3u9HIXFi7G/DY7o0idSATwsAoiJ2KHrYUKfYanrWMvmqGpBbbjDTBCD+X7rdc++1Vehyq6
 eDPuAnuTqLO6uJiCGDl5lioZQU6Zo17Lj5/3s25C1YYdvBw/p6a5Esfvot2FDVrD3b27zbtTQY
Subject: Re: [PATCH RFC 07/12] iommufd: Data structure to provide IOVA to PFN
 mapping
To: Jason Gunthorpe <jgg@nvidia.com>
References: <7-v1-e79cd8d168e8+6-iommufd_jgg@nvidia.com>
From: "zhangfei.gao@foxmail.com" <zhangfei.gao@foxmail.com>
X-OQ-MSGID: <99e788b3-5b9d-48b8-ed0b-abfb5a9a53b8@foxmail.com>
Date: Fri, 25 Mar 2022 21:34:08 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.10.0
MIME-Version: 1.0
In-Reply-To: <7-v1-e79cd8d168e8+6-iommufd_jgg@nvidia.com>
Content-Language: en-US
Cc: Jean-Philippe Brucker <jean-philippe@linaro.org>,
 Chaitanya Kulkarni <chaitanyak@nvidia.com>,
 Alex Williamson <alex.williamson@redhat.com>, kvm@vger.kernel.org,
 "Michael S. Tsirkin" <mst@redhat.com>, Jason Wang <jasowang@redhat.com>,
 Cornelia Huck <cohuck@redhat.com>, Niklas Schnelle <schnelle@linux.ibm.com>,
 Kevin Tian <kevin.tian@intel.com>, Daniel Jordan <daniel.m.jordan@oracle.com>,
 iommu@lists.linux-foundation.org, Joao Martins <joao.m.martins@oracle.com>,
 David Gibson <david@gibson.dropbear.id.au>
X-BeenThere: iommu@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Development issues for Linux IOMMU support
 <iommu.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/iommu/>
List-Post: <mailto:iommu@lists.linux-foundation.org>
List-Help: <mailto:iommu-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: iommu-bounces@lists.linux-foundation.org
Sender: "iommu" <iommu-bounces@lists.linux-foundation.org>

SGksIEphc29uCgpPbiAyMDIyLzMvMTkg5LiK5Y2IMToyNywgSmFzb24gR3VudGhvcnBlIHZpYSBp
b21tdSB3cm90ZToKPiBUaGlzIGlzIHRoZSByZW1haW5kZXIgb2YgdGhlIElPQVMgZGF0YSBzdHJ1
Y3R1cmUuIFByb3ZpZGUgYW4gb2JqZWN0IGNhbGxlZAo+IGFuIGlvX3BhZ2V0YWJsZSB0aGF0IGlz
IGNvbXBvc2VkIG9mIGlvcHRfYXJlYXMgcG9pbnRpbmcgYXQgaW9wdF9wYWdlcywKPiBhbG9uZyB3
aXRoIGEgbGlzdCBvZiBpb21tdV9kb21haW5zIHRoYXQgbWlycm9yIHRoZSBJT1ZBIHRvIFBGTiBt
YXAuCj4KPiBBdCB0aGUgdG9wIHRoaXMgaXMgYSBzaW1wbGUgaW50ZXJ2YWwgdHJlZSBvZiBpb3B0
X2FyZWFzIGluZGljYXRpbmcgdGhlIG1hcAo+IG9mIElPVkEgdG8gaW9wdF9wYWdlcy4gQW4geGFy
cmF5IGtlZXBzIHRyYWNrIG9mIGEgbGlzdCBvZiBkb21haW5zLiBCYXNlZAo+IG9uIHRoZSBhdHRh
Y2hlZCBkb21haW5zIHRoZXJlIGlzIGEgbWluaW11bSBhbGlnbm1lbnQgZm9yIGFyZWFzICh3aGlj
aCBtYXkKPiBiZSBzbWFsbGVyIHRoYW4gUEFHRV9TSVpFKSBhbmQgYW4gaW50ZXJ2YWwgdHJlZSBv
ZiByZXNlcnZlZCBJT1ZBIHRoYXQKPiBjYW4ndCBiZSBtYXBwZWQuCj4KPiBUaGUgY29uY2VwdCBv
ZiBhICd1c2VyJyByZWZlcnMgdG8gc29tZXRoaW5nIGxpa2UgYSBWRklPIG1kZXYgdGhhdCBpcwo+
IGFjY2Vzc2luZyB0aGUgSU9WQSBhbmQgdXNpbmcgYSAnc3RydWN0IHBhZ2UgKicgZm9yIENQVSBi
YXNlZCBhY2Nlc3MuCj4KPiBFeHRlcm5hbGx5IGFuIEFQSSBpcyBwcm92aWRlZCB0aGF0IG1hdGNo
ZXMgdGhlIHJlcXVpcmVtZW50cyBvZiB0aGUgSU9DVEwKPiBpbnRlcmZhY2UgZm9yIG1hcC91bm1h
cCBhbmQgZG9tYWluIGF0dGFjaG1lbnQuCj4KPiBUaGUgQVBJIHByb3ZpZGVzIGEgJ2NvcHknIHBy
aW1pdGl2ZSB0byBlc3RhYmxpc2ggYSBuZXcgSU9WQSBtYXAgaW4gYQo+IGRpZmZlcmVudCBJT0FT
IGZyb20gYW4gZXhpc3RpbmcgbWFwcGluZy4KPgo+IFRoaXMgaXMgZGVzaWduZWQgdG8gc3VwcG9y
dCBhIHByZS1yZWdpc3RyYXRpb24gZmxvdyB3aGVyZSB1c2Vyc3BhY2Ugd291bGQKPiBzZXR1cCBh
biBkdW1teSBJT0FTIHdpdGggbm8gZG9tYWlucywgbWFwIGluIG1lbW9yeSBhbmQgdGhlbiBlc3Rh
Ymxpc2ggYQo+IHVzZXIgdG8gcGluIGFsbCBQRk5zIGludG8gdGhlIHhhcnJheS4KPgo+IENvcHkg
Y2FuIHRoZW4gYmUgdXNlZCB0byBjcmVhdGUgbmV3IElPVkEgbWFwcGluZ3MgaW4gYSBkaWZmZXJl
bnQgSU9BUywKPiB3aXRoIGlvbW11X2RvbWFpbnMgYXR0YWNoZWQuIFVwb24gY29weSB0aGUgUEZO
cyB3aWxsIGJlIHJlYWQgb3V0IG9mIHRoZQo+IHhhcnJheSBhbmQgbWFwcGVkIGludG8gdGhlIGlv
bW11X2RvbWFpbnMsIGF2b2lkaW5nIGFueSBwaW5fdXNlcl9wYWdlcygpCj4gb3ZlcmhlYWRzLgo+
Cj4gU2lnbmVkLW9mZi1ieTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbnZpZGlhLmNvbT4KPiAtLS0K
PiAgIGRyaXZlcnMvaW9tbXUvaW9tbXVmZC9NYWtlZmlsZSAgICAgICAgICB8ICAgMSArCj4gICBk
cml2ZXJzL2lvbW11L2lvbW11ZmQvaW9fcGFnZXRhYmxlLmMgICAgfCA4OTAgKysrKysrKysrKysr
KysrKysrKysrKysrCj4gICBkcml2ZXJzL2lvbW11L2lvbW11ZmQvaW9tbXVmZF9wcml2YXRlLmgg
fCAgMzUgKwo+ICAgMyBmaWxlcyBjaGFuZ2VkLCA5MjYgaW5zZXJ0aW9ucygrKQo+ICAgY3JlYXRl
IG1vZGUgMTAwNjQ0IGRyaXZlcnMvaW9tbXUvaW9tbXVmZC9pb19wYWdldGFibGUuYwo+Cj4gZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvaW9tbXUvaW9tbXVmZC9NYWtlZmlsZSBiL2RyaXZlcnMvaW9tbXUv
aW9tbXVmZC9NYWtlZmlsZQo+IGluZGV4IDA1YTBlOTFlMzBhZmFkLi5iNjZhOGM0N2ZmNTVlYyAx
MDA2NDQKPiAtLS0gYS9kcml2ZXJzL2lvbW11L2lvbW11ZmQvTWFrZWZpbGUKPiArKysgYi9kcml2
ZXJzL2lvbW11L2lvbW11ZmQvTWFrZWZpbGUKPiBAQCAtMSw1ICsxLDYgQEAKPiAgICMgU1BEWC1M
aWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seQo+ICAgaW9tbXVmZC15IDo9IFwKPiArCWlv
X3BhZ2V0YWJsZS5vIFwKPiAgIAltYWluLm8gXAo+ICAgCXBhZ2VzLm8KPiAgIAo+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL2lvbW11L2lvbW11ZmQvaW9fcGFnZXRhYmxlLmMgYi9kcml2ZXJzL2lvbW11
L2lvbW11ZmQvaW9fcGFnZXRhYmxlLmMKPiBuZXcgZmlsZSBtb2RlIDEwMDY0NAo+IGluZGV4IDAw
MDAwMDAwMDAwMDAwLi5mOWYzYjA2OTQ2YmZiOQo+IC0tLSAvZGV2L251bGwKPiArKysgYi9kcml2
ZXJzL2lvbW11L2lvbW11ZmQvaW9fcGFnZXRhYmxlLmMKPiBAQCAtMCwwICsxLDg5MCBAQAo+ICsv
LyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAo+ICsvKiBDb3B5cmlnaHQgKGMpIDIw
MjEtMjAyMiwgTlZJRElBIENPUlBPUkFUSU9OICYgQUZGSUxJQVRFUy4KPiArICoKPiArICogVGhl
IGlvX3BhZ2V0YWJsZSBpcyB0aGUgdG9wIG9mIGRhdGFzdHJ1Y3R1cmUgdGhhdCBtYXBzIElPVkEn
cyB0byBQRk5zLiBUaGUKPiArICogUEZOcyBjYW4gYmUgcGxhY2VkIGludG8gYW4gaW9tbXVfZG9t
YWluLCBvciByZXR1cm5lZCB0byB0aGUgY2FsbGVyIGFzIGEgcGFnZQo+ICsgKiBsaXN0IGZvciBh
Y2Nlc3MgYnkgYW4gaW4ta2VybmVsIHVzZXIuCj4gKyAqCj4gKyAqIFRoZSBkYXRhc3RydWN0dXJl
IHVzZXMgdGhlIGlvcHRfcGFnZXMgdG8gb3B0aW1pemUgdGhlIHN0b3JhZ2Ugb2YgdGhlIFBGTnMK
PiArICogYmV0d2VlbiB0aGUgZG9tYWlucyBhbmQgeGFycmF5Lgo+ICsgKi8KPiArI2luY2x1ZGUg
PGxpbnV4L2xvY2tkZXAuaD4KPiArI2luY2x1ZGUgPGxpbnV4L2lvbW11Lmg+Cj4gKyNpbmNsdWRl
IDxsaW51eC9zY2hlZC9tbS5oPgo+ICsjaW5jbHVkZSA8bGludXgvZXJyLmg+Cj4gKyNpbmNsdWRl
IDxsaW51eC9zbGFiLmg+Cj4gKyNpbmNsdWRlIDxsaW51eC9lcnJuby5oPgo+ICsKPiArI2luY2x1
ZGUgImlvX3BhZ2V0YWJsZS5oIgo+ICsKPiArc3RhdGljIHVuc2lnbmVkIGxvbmcgaW9wdF9hcmVh
X2lvdmFfdG9faW5kZXgoc3RydWN0IGlvcHRfYXJlYSAqYXJlYSwKPiArCQkJCQkgICAgIHVuc2ln
bmVkIGxvbmcgaW92YSkKPiArewo+ICsJaWYgKElTX0VOQUJMRUQoQ09ORklHX0lPTU1VRkRfVEVT
VCkpCj4gKwkJV0FSTl9PTihpb3ZhIDwgaW9wdF9hcmVhX2lvdmEoYXJlYSkgfHwKPiArCQkJaW92
YSA+IGlvcHRfYXJlYV9sYXN0X2lvdmEoYXJlYSkpOwo+ICsJcmV0dXJuIChpb3ZhIC0gKGlvcHRf
YXJlYV9pb3ZhKGFyZWEpICYgUEFHRV9NQVNLKSkgLyBQQUdFX1NJWkU7Cj4gK30KPiArCj4gK3N0
YXRpYyBzdHJ1Y3QgaW9wdF9hcmVhICppb3B0X2ZpbmRfZXhhY3RfYXJlYShzdHJ1Y3QgaW9fcGFn
ZXRhYmxlICppb3B0LAo+ICsJCQkJCSAgICAgIHVuc2lnbmVkIGxvbmcgaW92YSwKPiArCQkJCQkg
ICAgICB1bnNpZ25lZCBsb25nIGxhc3RfaW92YSkKPiArewo+ICsJc3RydWN0IGlvcHRfYXJlYSAq
YXJlYTsKPiArCj4gKwlhcmVhID0gaW9wdF9hcmVhX2l0ZXJfZmlyc3QoaW9wdCwgaW92YSwgbGFz
dF9pb3ZhKTsKPiArCWlmICghYXJlYSB8fCAhYXJlYS0+cGFnZXMgfHwgaW9wdF9hcmVhX2lvdmEo
YXJlYSkgIT0gaW92YSB8fAo+ICsJICAgIGlvcHRfYXJlYV9sYXN0X2lvdmEoYXJlYSkgIT0gbGFz
dF9pb3ZhKQo+ICsJCXJldHVybiBOVUxMOwo+ICsJcmV0dXJuIGFyZWE7Cj4gK30KPiArCj4gK3N0
YXRpYyBib29sIF9fYWxsb2NfaW92YV9jaGVja19ob2xlKHN0cnVjdCBpbnRlcnZhbF90cmVlX3Nw
YW5faXRlciAqc3BhbiwKPiArCQkJCSAgICB1bnNpZ25lZCBsb25nIGxlbmd0aCwKPiArCQkJCSAg
ICB1bnNpZ25lZCBsb25nIGlvdmFfYWxpZ25tZW50LAo+ICsJCQkJICAgIHVuc2lnbmVkIGxvbmcg
cGFnZV9vZmZzZXQpCj4gK3sKPiArCWlmICghc3Bhbi0+aXNfaG9sZSB8fCBzcGFuLT5sYXN0X2hv
bGUgLSBzcGFuLT5zdGFydF9ob2xlIDwgbGVuZ3RoIC0gMSkKPiArCQlyZXR1cm4gZmFsc2U7Cj4g
Kwo+ICsJc3Bhbi0+c3RhcnRfaG9sZSA9Cj4gKwkJQUxJR04oc3Bhbi0+c3RhcnRfaG9sZSwgaW92
YV9hbGlnbm1lbnQpIHwgcGFnZV9vZmZzZXQ7Cj4gKwlpZiAoc3Bhbi0+c3RhcnRfaG9sZSA+IHNw
YW4tPmxhc3RfaG9sZSB8fAo+ICsJICAgIHNwYW4tPmxhc3RfaG9sZSAtIHNwYW4tPnN0YXJ0X2hv
bGUgPCBsZW5ndGggLSAxKQo+ICsJCXJldHVybiBmYWxzZTsKPiArCXJldHVybiB0cnVlOwo+ICt9
Cj4gKwo+ICsvKgo+ICsgKiBBdXRvbWF0aWNhbGx5IGZpbmQgYSBibG9jayBvZiBJT1ZBIHRoYXQg
aXMgbm90IGJlaW5nIHVzZWQgYW5kIG5vdCByZXNlcnZlZC4KPiArICogRG9lcyBub3QgcmV0dXJu
IGEgMCBJT1ZBIGV2ZW4gaWYgaXQgaXMgdmFsaWQuCj4gKyAqLwo+ICtzdGF0aWMgaW50IGlvcHRf
YWxsb2NfaW92YShzdHJ1Y3QgaW9fcGFnZXRhYmxlICppb3B0LCB1bnNpZ25lZCBsb25nICppb3Zh
LAo+ICsJCQkgICB1bnNpZ25lZCBsb25nIHVwdHIsIHVuc2lnbmVkIGxvbmcgbGVuZ3RoKQo+ICt7
Cj4gKwlzdHJ1Y3QgaW50ZXJ2YWxfdHJlZV9zcGFuX2l0ZXIgcmVzZXJ2ZWRfc3BhbjsKPiArCXVu
c2lnbmVkIGxvbmcgcGFnZV9vZmZzZXQgPSB1cHRyICUgUEFHRV9TSVpFOwo+ICsJc3RydWN0IGlu
dGVydmFsX3RyZWVfc3Bhbl9pdGVyIGFyZWFfc3BhbjsKPiArCXVuc2lnbmVkIGxvbmcgaW92YV9h
bGlnbm1lbnQ7Cj4gKwo+ICsJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaW9wdC0+aW92YV9yd3NlbSk7
Cj4gKwo+ICsJLyogUHJvdGVjdCByb3VuZHVwX3Bvdy1vZl90d28oKSBmcm9tIG92ZXJmbG93ICov
Cj4gKwlpZiAobGVuZ3RoID09IDAgfHwgbGVuZ3RoID49IFVMT05HX01BWCAvIDIpCj4gKwkJcmV0
dXJuIC1FT1ZFUkZMT1c7Cj4gKwo+ICsJLyoKPiArCSAqIEtlZXAgYWxpZ25tZW50IHByZXNlbnQg
aW4gdGhlIHVwdHIgd2hlbiBidWlsZGluZyB0aGUgSU9WQSwgdGhpcwo+ICsJICogaW5jcmVhc2Vz
IHRoZSBjaGFuY2Ugd2UgY2FuIG1hcCBhIFRIUC4KPiArCSAqLwo+ICsJaWYgKCF1cHRyKQo+ICsJ
CWlvdmFfYWxpZ25tZW50ID0gcm91bmR1cF9wb3dfb2ZfdHdvKGxlbmd0aCk7Cj4gKwllbHNlCj4g
KwkJaW92YV9hbGlnbm1lbnQgPQo+ICsJCQltaW5fdCh1bnNpZ25lZCBsb25nLCByb3VuZHVwX3Bv
d19vZl90d28obGVuZ3RoKSwKPiArCQkJICAgICAgMVVMIDw8IF9fZmZzNjQodXB0cikpOwo+ICsK
PiArCWlmIChpb3ZhX2FsaWdubWVudCA8IGlvcHQtPmlvdmFfYWxpZ25tZW50KQo+ICsJCXJldHVy
biAtRUlOVkFMOwo+ICsJZm9yIChpbnRlcnZhbF90cmVlX3NwYW5faXRlcl9maXJzdCgmYXJlYV9z
cGFuLCAmaW9wdC0+YXJlYV9pdHJlZSwKPiArCQkJCQkgICBQQUdFX1NJWkUsIFVMT05HX01BWCAt
IFBBR0VfU0laRSk7Cj4gKwkgICAgICFpbnRlcnZhbF90cmVlX3NwYW5faXRlcl9kb25lKCZhcmVh
X3NwYW4pOwo+ICsJICAgICBpbnRlcnZhbF90cmVlX3NwYW5faXRlcl9uZXh0KCZhcmVhX3NwYW4p
KSB7Cj4gKwkJaWYgKCFfX2FsbG9jX2lvdmFfY2hlY2tfaG9sZSgmYXJlYV9zcGFuLCBsZW5ndGgs
IGlvdmFfYWxpZ25tZW50LAo+ICsJCQkJCSAgICAgcGFnZV9vZmZzZXQpKQo+ICsJCQljb250aW51
ZTsKPiArCj4gKwkJZm9yIChpbnRlcnZhbF90cmVlX3NwYW5faXRlcl9maXJzdCgKPiArCQkJICAg
ICAmcmVzZXJ2ZWRfc3BhbiwgJmlvcHQtPnJlc2VydmVkX2lvdmFfaXRyZWUsCj4gKwkJCSAgICAg
YXJlYV9zcGFuLnN0YXJ0X2hvbGUsIGFyZWFfc3Bhbi5sYXN0X2hvbGUpOwo+ICsJCSAgICAgIWlu
dGVydmFsX3RyZWVfc3Bhbl9pdGVyX2RvbmUoJnJlc2VydmVkX3NwYW4pOwo+ICsJCSAgICAgaW50
ZXJ2YWxfdHJlZV9zcGFuX2l0ZXJfbmV4dCgmcmVzZXJ2ZWRfc3BhbikpIHsKPiArCQkJaWYgKCFf
X2FsbG9jX2lvdmFfY2hlY2tfaG9sZSgmcmVzZXJ2ZWRfc3BhbiwgbGVuZ3RoLAo+ICsJCQkJCQkg
ICAgIGlvdmFfYWxpZ25tZW50LAo+ICsJCQkJCQkgICAgIHBhZ2Vfb2Zmc2V0KSkKPiArCQkJCWNv
bnRpbnVlOwo+ICsKPiArCQkJKmlvdmEgPSByZXNlcnZlZF9zcGFuLnN0YXJ0X2hvbGU7Cj4gKwkJ
CXJldHVybiAwOwo+ICsJCX0KPiArCX0KPiArCXJldHVybiAtRU5PU1BDOwo+ICt9Cj4gKwo+ICsv
Kgo+ICsgKiBUaGUgYXJlYSB0YWtlcyBhIHNsaWNlIG9mIHRoZSBwYWdlcyBmcm9tIHN0YXJ0X2J5
dGVzIHRvIHN0YXJ0X2J5dGUgKyBsZW5ndGgKPiArICovCj4gK3N0YXRpYyBzdHJ1Y3QgaW9wdF9h
cmVhICoKPiAraW9wdF9hbGxvY19hcmVhKHN0cnVjdCBpb19wYWdldGFibGUgKmlvcHQsIHN0cnVj
dCBpb3B0X3BhZ2VzICpwYWdlcywKPiArCQl1bnNpZ25lZCBsb25nIGlvdmEsIHVuc2lnbmVkIGxv
bmcgc3RhcnRfYnl0ZSwKPiArCQl1bnNpZ25lZCBsb25nIGxlbmd0aCwgaW50IGlvbW11X3Byb3Qs
IHVuc2lnbmVkIGludCBmbGFncykKPiArewo+ICsJc3RydWN0IGlvcHRfYXJlYSAqYXJlYTsKPiAr
CWludCByYzsKPiArCj4gKwlhcmVhID0ga3phbGxvYyhzaXplb2YoKmFyZWEpLCBHRlBfS0VSTkVM
KTsKPiArCWlmICghYXJlYSkKPiArCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKPiArCj4gKwlh
cmVhLT5pb3B0ID0gaW9wdDsKPiArCWFyZWEtPmlvbW11X3Byb3QgPSBpb21tdV9wcm90Owo+ICsJ
YXJlYS0+cGFnZV9vZmZzZXQgPSBzdGFydF9ieXRlICUgUEFHRV9TSVpFOwo+ICsJYXJlYS0+cGFn
ZXNfbm9kZS5zdGFydCA9IHN0YXJ0X2J5dGUgLyBQQUdFX1NJWkU7Cj4gKwlpZiAoY2hlY2tfYWRk
X292ZXJmbG93KHN0YXJ0X2J5dGUsIGxlbmd0aCAtIDEsICZhcmVhLT5wYWdlc19ub2RlLmxhc3Qp
KQo+ICsJCXJldHVybiBFUlJfUFRSKC1FT1ZFUkZMT1cpOwo+ICsJYXJlYS0+cGFnZXNfbm9kZS5s
YXN0ID0gYXJlYS0+cGFnZXNfbm9kZS5sYXN0IC8gUEFHRV9TSVpFOwo+ICsJaWYgKFdBUk5fT04o
YXJlYS0+cGFnZXNfbm9kZS5sYXN0ID49IHBhZ2VzLT5ucGFnZXMpKQo+ICsJCXJldHVybiBFUlJf
UFRSKC1FT1ZFUkZMT1cpOwo+ICsKPiArCWRvd25fd3JpdGUoJmlvcHQtPmlvdmFfcndzZW0pOwo+
ICsJaWYgKGZsYWdzICYgSU9QVF9BTExPQ19JT1ZBKSB7Cj4gKwkJcmMgPSBpb3B0X2FsbG9jX2lv
dmEoaW9wdCwgJmlvdmEsCj4gKwkJCQkgICAgICh1aW50cHRyX3QpcGFnZXMtPnVwdHIgKyBzdGFy
dF9ieXRlLAo+ICsJCQkJICAgICBsZW5ndGgpOwo+ICsJCWlmIChyYykKPiArCQkJZ290byBvdXRf
dW5sb2NrOwo+ICsJfQo+ICsKPiArCWlmIChjaGVja19hZGRfb3ZlcmZsb3coaW92YSwgbGVuZ3Ro
IC0gMSwgJmFyZWEtPm5vZGUubGFzdCkpIHsKPiArCQlyYyA9IC1FT1ZFUkZMT1c7Cj4gKwkJZ290
byBvdXRfdW5sb2NrOwo+ICsJfQo+ICsKPiArCWlmICghKGZsYWdzICYgSU9QVF9BTExPQ19JT1ZB
KSkgewo+ICsJCWlmICgoaW92YSAmIChpb3B0LT5pb3ZhX2FsaWdubWVudCAtIDEpKSB8fAo+ICsJ
CSAgICAobGVuZ3RoICYgKGlvcHQtPmlvdmFfYWxpZ25tZW50IC0gMSkpIHx8ICFsZW5ndGgpIHsK
PiArCQkJcmMgPSAtRUlOVkFMOwo+ICsJCQlnb3RvIG91dF91bmxvY2s7Cj4gKwkJfQo+ICsKPiAr
CQkvKiBObyByZXNlcnZlZCBJT1ZBIGludGVyc2VjdHMgdGhlIHJhbmdlICovCj4gKwkJaWYgKGlu
dGVydmFsX3RyZWVfaXRlcl9maXJzdCgmaW9wdC0+cmVzZXJ2ZWRfaW92YV9pdHJlZSwgaW92YSwK
PiArCQkJCQkgICAgIGFyZWEtPm5vZGUubGFzdCkpIHsKPiArCQkJcmMgPSAtRU5PRU5UOwo+ICsJ
CQlnb3RvIG91dF91bmxvY2s7Cj4gKwkJfQo+ICsKPiArCQkvKiBDaGVjayB0aGF0IHRoZXJlIGlz
IG5vdCBhbHJlYWR5IGEgbWFwcGluZyBpbiB0aGUgcmFuZ2UgKi8KPiArCQlpZiAoaW9wdF9hcmVh
X2l0ZXJfZmlyc3QoaW9wdCwgaW92YSwgYXJlYS0+bm9kZS5sYXN0KSkgewo+ICsJCQlyYyA9IC1F
QUREUklOVVNFOwo+ICsJCQlnb3RvIG91dF91bmxvY2s7Cj4gKwkJfQo+ICsJfQo+ICsKPiArCS8q
Cj4gKwkgKiBUaGUgYXJlYSBpcyBpbnNlcnRlZCB3aXRoIGEgTlVMTCBwYWdlcyBpbmRpY2F0aW5n
IGl0IGlzIG5vdCBmdWxseQo+ICsJICogaW5pdGlhbGl6ZWQgeWV0Lgo+ICsJICovCj4gKwlhcmVh
LT5ub2RlLnN0YXJ0ID0gaW92YTsKPiArCWludGVydmFsX3RyZWVfaW5zZXJ0KCZhcmVhLT5ub2Rl
LCAmYXJlYS0+aW9wdC0+YXJlYV9pdHJlZSk7Cj4gKwl1cF93cml0ZSgmaW9wdC0+aW92YV9yd3Nl
bSk7Cj4gKwlyZXR1cm4gYXJlYTsKPiArCj4gK291dF91bmxvY2s6Cj4gKwl1cF93cml0ZSgmaW9w
dC0+aW92YV9yd3NlbSk7Cj4gKwlrZnJlZShhcmVhKTsKPiArCXJldHVybiBFUlJfUFRSKHJjKTsK
PiArfQo+ICsKPiArc3RhdGljIHZvaWQgaW9wdF9hYm9ydF9hcmVhKHN0cnVjdCBpb3B0X2FyZWEg
KmFyZWEpCj4gK3sKPiArCWRvd25fd3JpdGUoJmFyZWEtPmlvcHQtPmlvdmFfcndzZW0pOwo+ICsJ
aW50ZXJ2YWxfdHJlZV9yZW1vdmUoJmFyZWEtPm5vZGUsICZhcmVhLT5pb3B0LT5hcmVhX2l0cmVl
KTsKPiArCXVwX3dyaXRlKCZhcmVhLT5pb3B0LT5pb3ZhX3J3c2VtKTsKPiArCWtmcmVlKGFyZWEp
Owo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50IGlvcHRfZmluYWxpemVfYXJlYShzdHJ1Y3QgaW9wdF9h
cmVhICphcmVhLCBzdHJ1Y3QgaW9wdF9wYWdlcyAqcGFnZXMpCj4gK3sKPiArCWludCByYzsKPiAr
Cj4gKwlkb3duX3JlYWQoJmFyZWEtPmlvcHQtPmRvbWFpbnNfcndzZW0pOwo+ICsJcmMgPSBpb3B0
X2FyZWFfZmlsbF9kb21haW5zKGFyZWEsIHBhZ2VzKTsKPiArCWlmICghcmMpIHsKPiArCQkvKgo+
ICsJCSAqIGFyZWEtPnBhZ2VzIG11c3QgYmUgc2V0IGluc2lkZSB0aGUgZG9tYWluc19yd3NlbSB0
byBlbnN1cmUKPiArCQkgKiBhbnkgbmV3bHkgYWRkZWQgZG9tYWlucyB3aWxsIGdldCBmaWxsZWQu
IE1vdmVzIHRoZSByZWZlcmVuY2UKPiArCQkgKiBpbiBmcm9tIHRoZSBjYWxsZXIKPiArCQkgKi8K
PiArCQlkb3duX3dyaXRlKCZhcmVhLT5pb3B0LT5pb3ZhX3J3c2VtKTsKPiArCQlhcmVhLT5wYWdl
cyA9IHBhZ2VzOwo+ICsJCXVwX3dyaXRlKCZhcmVhLT5pb3B0LT5pb3ZhX3J3c2VtKTsKPiArCX0K
PiArCXVwX3JlYWQoJmFyZWEtPmlvcHQtPmRvbWFpbnNfcndzZW0pOwo+ICsJcmV0dXJuIHJjOwo+
ICt9Cj4gKwo+ICtpbnQgaW9wdF9tYXBfcGFnZXMoc3RydWN0IGlvX3BhZ2V0YWJsZSAqaW9wdCwg
c3RydWN0IGlvcHRfcGFnZXMgKnBhZ2VzLAo+ICsJCSAgIHVuc2lnbmVkIGxvbmcgKmRzdF9pb3Zh
LCB1bnNpZ25lZCBsb25nIHN0YXJ0X2J5dGVzLAo+ICsJCSAgIHVuc2lnbmVkIGxvbmcgbGVuZ3Ro
LCBpbnQgaW9tbXVfcHJvdCwgdW5zaWduZWQgaW50IGZsYWdzKQo+ICt7Cj4gKwlzdHJ1Y3QgaW9w
dF9hcmVhICphcmVhOwo+ICsJaW50IHJjOwo+ICsKPiArCWlmICgoaW9tbXVfcHJvdCAmIElPTU1V
X1dSSVRFKSAmJiAhcGFnZXMtPndyaXRhYmxlKQo+ICsJCXJldHVybiAtRVBFUk07Cj4gKwo+ICsJ
YXJlYSA9IGlvcHRfYWxsb2NfYXJlYShpb3B0LCBwYWdlcywgKmRzdF9pb3ZhLCBzdGFydF9ieXRl
cywgbGVuZ3RoLAo+ICsJCQkgICAgICAgaW9tbXVfcHJvdCwgZmxhZ3MpOwo+ICsJaWYgKElTX0VS
UihhcmVhKSkKPiArCQlyZXR1cm4gUFRSX0VSUihhcmVhKTsKPiArCSpkc3RfaW92YSA9IGlvcHRf
YXJlYV9pb3ZhKGFyZWEpOwo+ICsKPiArCXJjID0gaW9wdF9maW5hbGl6ZV9hcmVhKGFyZWEsIHBh
Z2VzKTsKPiArCWlmIChyYykgewo+ICsJCWlvcHRfYWJvcnRfYXJlYShhcmVhKTsKPiArCQlyZXR1
cm4gcmM7Cj4gKwl9Cj4gKwlyZXR1cm4gMDsKPiArfQo+ICsKPiArLyoqCj4gKyAqIGlvcHRfbWFw
X3VzZXJfcGFnZXMoKSAtIE1hcCBhIHVzZXIgVkEgdG8gYW4gaW92YSBpbiB0aGUgaW8gcGFnZSB0
YWJsZQo+ICsgKiBAaW9wdDogaW9fcGFnZXRhYmxlIHRvIGFjdCBvbgo+ICsgKiBAaW92YTogSWYg
SU9QVF9BTExPQ19JT1ZBIGlzIHNldCB0aGlzIGlzIHVudXNlZCBvbiBpbnB1dCBhbmQgY29udGFp
bnMKPiArICogICAgICAgIHRoZSBjaG9zZW4gaW92YSBvbiBvdXRwdXQuIE90aGVyd2lzZSBpcyB0
aGUgaW92YSB0byBtYXAgdG8gb24gaW5wdXQKPiArICogQHVwdHI6IFVzZXIgVkEgdG8gbWFwCj4g
KyAqIEBsZW5ndGg6IE51bWJlciBvZiBieXRlcyB0byBtYXAKPiArICogQGlvbW11X3Byb3Q6IENv
bWJpbmF0aW9uIG9mIElPTU1VX1JFQUQvV1JJVEUvZXRjIGJpdHMgZm9yIHRoZSBtYXBwaW5nCj4g
KyAqIEBmbGFnczogSU9QVF9BTExPQ19JT1ZBIG9yIHplcm8KPiArICoKPiArICogaW92YSwgdXB0
ciwgYW5kIGxlbmd0aCBtdXN0IGJlIGFsaWduZWQgdG8gaW92YV9hbGlnbm1lbnQuIEZvciBkb21h
aW4gYmFja2VkCj4gKyAqIHBhZ2UgdGFibGVzIHRoaXMgd2lsbCBwaW4gdGhlIHBhZ2VzIGFuZCBs
b2FkIHRoZW0gaW50byB0aGUgZG9tYWluIGF0IGlvdmEuCj4gKyAqIEZvciBub24tZG9tYWluIHBh
Z2UgdGFibGVzIHRoaXMgd2lsbCBvbmx5IHNldHVwIGEgbGF6eSByZWZlcmVuY2UgYW5kIHRoZQo+
ICsgKiBjYWxsZXIgbXVzdCB1c2UgaW9wdF9hY2Nlc3NfcGFnZXMoKSB0byB0b3VjaCB0aGVtLgo+
ICsgKgo+ICsgKiBpb3B0X3VubWFwX2lvdmEoKSBtdXN0IGJlIGNhbGxlZCB0byB1bmRvIHRoaXMg
YmVmb3JlIHRoZSBpb19wYWdldGFibGUgY2FuIGJlCj4gKyAqIGRlc3Ryb3llZC4KPiArICovCj4g
K2ludCBpb3B0X21hcF91c2VyX3BhZ2VzKHN0cnVjdCBpb19wYWdldGFibGUgKmlvcHQsIHVuc2ln
bmVkIGxvbmcgKmlvdmEsCj4gKwkJCXZvaWQgX191c2VyICp1cHRyLCB1bnNpZ25lZCBsb25nIGxl
bmd0aCwgaW50IGlvbW11X3Byb3QsCj4gKwkJCXVuc2lnbmVkIGludCBmbGFncykKPiArewo+ICsJ
c3RydWN0IGlvcHRfcGFnZXMgKnBhZ2VzOwo+ICsJaW50IHJjOwo+ICsKPiArCXBhZ2VzID0gaW9w
dF9hbGxvY19wYWdlcyh1cHRyLCBsZW5ndGgsIGlvbW11X3Byb3QgJiBJT01NVV9XUklURSk7Cj4g
KwlpZiAoSVNfRVJSKHBhZ2VzKSkKPiArCQlyZXR1cm4gUFRSX0VSUihwYWdlcyk7Cj4gKwo+ICsJ
cmMgPSBpb3B0X21hcF9wYWdlcyhpb3B0LCBwYWdlcywgaW92YSwgdXB0ciAtIHBhZ2VzLT51cHRy
LCBsZW5ndGgsCj4gKwkJCSAgICBpb21tdV9wcm90LCBmbGFncyk7Cj4gKwlpZiAocmMpIHsKPiAr
CQlpb3B0X3B1dF9wYWdlcyhwYWdlcyk7Cj4gKwkJcmV0dXJuIHJjOwo+ICsJfQo+ICsJcmV0dXJu
IDA7Cj4gK30KPiArCj4gK3N0cnVjdCBpb3B0X3BhZ2VzICppb3B0X2dldF9wYWdlcyhzdHJ1Y3Qg
aW9fcGFnZXRhYmxlICppb3B0LCB1bnNpZ25lZCBsb25nIGlvdmEsCj4gKwkJCQkgIHVuc2lnbmVk
IGxvbmcgKnN0YXJ0X2J5dGUsCj4gKwkJCQkgIHVuc2lnbmVkIGxvbmcgbGVuZ3RoKQo+ICt7Cj4g
Kwl1bnNpZ25lZCBsb25nIGlvdmFfZW5kOwo+ICsJc3RydWN0IGlvcHRfcGFnZXMgKnBhZ2VzOwo+
ICsJc3RydWN0IGlvcHRfYXJlYSAqYXJlYTsKPiArCj4gKwlpZiAoY2hlY2tfYWRkX292ZXJmbG93
KGlvdmEsIGxlbmd0aCAtIDEsICZpb3ZhX2VuZCkpCj4gKwkJcmV0dXJuIEVSUl9QVFIoLUVPVkVS
RkxPVyk7Cj4gKwo+ICsJZG93bl9yZWFkKCZpb3B0LT5pb3ZhX3J3c2VtKTsKPiArCWFyZWEgPSBp
b3B0X2ZpbmRfZXhhY3RfYXJlYShpb3B0LCBpb3ZhLCBpb3ZhX2VuZCk7Cj4gKwlpZiAoIWFyZWEp
IHsKPiArCQl1cF9yZWFkKCZpb3B0LT5pb3ZhX3J3c2VtKTsKPiArCQlyZXR1cm4gRVJSX1BUUigt
RU5PRU5UKTsKPiArCX0KPiArCXBhZ2VzID0gYXJlYS0+cGFnZXM7Cj4gKwkqc3RhcnRfYnl0ZSA9
IGFyZWEtPnBhZ2Vfb2Zmc2V0ICsgaW9wdF9hcmVhX2luZGV4KGFyZWEpICogUEFHRV9TSVpFOwo+
ICsJa3JlZl9nZXQoJnBhZ2VzLT5rcmVmKTsKPiArCXVwX3JlYWQoJmlvcHQtPmlvdmFfcndzZW0p
Owo+ICsKPiArCXJldHVybiBwYWdlczsKPiArfQo+ICsKPiArc3RhdGljIGludCBfX2lvcHRfdW5t
YXBfaW92YShzdHJ1Y3QgaW9fcGFnZXRhYmxlICppb3B0LCBzdHJ1Y3QgaW9wdF9hcmVhICphcmVh
LAo+ICsJCQkgICAgIHN0cnVjdCBpb3B0X3BhZ2VzICpwYWdlcykKPiArewo+ICsJLyogRHJpdmVy
cyBoYXZlIHRvIHVucGluIG9uIG5vdGlmaWNhdGlvbi4gKi8KPiArCWlmIChXQVJOX09OKGF0b21p
Y19yZWFkKCZhcmVhLT5udW1fdXNlcnMpKSkKPiArCQlyZXR1cm4gLUVCVVNZOwo+ICsKPiArCWlv
cHRfYXJlYV91bmZpbGxfZG9tYWlucyhhcmVhLCBwYWdlcyk7Cj4gKwlXQVJOX09OKGF0b21pY19y
ZWFkKCZhcmVhLT5udW1fdXNlcnMpKTsKPiArCWlvcHRfYWJvcnRfYXJlYShhcmVhKTsKPiArCWlv
cHRfcHV0X3BhZ2VzKHBhZ2VzKTsKPiArCXJldHVybiAwOwo+ICt9Cj4gKwo+ICsvKioKPiArICog
aW9wdF91bm1hcF9pb3ZhKCkgLSBSZW1vdmUgYSByYW5nZSBvZiBpb3ZhCj4gKyAqIEBpb3B0OiBp
b19wYWdldGFibGUgdG8gYWN0IG9uCj4gKyAqIEBpb3ZhOiBTdGFydGluZyBpb3ZhIHRvIHVubWFw
Cj4gKyAqIEBsZW5ndGg6IE51bWJlciBvZiBieXRlcyB0byB1bm1hcAo+ICsgKgo+ICsgKiBUaGUg
cmVxdWVzdGVkIHJhbmdlIG11c3QgZXhhY3RseSBtYXRjaCBhbiBleGlzdGluZyByYW5nZS4KPiAr
ICogU3BsaXR0aW5nL3RydW5jYXRpbmcgSU9WQSBtYXBwaW5ncyBpcyBub3QgYWxsb3dlZC4KPiAr
ICovCj4gK2ludCBpb3B0X3VubWFwX2lvdmEoc3RydWN0IGlvX3BhZ2V0YWJsZSAqaW9wdCwgdW5z
aWduZWQgbG9uZyBpb3ZhLAo+ICsJCSAgICB1bnNpZ25lZCBsb25nIGxlbmd0aCkKPiArewo+ICsJ
c3RydWN0IGlvcHRfcGFnZXMgKnBhZ2VzOwo+ICsJc3RydWN0IGlvcHRfYXJlYSAqYXJlYTsKPiAr
CXVuc2lnbmVkIGxvbmcgaW92YV9lbmQ7Cj4gKwlpbnQgcmM7Cj4gKwo+ICsJaWYgKCFsZW5ndGgp
Cj4gKwkJcmV0dXJuIC1FSU5WQUw7Cj4gKwo+ICsJaWYgKGNoZWNrX2FkZF9vdmVyZmxvdyhpb3Zh
LCBsZW5ndGggLSAxLCAmaW92YV9lbmQpKQo+ICsJCXJldHVybiAtRU9WRVJGTE9XOwo+ICsKPiAr
CWRvd25fcmVhZCgmaW9wdC0+ZG9tYWluc19yd3NlbSk7Cj4gKwlkb3duX3dyaXRlKCZpb3B0LT5p
b3ZhX3J3c2VtKTsKPiArCWFyZWEgPSBpb3B0X2ZpbmRfZXhhY3RfYXJlYShpb3B0LCBpb3ZhLCBp
b3ZhX2VuZCk7Cj4gKwlpZiAoIWFyZWEpIHsKPiArCQl1cF93cml0ZSgmaW9wdC0+aW92YV9yd3Nl
bSk7Cj4gKwkJdXBfcmVhZCgmaW9wdC0+ZG9tYWluc19yd3NlbSk7Cj4gKwkJcmV0dXJuIC1FTk9F
TlQ7Cj4gKwl9Cj4gKwlwYWdlcyA9IGFyZWEtPnBhZ2VzOwo+ICsJYXJlYS0+cGFnZXMgPSBOVUxM
Owo+ICsJdXBfd3JpdGUoJmlvcHQtPmlvdmFfcndzZW0pOwo+ICsKPiArCXJjID0gX19pb3B0X3Vu
bWFwX2lvdmEoaW9wdCwgYXJlYSwgcGFnZXMpOwo+ICsJdXBfcmVhZCgmaW9wdC0+ZG9tYWluc19y
d3NlbSk7Cj4gKwlyZXR1cm4gcmM7Cj4gK30KPiArCj4gK2ludCBpb3B0X3VubWFwX2FsbChzdHJ1
Y3QgaW9fcGFnZXRhYmxlICppb3B0KQo+ICt7Cj4gKwlzdHJ1Y3QgaW9wdF9hcmVhICphcmVhOwo+
ICsJaW50IHJjOwo+ICsKPiArCWRvd25fcmVhZCgmaW9wdC0+ZG9tYWluc19yd3NlbSk7Cj4gKwlk
b3duX3dyaXRlKCZpb3B0LT5pb3ZhX3J3c2VtKTsKPiArCXdoaWxlICgoYXJlYSA9IGlvcHRfYXJl
YV9pdGVyX2ZpcnN0KGlvcHQsIDAsIFVMT05HX01BWCkpKSB7Cj4gKwkJc3RydWN0IGlvcHRfcGFn
ZXMgKnBhZ2VzOwo+ICsKPiArCQkvKiBVc2Vyc3BhY2Ugc2hvdWxkIG5vdCByYWNlIHVubWFwIGFs
bCBhbmQgbWFwICovCj4gKwkJaWYgKCFhcmVhLT5wYWdlcykgewo+ICsJCQlyYyA9IC1FQlVTWTsK
PiArCQkJZ290byBvdXRfdW5sb2NrX2lvdmE7Cj4gKwkJfQo+ICsJCXBhZ2VzID0gYXJlYS0+cGFn
ZXM7Cj4gKwkJYXJlYS0+cGFnZXMgPSBOVUxMOwo+ICsJCXVwX3dyaXRlKCZpb3B0LT5pb3ZhX3J3
c2VtKTsKPiArCj4gKwkJcmMgPSBfX2lvcHRfdW5tYXBfaW92YShpb3B0LCBhcmVhLCBwYWdlcyk7
Cj4gKwkJaWYgKHJjKQo+ICsJCQlnb3RvIG91dF91bmxvY2tfZG9tYWluczsKPiArCj4gKwkJZG93
bl93cml0ZSgmaW9wdC0+aW92YV9yd3NlbSk7Cj4gKwl9Cj4gKwlyYyA9IDA7Cj4gKwo+ICtvdXRf
dW5sb2NrX2lvdmE6Cj4gKwl1cF93cml0ZSgmaW9wdC0+aW92YV9yd3NlbSk7Cj4gK291dF91bmxv
Y2tfZG9tYWluczoKPiArCXVwX3JlYWQoJmlvcHQtPmRvbWFpbnNfcndzZW0pOwo+ICsJcmV0dXJu
IHJjOwo+ICt9Cj4gKwo+ICsvKioKPiArICogaW9wdF9hY2Nlc3NfcGFnZXMoKSAtIFJldHVybiBh
IGxpc3Qgb2YgcGFnZXMgdW5kZXIgdGhlIGlvdmEKPiArICogQGlvcHQ6IGlvX3BhZ2V0YWJsZSB0
byBhY3Qgb24KPiArICogQGlvdmE6IFN0YXJ0aW5nIElPVkEKPiArICogQGxlbmd0aDogTnVtYmVy
IG9mIGJ5dGVzIHRvIGFjY2Vzcwo+ICsgKiBAb3V0X3BhZ2VzOiBPdXRwdXQgcGFnZSBsaXN0Cj4g
KyAqIEB3cml0ZTogVHJ1ZSBpZiBhY2Nlc3MgaXMgZm9yIHdyaXRpbmcKPiArICoKPiArICogUmVh
ZHMgQG5wYWdlcyBzdGFydGluZyBhdCBpb3ZhIGFuZCByZXR1cm5zIHRoZSBzdHJ1Y3QgcGFnZSAq
IHBvaW50ZXJzLiBUaGVzZQo+ICsgKiBjYW4gYmUga21hcCdkIGJ5IHRoZSBjYWxsZXIgZm9yIENQ
VSBhY2Nlc3MuCj4gKyAqCj4gKyAqIFRoZSBjYWxsZXIgbXVzdCBwZXJmb3JtIGlvcHRfdW5hY2Nl
c3NfcGFnZXMoKSB3aGVuIGRvbmUgdG8gYmFsYW5jZSB0aGlzLgo+ICsgKgo+ICsgKiBpb3ZhIGNh
biBiZSB1bmFsaWduZWQgZnJvbSBQQUdFX1NJWkUuIFRoZSBmaXJzdCByZXR1cm5lZCBieXRlIHN0
YXJ0cyBhdAo+ICsgKiBwYWdlX3RvX3BoeXMob3V0X3BhZ2VzWzBdKSArIChpb3ZhICUgUEFHRV9T
SVpFKS4gVGhlIGNhbGxlciBwcm9taXNlcyBub3QgdG8KPiArICogdG91Y2ggbWVtb3J5IG91dHNp
ZGUgdGhlIHJlcXVlc3RlZCBpb3ZhIHNsaWNlLgo+ICsgKgo+ICsgKiBGSVhNRTogY2FsbGVycyB0
aGF0IG5lZWQgYSBETUEgbWFwcGluZyB2aWEgYSBzZ2wgc2hvdWxkIGNyZWF0ZSBhbm90aGVyCj4g
KyAqIGludGVyZmFjZSB0byBidWlsZCB0aGUgU0dMIGVmZmljaWVudGx5Cj4gKyAqLwo+ICtpbnQg
aW9wdF9hY2Nlc3NfcGFnZXMoc3RydWN0IGlvX3BhZ2V0YWJsZSAqaW9wdCwgdW5zaWduZWQgbG9u
ZyBpb3ZhLAo+ICsJCSAgICAgIHVuc2lnbmVkIGxvbmcgbGVuZ3RoLCBzdHJ1Y3QgcGFnZSAqKm91
dF9wYWdlcywgYm9vbCB3cml0ZSkKPiArewo+ICsJdW5zaWduZWQgbG9uZyBjdXJfaW92YSA9IGlv
dmE7Cj4gKwl1bnNpZ25lZCBsb25nIGxhc3RfaW92YTsKPiArCXN0cnVjdCBpb3B0X2FyZWEgKmFy
ZWE7Cj4gKwlpbnQgcmM7Cj4gKwo+ICsJaWYgKCFsZW5ndGgpCj4gKwkJcmV0dXJuIC1FSU5WQUw7
Cj4gKwlpZiAoY2hlY2tfYWRkX292ZXJmbG93KGlvdmEsIGxlbmd0aCAtIDEsICZsYXN0X2lvdmEp
KQo+ICsJCXJldHVybiAtRU9WRVJGTE9XOwo+ICsKPiArCWRvd25fcmVhZCgmaW9wdC0+aW92YV9y
d3NlbSk7Cj4gKwlmb3IgKGFyZWEgPSBpb3B0X2FyZWFfaXRlcl9maXJzdChpb3B0LCBpb3ZhLCBs
YXN0X2lvdmEpOyBhcmVhOwo+ICsJICAgICBhcmVhID0gaW9wdF9hcmVhX2l0ZXJfbmV4dChhcmVh
LCBpb3ZhLCBsYXN0X2lvdmEpKSB7Cj4gKwkJdW5zaWduZWQgbG9uZyBsYXN0ID0gbWluKGxhc3Rf
aW92YSwgaW9wdF9hcmVhX2xhc3RfaW92YShhcmVhKSk7Cj4gKwkJdW5zaWduZWQgbG9uZyBsYXN0
X2luZGV4Owo+ICsJCXVuc2lnbmVkIGxvbmcgaW5kZXg7Cj4gKwo+ICsJCS8qIE5lZWQgY29udGln
dW91cyBhcmVhcyBpbiB0aGUgYWNjZXNzICovCj4gKwkJaWYgKGlvcHRfYXJlYV9pb3ZhKGFyZWEp
IDwgY3VyX2lvdmEgfHwgIWFyZWEtPnBhZ2VzKSB7Cj4gKwkJCXJjID0gLUVJTlZBTDsKPiArCQkJ
Z290byBvdXRfcmVtb3ZlOwo+ICsJCX0KPiArCj4gKwkJaW5kZXggPSBpb3B0X2FyZWFfaW92YV90
b19pbmRleChhcmVhLCBjdXJfaW92YSk7Cj4gKwkJbGFzdF9pbmRleCA9IGlvcHRfYXJlYV9pb3Zh
X3RvX2luZGV4KGFyZWEsIGxhc3QpOwo+ICsJCXJjID0gaW9wdF9wYWdlc19hZGRfdXNlcihhcmVh
LT5wYWdlcywgaW5kZXgsIGxhc3RfaW5kZXgsCj4gKwkJCQkJIG91dF9wYWdlcywgd3JpdGUpOwo+
ICsJCWlmIChyYykKPiArCQkJZ290byBvdXRfcmVtb3ZlOwo+ICsJCWlmIChsYXN0ID09IGxhc3Rf
aW92YSkKPiArCQkJYnJlYWs7Cj4gKwkJLyoKPiArCQkgKiBDYW4ndCBjcm9zcyBhcmVhcyB0aGF0
IGFyZSBub3QgYWxpZ25lZCB0byB0aGUgc3lzdGVtIHBhZ2UKPiArCQkgKiBzaXplIHdpdGggdGhp
cyBBUEkuCj4gKwkJICovCj4gKwkJaWYgKGN1cl9pb3ZhICUgUEFHRV9TSVpFKSB7Cj4gKwkJCXJj
ID0gLUVJTlZBTDsKPiArCQkJZ290byBvdXRfcmVtb3ZlOwo+ICsJCX0KPiArCQljdXJfaW92YSA9
IGxhc3QgKyAxOwo+ICsJCW91dF9wYWdlcyArPSBsYXN0X2luZGV4IC0gaW5kZXg7Cj4gKwkJYXRv
bWljX2luYygmYXJlYS0+bnVtX3VzZXJzKTsKPiArCX0KPiArCj4gKwl1cF9yZWFkKCZpb3B0LT5p
b3ZhX3J3c2VtKTsKPiArCXJldHVybiAwOwo+ICsKPiArb3V0X3JlbW92ZToKPiArCWlmIChjdXJf
aW92YSAhPSBpb3ZhKQo+ICsJCWlvcHRfdW5hY2Nlc3NfcGFnZXMoaW9wdCwgaW92YSwgY3VyX2lv
dmEgLSBpb3ZhKTsKPiArCXVwX3JlYWQoJmlvcHQtPmlvdmFfcndzZW0pOwo+ICsJcmV0dXJuIHJj
Owo+ICt9Cj4gKwo+ICsvKioKPiArICogaW9wdF91bmFjY2Vzc19wYWdlcygpIC0gVW5kbyBpb3B0
X2FjY2Vzc19wYWdlcwo+ICsgKiBAaW9wdDogaW9fcGFnZXRhYmxlIHRvIGFjdCBvbgo+ICsgKiBA
aW92YTogU3RhcnRpbmcgSU9WQQo+ICsgKiBAbGVuZ3RoOi0gTnVtYmVyIG9mIGJ5dGVzIHRvIGFj
Y2Vzcwo+ICsgKgo+ICsgKiBSZXR1cm4gdGhlIHN0cnVjdCBwYWdlJ3MuIFRoZSBjYWxsZXIgbXVz
dCBzdG9wIGFjY2Vzc2luZyB0aGVtIGJlZm9yZSBjYWxsaW5nCj4gKyAqIHRoaXMuIFRoZSBpb3Zh
L2xlbmd0aCBtdXN0IGV4YWN0bHkgbWF0Y2ggdGhlIG9uZSBwcm92aWRlZCB0byBhY2Nlc3NfcGFn
ZXMuCj4gKyAqLwo+ICt2b2lkIGlvcHRfdW5hY2Nlc3NfcGFnZXMoc3RydWN0IGlvX3BhZ2V0YWJs
ZSAqaW9wdCwgdW5zaWduZWQgbG9uZyBpb3ZhLAo+ICsJCQkgc2l6ZV90IGxlbmd0aCkKPiArewo+
ICsJdW5zaWduZWQgbG9uZyBjdXJfaW92YSA9IGlvdmE7Cj4gKwl1bnNpZ25lZCBsb25nIGxhc3Rf
aW92YTsKPiArCXN0cnVjdCBpb3B0X2FyZWEgKmFyZWE7Cj4gKwo+ICsJaWYgKFdBUk5fT04oIWxl
bmd0aCkgfHwKPiArCSAgICBXQVJOX09OKGNoZWNrX2FkZF9vdmVyZmxvdyhpb3ZhLCBsZW5ndGgg
LSAxLCAmbGFzdF9pb3ZhKSkpCj4gKwkJcmV0dXJuOwo+ICsKPiArCWRvd25fcmVhZCgmaW9wdC0+
aW92YV9yd3NlbSk7Cj4gKwlmb3IgKGFyZWEgPSBpb3B0X2FyZWFfaXRlcl9maXJzdChpb3B0LCBp
b3ZhLCBsYXN0X2lvdmEpOyBhcmVhOwo+ICsJICAgICBhcmVhID0gaW9wdF9hcmVhX2l0ZXJfbmV4
dChhcmVhLCBpb3ZhLCBsYXN0X2lvdmEpKSB7Cj4gKwkJdW5zaWduZWQgbG9uZyBsYXN0ID0gbWlu
KGxhc3RfaW92YSwgaW9wdF9hcmVhX2xhc3RfaW92YShhcmVhKSk7Cj4gKwkJaW50IG51bV91c2Vy
czsKPiArCj4gKwkJaW9wdF9wYWdlc19yZW1vdmVfdXNlcihhcmVhLT5wYWdlcywKPiArCQkJCSAg
ICAgICBpb3B0X2FyZWFfaW92YV90b19pbmRleChhcmVhLCBjdXJfaW92YSksCj4gKwkJCQkgICAg
ICAgaW9wdF9hcmVhX2lvdmFfdG9faW5kZXgoYXJlYSwgbGFzdCkpOwo+ICsJCWlmIChsYXN0ID09
IGxhc3RfaW92YSkKPiArCQkJYnJlYWs7Cj4gKwkJY3VyX2lvdmEgPSBsYXN0ICsgMTsKPiArCQlu
dW1fdXNlcnMgPSBhdG9taWNfZGVjX3JldHVybigmYXJlYS0+bnVtX3VzZXJzKTsKPiArCQlXQVJO
X09OKG51bV91c2VycyA8IDApOwo+ICsJfQo+ICsJdXBfcmVhZCgmaW9wdC0+aW92YV9yd3NlbSk7
Cj4gK30KPiArCj4gK3N0cnVjdCBpb3B0X3Jlc2VydmVkX2lvdmEgewo+ICsJc3RydWN0IGludGVy
dmFsX3RyZWVfbm9kZSBub2RlOwo+ICsJdm9pZCAqb3duZXI7Cj4gK307Cj4gKwo+ICtpbnQgaW9w
dF9yZXNlcnZlX2lvdmEoc3RydWN0IGlvX3BhZ2V0YWJsZSAqaW9wdCwgdW5zaWduZWQgbG9uZyBz
dGFydCwKPiArCQkgICAgICB1bnNpZ25lZCBsb25nIGxhc3QsIHZvaWQgKm93bmVyKQo+ICt7Cj4g
KwlzdHJ1Y3QgaW9wdF9yZXNlcnZlZF9pb3ZhICpyZXNlcnZlZDsKPiArCj4gKwlsb2NrZGVwX2Fz
c2VydF9oZWxkX3dyaXRlKCZpb3B0LT5pb3ZhX3J3c2VtKTsKPiArCj4gKwlpZiAoaW9wdF9hcmVh
X2l0ZXJfZmlyc3QoaW9wdCwgc3RhcnQsIGxhc3QpKQo+ICsJCXJldHVybiAtRUFERFJJTlVTRTsK
PiArCj4gKwlyZXNlcnZlZCA9IGt6YWxsb2Moc2l6ZW9mKCpyZXNlcnZlZCksIEdGUF9LRVJORUwp
Owo+ICsJaWYgKCFyZXNlcnZlZCkKPiArCQlyZXR1cm4gLUVOT01FTTsKPiArCXJlc2VydmVkLT5u
b2RlLnN0YXJ0ID0gc3RhcnQ7Cj4gKwlyZXNlcnZlZC0+bm9kZS5sYXN0ID0gbGFzdDsKPiArCXJl
c2VydmVkLT5vd25lciA9IG93bmVyOwo+ICsJaW50ZXJ2YWxfdHJlZV9pbnNlcnQoJnJlc2VydmVk
LT5ub2RlLCAmaW9wdC0+cmVzZXJ2ZWRfaW92YV9pdHJlZSk7Cj4gKwlyZXR1cm4gMDsKPiArfQo+
ICsKPiArdm9pZCBpb3B0X3JlbW92ZV9yZXNlcnZlZF9pb3ZhKHN0cnVjdCBpb19wYWdldGFibGUg
KmlvcHQsIHZvaWQgKm93bmVyKQo+ICt7Cj4gKwo+ICsJc3RydWN0IGludGVydmFsX3RyZWVfbm9k
ZSAqbm9kZTsKPiArCj4gKwlmb3IgKG5vZGUgPSBpbnRlcnZhbF90cmVlX2l0ZXJfZmlyc3QoJmlv
cHQtPnJlc2VydmVkX2lvdmFfaXRyZWUsIDAsCj4gKwkJCQkJICAgICBVTE9OR19NQVgpOwo+ICsJ
ICAgICBub2RlOykgewo+ICsJCXN0cnVjdCBpb3B0X3Jlc2VydmVkX2lvdmEgKnJlc2VydmVkID0K
PiArCQkJY29udGFpbmVyX29mKG5vZGUsIHN0cnVjdCBpb3B0X3Jlc2VydmVkX2lvdmEsIG5vZGUp
Owo+ICsKPiArCQlub2RlID0gaW50ZXJ2YWxfdHJlZV9pdGVyX25leHQobm9kZSwgMCwgVUxPTkdf
TUFYKTsKPiArCj4gKwkJaWYgKHJlc2VydmVkLT5vd25lciA9PSBvd25lcikgewo+ICsJCQlpbnRl
cnZhbF90cmVlX3JlbW92ZSgmcmVzZXJ2ZWQtPm5vZGUsCj4gKwkJCQkJICAgICAmaW9wdC0+cmVz
ZXJ2ZWRfaW92YV9pdHJlZSk7Cj4gKwkJCWtmcmVlKHJlc2VydmVkKTsKPiArCQl9Cj4gKwl9Cj4g
K30KPiArCj4gK2ludCBpb3B0X2luaXRfdGFibGUoc3RydWN0IGlvX3BhZ2V0YWJsZSAqaW9wdCkK
PiArewo+ICsJaW5pdF9yd3NlbSgmaW9wdC0+aW92YV9yd3NlbSk7Cj4gKwlpbml0X3J3c2VtKCZp
b3B0LT5kb21haW5zX3J3c2VtKTsKPiArCWlvcHQtPmFyZWFfaXRyZWUgPSBSQl9ST09UX0NBQ0hF
RDsKPiArCWlvcHQtPnJlc2VydmVkX2lvdmFfaXRyZWUgPSBSQl9ST09UX0NBQ0hFRDsKPiArCXhh
X2luaXQoJmlvcHQtPmRvbWFpbnMpOwo+ICsKPiArCS8qCj4gKwkgKiBpb3B0J3Mgc3RhcnQgYXMg
U1cgdGFibGVzIHRoYXQgY2FuIHVzZSB0aGUgZW50aXJlIHNpemVfdCBJT1ZBIHNwYWNlCj4gKwkg
KiBkdWUgdG8gdGhlIHVzZSBvZiBzaXplX3QgaW4gdGhlIEFQSXMuIFRoZXkgaGF2ZSBubyBhbGln
bm1lbnQKPiArCSAqIHJlc3RyaWN0aW9uLgo+ICsJICovCj4gKwlpb3B0LT5pb3ZhX2FsaWdubWVu
dCA9IDE7Cj4gKwo+ICsJcmV0dXJuIDA7Cj4gK30KPiArCj4gK3ZvaWQgaW9wdF9kZXN0cm95X3Rh
YmxlKHN0cnVjdCBpb19wYWdldGFibGUgKmlvcHQpCj4gK3sKPiArCWlmIChJU19FTkFCTEVEKENP
TkZJR19JT01NVUZEX1RFU1QpKQo+ICsJCWlvcHRfcmVtb3ZlX3Jlc2VydmVkX2lvdmEoaW9wdCwg
TlVMTCk7Cj4gKwlXQVJOX09OKCFSQl9FTVBUWV9ST09UKCZpb3B0LT5yZXNlcnZlZF9pb3ZhX2l0
cmVlLnJiX3Jvb3QpKTsKPiArCVdBUk5fT04oIXhhX2VtcHR5KCZpb3B0LT5kb21haW5zKSk7Cj4g
KwlXQVJOX09OKCFSQl9FTVBUWV9ST09UKCZpb3B0LT5hcmVhX2l0cmVlLnJiX3Jvb3QpKTsKPiAr
fQo+ICsKPiArLyoqCj4gKyAqIGlvcHRfdW5maWxsX2RvbWFpbigpIC0gVW5maWxsIGEgZG9tYWlu
IHdpdGggUEZOcwo+ICsgKiBAaW9wdDogaW9fcGFnZXRhYmxlIHRvIGFjdCBvbgo+ICsgKiBAZG9t
YWluOiBkb21haW4gdG8gdW5maWxsCj4gKyAqCj4gKyAqIFRoaXMgaXMgdXNlZCB3aGVuIHJlbW92
aW5nIGEgZG9tYWluIGZyb20gdGhlIGlvcHQuIEV2ZXJ5IGFyZWEgaW4gdGhlIGlvcHQKPiArICog
d2lsbCBiZSB1bm1hcHBlZCBmcm9tIHRoZSBkb21haW4uIFRoZSBkb21haW4gbXVzdCBhbHJlYWR5
IGJlIHJlbW92ZWQgZnJvbSB0aGUKPiArICogZG9tYWlucyB4YXJyYXkuCj4gKyAqLwo+ICtzdGF0
aWMgdm9pZCBpb3B0X3VuZmlsbF9kb21haW4oc3RydWN0IGlvX3BhZ2V0YWJsZSAqaW9wdCwKPiAr
CQkJICAgICAgIHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbikKPiArewo+ICsJc3RydWN0IGlv
cHRfYXJlYSAqYXJlYTsKPiArCj4gKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpb3B0LT5pb3ZhX3J3
c2VtKTsKPiArCWxvY2tkZXBfYXNzZXJ0X2hlbGRfd3JpdGUoJmlvcHQtPmRvbWFpbnNfcndzZW0p
Owo+ICsKPiArCS8qCj4gKwkgKiBTb21lIG90aGVyIGRvbWFpbiBpcyBob2xkaW5nIGFsbCB0aGUg
cGZucyBzdGlsbCwgcmFwaWRseSB1bm1hcCB0aGlzCj4gKwkgKiBkb21haW4uCj4gKwkgKi8KPiAr
CWlmIChpb3B0LT5uZXh0X2RvbWFpbl9pZCAhPSAwKSB7Cj4gKwkJLyogUGljayBhbiBhcmJpdHJh
cnkgcmVtYWluaW5nIGRvbWFpbiB0byBhY3QgYXMgc3RvcmFnZSAqLwo+ICsJCXN0cnVjdCBpb21t
dV9kb21haW4gKnN0b3JhZ2VfZG9tYWluID0KPiArCQkJeGFfbG9hZCgmaW9wdC0+ZG9tYWlucywg
MCk7Cj4gKwo+ICsJCWZvciAoYXJlYSA9IGlvcHRfYXJlYV9pdGVyX2ZpcnN0KGlvcHQsIDAsIFVM
T05HX01BWCk7IGFyZWE7Cj4gKwkJICAgICBhcmVhID0gaW9wdF9hcmVhX2l0ZXJfbmV4dChhcmVh
LCAwLCBVTE9OR19NQVgpKSB7Cj4gKwkJCXN0cnVjdCBpb3B0X3BhZ2VzICpwYWdlcyA9IGFyZWEt
PnBhZ2VzOwo+ICsKPiArCQkJaWYgKFdBUk5fT04oIXBhZ2VzKSkKPiArCQkJCWNvbnRpbnVlOwo+
ICsKPiArCQkJbXV0ZXhfbG9jaygmcGFnZXMtPm11dGV4KTsKPiArCQkJaWYgKGFyZWEtPnN0b3Jh
Z2VfZG9tYWluICE9IGRvbWFpbikgewo+ICsJCQkJbXV0ZXhfdW5sb2NrKCZwYWdlcy0+bXV0ZXgp
Owo+ICsJCQkJY29udGludWU7Cj4gKwkJCX0KPiArCQkJYXJlYS0+c3RvcmFnZV9kb21haW4gPSBz
dG9yYWdlX2RvbWFpbjsKPiArCQkJbXV0ZXhfdW5sb2NrKCZwYWdlcy0+bXV0ZXgpOwo+ICsJCX0K
PiArCj4gKwo+ICsJCWlvcHRfdW5tYXBfZG9tYWluKGlvcHQsIGRvbWFpbik7Cj4gKwkJcmV0dXJu
Owo+ICsJfQo+ICsKPiArCWZvciAoYXJlYSA9IGlvcHRfYXJlYV9pdGVyX2ZpcnN0KGlvcHQsIDAs
IFVMT05HX01BWCk7IGFyZWE7Cj4gKwkgICAgIGFyZWEgPSBpb3B0X2FyZWFfaXRlcl9uZXh0KGFy
ZWEsIDAsIFVMT05HX01BWCkpIHsKPiArCQlzdHJ1Y3QgaW9wdF9wYWdlcyAqcGFnZXMgPSBhcmVh
LT5wYWdlczsKPiArCj4gKwkJaWYgKFdBUk5fT04oIXBhZ2VzKSkKPiArCQkJY29udGludWU7Cj4g
Kwo+ICsJCW11dGV4X2xvY2soJnBhZ2VzLT5tdXRleCk7Cj4gKwkJaW50ZXJ2YWxfdHJlZV9yZW1v
dmUoJmFyZWEtPnBhZ2VzX25vZGUsCj4gKwkJCQkgICAgICZhcmVhLT5wYWdlcy0+ZG9tYWluc19p
dHJlZSk7Cj4gKwkJV0FSTl9PTihhcmVhLT5zdG9yYWdlX2RvbWFpbiAhPSBkb21haW4pOwo+ICsJ
CWFyZWEtPnN0b3JhZ2VfZG9tYWluID0gTlVMTDsKPiArCQlpb3B0X2FyZWFfdW5maWxsX2RvbWFp
bihhcmVhLCBwYWdlcywgZG9tYWluKTsKPiArCQltdXRleF91bmxvY2soJnBhZ2VzLT5tdXRleCk7
Cj4gKwl9Cj4gK30KPiArCj4gKy8qKgo+ICsgKiBpb3B0X2ZpbGxfZG9tYWluKCkgLSBGaWxsIGEg
ZG9tYWluIHdpdGggUEZOcwo+ICsgKiBAaW9wdDogaW9fcGFnZXRhYmxlIHRvIGFjdCBvbgo+ICsg
KiBAZG9tYWluOiBkb21haW4gdG8gZmlsbAo+ICsgKgo+ICsgKiBGaWxsIHRoZSBkb21haW4gd2l0
aCBQRk5zIGZyb20gZXZlcnkgYXJlYSBpbiB0aGUgaW9wdC4gT24gZmFpbHVyZSB0aGUgZG9tYWlu
Cj4gKyAqIGlzIGxlZnQgdW5jaGFuZ2VkLgo+ICsgKi8KPiArc3RhdGljIGludCBpb3B0X2ZpbGxf
ZG9tYWluKHN0cnVjdCBpb19wYWdldGFibGUgKmlvcHQsCj4gKwkJCSAgICBzdHJ1Y3QgaW9tbXVf
ZG9tYWluICpkb21haW4pCj4gK3sKPiArCXN0cnVjdCBpb3B0X2FyZWEgKmVuZF9hcmVhOwo+ICsJ
c3RydWN0IGlvcHRfYXJlYSAqYXJlYTsKPiArCWludCByYzsKPiArCj4gKwlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZpb3B0LT5pb3ZhX3J3c2VtKTsKPiArCWxvY2tkZXBfYXNzZXJ0X2hlbGRfd3JpdGUo
JmlvcHQtPmRvbWFpbnNfcndzZW0pOwo+ICsKPiArCWZvciAoYXJlYSA9IGlvcHRfYXJlYV9pdGVy
X2ZpcnN0KGlvcHQsIDAsIFVMT05HX01BWCk7IGFyZWE7Cj4gKwkgICAgIGFyZWEgPSBpb3B0X2Fy
ZWFfaXRlcl9uZXh0KGFyZWEsIDAsIFVMT05HX01BWCkpIHsKPiArCQlzdHJ1Y3QgaW9wdF9wYWdl
cyAqcGFnZXMgPSBhcmVhLT5wYWdlczsKPiArCj4gKwkJaWYgKFdBUk5fT04oIXBhZ2VzKSkKPiAr
CQkJY29udGludWU7Cj4gKwo+ICsJCW11dGV4X2xvY2soJnBhZ2VzLT5tdXRleCk7Cj4gKwkJcmMg
PSBpb3B0X2FyZWFfZmlsbF9kb21haW4oYXJlYSwgZG9tYWluKTsKPiArCQlpZiAocmMpIHsKPiAr
CQkJbXV0ZXhfdW5sb2NrKCZwYWdlcy0+bXV0ZXgpOwo+ICsJCQlnb3RvIG91dF91bmZpbGw7Cj4g
KwkJfQo+ICsJCWlmICghYXJlYS0+c3RvcmFnZV9kb21haW4pIHsKPiArCQkJV0FSTl9PTihpb3B0
LT5uZXh0X2RvbWFpbl9pZCAhPSAwKTsKPiArCQkJYXJlYS0+c3RvcmFnZV9kb21haW4gPSBkb21h
aW47Cj4gKwkJCWludGVydmFsX3RyZWVfaW5zZXJ0KCZhcmVhLT5wYWdlc19ub2RlLAo+ICsJCQkJ
CSAgICAgJnBhZ2VzLT5kb21haW5zX2l0cmVlKTsKPiArCQl9Cj4gKwkJbXV0ZXhfdW5sb2NrKCZw
YWdlcy0+bXV0ZXgpOwo+ICsJfQo+ICsJcmV0dXJuIDA7Cj4gKwo+ICtvdXRfdW5maWxsOgo+ICsJ
ZW5kX2FyZWEgPSBhcmVhOwo+ICsJZm9yIChhcmVhID0gaW9wdF9hcmVhX2l0ZXJfZmlyc3QoaW9w
dCwgMCwgVUxPTkdfTUFYKTsgYXJlYTsKPiArCSAgICAgYXJlYSA9IGlvcHRfYXJlYV9pdGVyX25l
eHQoYXJlYSwgMCwgVUxPTkdfTUFYKSkgewo+ICsJCXN0cnVjdCBpb3B0X3BhZ2VzICpwYWdlcyA9
IGFyZWEtPnBhZ2VzOwo+ICsKPiArCQlpZiAoYXJlYSA9PSBlbmRfYXJlYSkKPiArCQkJYnJlYWs7
Cj4gKwkJaWYgKFdBUk5fT04oIXBhZ2VzKSkKPiArCQkJY29udGludWU7Cj4gKwkJbXV0ZXhfbG9j
aygmcGFnZXMtPm11dGV4KTsKPiArCQlpZiAoaW9wdC0+bmV4dF9kb21haW5faWQgPT0gMCkgewo+
ICsJCQlpbnRlcnZhbF90cmVlX3JlbW92ZSgmYXJlYS0+cGFnZXNfbm9kZSwKPiArCQkJCQkgICAg
ICZwYWdlcy0+ZG9tYWluc19pdHJlZSk7Cj4gKwkJCWFyZWEtPnN0b3JhZ2VfZG9tYWluID0gTlVM
TDsKPiArCQl9Cj4gKwkJaW9wdF9hcmVhX3VuZmlsbF9kb21haW4oYXJlYSwgcGFnZXMsIGRvbWFp
bik7Cj4gKwkJbXV0ZXhfdW5sb2NrKCZwYWdlcy0+bXV0ZXgpOwo+ICsJfQo+ICsJcmV0dXJuIHJj
Owo+ICt9Cj4gKwo+ICsvKiBBbGwgZXhpc3RpbmcgYXJlYSdzIGNvbmZvcm0gdG8gYW4gaW5jcmVh
c2VkIHBhZ2Ugc2l6ZSAqLwo+ICtzdGF0aWMgaW50IGlvcHRfY2hlY2tfaW92YV9hbGlnbm1lbnQo
c3RydWN0IGlvX3BhZ2V0YWJsZSAqaW9wdCwKPiArCQkJCSAgICAgdW5zaWduZWQgbG9uZyBuZXdf
aW92YV9hbGlnbm1lbnQpCj4gK3sKPiArCXN0cnVjdCBpb3B0X2FyZWEgKmFyZWE7Cj4gKwo+ICsJ
bG9ja2RlcF9hc3NlcnRfaGVsZCgmaW9wdC0+aW92YV9yd3NlbSk7Cj4gKwo+ICsJZm9yIChhcmVh
ID0gaW9wdF9hcmVhX2l0ZXJfZmlyc3QoaW9wdCwgMCwgVUxPTkdfTUFYKTsgYXJlYTsKPiArCSAg
ICAgYXJlYSA9IGlvcHRfYXJlYV9pdGVyX25leHQoYXJlYSwgMCwgVUxPTkdfTUFYKSkKPiArCQlp
ZiAoKGlvcHRfYXJlYV9pb3ZhKGFyZWEpICUgbmV3X2lvdmFfYWxpZ25tZW50KSB8fAo+ICsJCSAg
ICAoaW9wdF9hcmVhX2xlbmd0aChhcmVhKSAlIG5ld19pb3ZhX2FsaWdubWVudCkpCj4gKwkJCXJl
dHVybiAtRUFERFJJTlVTRTsKPiArCXJldHVybiAwOwo+ICt9Cj4gKwo+ICtpbnQgaW9wdF90YWJs
ZV9hZGRfZG9tYWluKHN0cnVjdCBpb19wYWdldGFibGUgKmlvcHQsCj4gKwkJCSAgc3RydWN0IGlv
bW11X2RvbWFpbiAqZG9tYWluKQo+ICt7Cj4gKwljb25zdCBzdHJ1Y3QgaW9tbXVfZG9tYWluX2dl
b21ldHJ5ICpnZW9tZXRyeSA9ICZkb21haW4tPmdlb21ldHJ5Owo+ICsJc3RydWN0IGlvbW11X2Rv
bWFpbiAqaXRlcl9kb21haW47Cj4gKwl1bnNpZ25lZCBpbnQgbmV3X2lvdmFfYWxpZ25tZW50Owo+
ICsJdW5zaWduZWQgbG9uZyBpbmRleDsKPiArCWludCByYzsKPiArCj4gKwlkb3duX3dyaXRlKCZp
b3B0LT5kb21haW5zX3J3c2VtKTsKPiArCWRvd25fd3JpdGUoJmlvcHQtPmlvdmFfcndzZW0pOwo+
ICsKPiArCXhhX2Zvcl9lYWNoICgmaW9wdC0+ZG9tYWlucywgaW5kZXgsIGl0ZXJfZG9tYWluKSB7
Cj4gKwkJaWYgKFdBUk5fT04oaXRlcl9kb21haW4gPT0gZG9tYWluKSkgewo+ICsJCQlyYyA9IC1F
RVhJU1Q7Cj4gKwkJCWdvdG8gb3V0X3VubG9jazsKPiArCQl9Cj4gKwl9Cj4gKwo+ICsJLyoKPiAr
CSAqIFRoZSBpbyBwYWdlIHNpemUgZHJpdmVzIHRoZSBpb3ZhX2FsaWdubWVudC4gSW50ZXJuYWxs
eSB0aGUgaW9wdF9wYWdlcwo+ICsJICogd29ya3MgaW4gUEFHRV9TSVpFIHVuaXRzIGFuZCB3ZSBh
ZGp1c3Qgd2hlbiBtYXBwaW5nIHN1Yi1QQUdFX1NJWkUKPiArCSAqIG9iamVjdHMgaW50byB0aGUg
aW9tbXVfZG9tYWluLgo+ICsJICoKPiArCSAqIEEgaW9tbXVfZG9tYWluIG11c3QgYWx3YXlzIGJl
IGFibGUgdG8gYWNjZXB0IFBBR0VfU0laRSB0byBiZQo+ICsJICogY29tcGF0aWJsZSBhcyB3ZSBj
YW4ndCBndWFyYW50ZWUgaGlnaGVyIGNvbnRpZ3VpdHkuCj4gKwkgKi8KPiArCW5ld19pb3ZhX2Fs
aWdubWVudCA9Cj4gKwkJbWF4X3QodW5zaWduZWQgbG9uZywgMVVMIDw8IF9fZmZzKGRvbWFpbi0+
cGdzaXplX2JpdG1hcCksCj4gKwkJICAgICAgaW9wdC0+aW92YV9hbGlnbm1lbnQpOwo+ICsJaWYg
KG5ld19pb3ZhX2FsaWdubWVudCA+IFBBR0VfU0laRSkgewo+ICsJCXJjID0gLUVJTlZBTDsKPiAr
CQlnb3RvIG91dF91bmxvY2s7Cj4gKwl9Cj4gKwlpZiAobmV3X2lvdmFfYWxpZ25tZW50ICE9IGlv
cHQtPmlvdmFfYWxpZ25tZW50KSB7Cj4gKwkJcmMgPSBpb3B0X2NoZWNrX2lvdmFfYWxpZ25tZW50
KGlvcHQsIG5ld19pb3ZhX2FsaWdubWVudCk7Cj4gKwkJaWYgKHJjKQo+ICsJCQlnb3RvIG91dF91
bmxvY2s7Cj4gKwl9Cj4gKwo+ICsJLyogTm8gYXJlYSBleGlzdHMgdGhhdCBpcyBvdXRzaWRlIHRo
ZSBhbGxvd2VkIGRvbWFpbiBhcGVydHVyZSAqLwo+ICsJaWYgKGdlb21ldHJ5LT5hcGVydHVyZV9z
dGFydCAhPSAwKSB7Cj4gKwkJcmMgPSBpb3B0X3Jlc2VydmVfaW92YShpb3B0LCAwLCBnZW9tZXRy
eS0+YXBlcnR1cmVfc3RhcnQgLSAxLAo+ICsJCQkJICAgICAgIGRvbWFpbik7Cj4gKwkJaWYgKHJj
KQo+ICsJCQlnb3RvIG91dF9yZXNlcnZlZDsKPiArCX0KPiArCWlmIChnZW9tZXRyeS0+YXBlcnR1
cmVfZW5kICE9IFVMT05HX01BWCkgewo+ICsJCXJjID0gaW9wdF9yZXNlcnZlX2lvdmEoaW9wdCwg
Z2VvbWV0cnktPmFwZXJ0dXJlX2VuZCArIDEsCj4gKwkJCQkgICAgICAgVUxPTkdfTUFYLCBkb21h
aW4pOwo+ICsJCWlmIChyYykKPiArCQkJZ290byBvdXRfcmVzZXJ2ZWQ7Cj4gKwl9Cj4gKwo+ICsJ
cmMgPSB4YV9yZXNlcnZlKCZpb3B0LT5kb21haW5zLCBpb3B0LT5uZXh0X2RvbWFpbl9pZCwgR0ZQ
X0tFUk5FTCk7Cj4gKwlpZiAocmMpCj4gKwkJZ290byBvdXRfcmVzZXJ2ZWQ7Cj4gKwo+ICsJcmMg
PSBpb3B0X2ZpbGxfZG9tYWluKGlvcHQsIGRvbWFpbik7Cj4gKwlpZiAocmMpCj4gKwkJZ290byBv
dXRfcmVsZWFzZTsKPiArCj4gKwlpb3B0LT5pb3ZhX2FsaWdubWVudCA9IG5ld19pb3ZhX2FsaWdu
bWVudDsKPiArCXhhX3N0b3JlKCZpb3B0LT5kb21haW5zLCBpb3B0LT5uZXh0X2RvbWFpbl9pZCwg
ZG9tYWluLCBHRlBfS0VSTkVMKTsKPiArCWlvcHQtPm5leHRfZG9tYWluX2lkKys7Ck5vdCB1bmRl
cnN0YW5kIGhlcmUuCgpEbyB3ZSBnZXQgdGhlIGRvbWFpbiA9IHhhX2xvYWQoJmlvcHQtPmRvbWFp
bnMsIGlvcHQtPm5leHRfZG9tYWluX2lkLTEpPwpUaGVuIGhvdyB0byBnZXQgdGhlIGRvbWFpbiBp
ZiBuZXh0X2RvbWFpbl9pZCsrLgpGb3IgZXhhbXBsZSwgaW9wdF90YWJsZV9hZGRfZG9tYWluIDMg
dGltZXMgd2l0aCAzIGRvbWFpbnMsCmhvdyB0byBrbm93IHdoaWNoIG5leHRfZG9tYWluX2lkIGlz
IHRoZSBjb3JyZWN0IG9uZS4KClRoYW5rcwpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwppb21tdSBtYWlsaW5nIGxpc3QKaW9tbXVAbGlzdHMubGludXgtZm91
bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlz
dGluZm8vaW9tbXU=

