Return-Path: <iommu-bounces@lists.linux-foundation.org>
X-Original-To: lists.iommu@lfdr.de
Delivered-To: lists.iommu@lfdr.de
Received: from mail.linuxfoundation.org (mail.linuxfoundation.org [140.211.169.12])
	by mail.lfdr.de (Postfix) with ESMTPS id E4A68E36A3
	for <lists.iommu@lfdr.de>; Thu, 24 Oct 2019 17:28:01 +0200 (CEST)
Received: from mail.linux-foundation.org (localhost [127.0.0.1])
	by mail.linuxfoundation.org (Postfix) with ESMTP id 96F6F1911;
	Thu, 24 Oct 2019 15:27:57 +0000 (UTC)
X-Original-To: iommu@lists.linux-foundation.org
Delivered-To: iommu@mail.linuxfoundation.org
Received: from smtp1.linuxfoundation.org (smtp1.linux-foundation.org
	[172.17.192.35])
	by mail.linuxfoundation.org (Postfix) with ESMTPS id 55F191908
	for <iommu@lists.linux-foundation.org>;
	Thu, 24 Oct 2019 15:27:56 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
	by smtp1.linuxfoundation.org (Postfix) with ESMTP id B16FE8A7
	for <iommu@lists.linux-foundation.org>;
	Thu, 24 Oct 2019 15:27:55 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
	by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 3E95931F;
	Thu, 24 Oct 2019 08:27:55 -0700 (PDT)
Received: from [10.1.38.214] (e121487-lin.cambridge.arm.com [10.1.38.214])
	by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id E1FA83F71F;
	Thu, 24 Oct 2019 08:27:53 -0700 (PDT)
Subject: Re: [BUG] dma-ranges, reserved memory regions, dma_alloc_coherent:
	possible bug?
To: Alexandre Torgue <alexandre.torgue@st.com>,
	Robin Murphy <robin.murphy@arm.com>,
	Daniele Alessandrelli <daniele.alessandrelli@gmail.com>,
	Christoph Hellwig <hch@lst.de>, Marek Szyprowski <m.szyprowski@samsung.com>
References: <CAA2QUqLv+eLXuA_TdJ7zM4oBnGoFVOjRjAimuct2y=0MDuaZVQ@mail.gmail.com>
	<d983cf57-f13d-a680-21c4-09b5ca93bc64@arm.com>
	<acf0dd2c-7e12-fba6-b7f8-dfd78c892fe5@arm.com>
	<417fa080-08f9-9f35-687b-c0b82a61628d@arm.com>
	<376133e3-25f2-ffe7-ef9f-4613388b2bf7@arm.com>
	<84747008-85e9-e71a-b9ad-cefcc6c0f661@st.com>
From: Vladimir Murzin <vladimir.murzin@arm.com>
Message-ID: <3305c91e-e630-b7fd-4c6f-598583504d67@arm.com>
Date: Thu, 24 Oct 2019 16:27:52 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <84747008-85e9-e71a-b9ad-cefcc6c0f661@st.com>
Content-Language: en-US
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00 autolearn=ham
	version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	smtp1.linux-foundation.org
Cc: iommu@lists.linux-foundation.org, Arnd Bergmann <arnd@arndb.de>
X-BeenThere: iommu@lists.linux-foundation.org
X-Mailman-Version: 2.1.12
Precedence: list
List-Id: Development issues for Linux IOMMU support
	<iommu.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/iommu>,
	<mailto:iommu-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/iommu/>
List-Post: <mailto:iommu@lists.linux-foundation.org>
List-Help: <mailto:iommu-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/iommu>,
	<mailto:iommu-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: iommu-bounces@lists.linux-foundation.org
Errors-To: iommu-bounces@lists.linux-foundation.org

SGkgQWxleCwKCk9uIDEwLzI0LzE5IDQ6MjAgUE0sIEFsZXhhbmRyZSBUb3JndWUgd3JvdGU6Cj4g
SGkgVmxhZCwKPiAKPiBPbiAxMC8yNC8xOSAyOjQzIFBNLCBWbGFkaW1pciBNdXJ6aW4gd3JvdGU6
Cj4+IE9uIDEwLzE3LzE5IDEwOjQ2IEFNLCBWbGFkaW1pciBNdXJ6aW4gd3JvdGU6Cj4+PiBJJ20g
d29uZGVyaW5nIGlmIEkndmUgbWlzc2VkIHNvbWV0aGluZyB3aXRoIGRpZmYgYmVsbG93IChpdCB3
YXMgYSBsb25nIHRpbWUgYWdvIHdoZW4gSSB0b3VjaGVkIERNQSk/Cj4+Cj4+IEFueSBjb21tZW50
cyBvbiB0aGF0PyBJIGNhbiBvbmx5IGJ1aWxkIHRlc3QgaXQsIHNvIGxhY2sgb2YgdGVzdGluZyBz
dG9wcGluZyBtZSBmcm9tIHNlbmRpbmcgaXQgYXMgYQo+PiBwcm9wZXIgcGF0Y2ggOigKPiAKPiBJ
IGNhbiBtYWtlIHNvbWUgdGVzdHMgdG9tb3Jyb3cuIFdoaWNoIHBhcnRpY3VsYXIgc2V0dXAgSSBu
ZWVkIHRvIHRlc3Q6IGNvcnRleCBNNyArIGNhY2hlICsgZG1hICsgeGlwID8gTGV0IG1lIGtub3cu
CgpJIGFzc3VtZSB4aXAgaW1wbGllcyBkbWEtcmFuZ2VzIGluIGR0LCB0aGVuIHllcyBpdCBsb29r
cyBsaWtlIHdoYXQgd2UgbmVlZC4KCkdyZWF0IHRoYW5rcyEKClZsYWRpbWlyCgo+IAo+IHJlZ2Fy
ZHMKPiBhbGV4Cj4gCj4+Cj4+Pgo+Pj4gZGlmZiAtLWdpdCBhL2FyY2gvYXJtL21tL2RtYS1tYXBw
aW5nLW5vbW11LmMgYi9hcmNoL2FybS9tbS9kbWEtbWFwcGluZy1ub21tdS5jCj4+PiBpbmRleCBk
YjkyNDc4Li4yODdlZjg5IDEwMDY0NAo+Pj4gLS0tIGEvYXJjaC9hcm0vbW0vZG1hLW1hcHBpbmct
bm9tbXUuYwo+Pj4gKysrIGIvYXJjaC9hcm0vbW0vZG1hLW1hcHBpbmctbm9tbXUuYwo+Pj4gQEAg
LTM1LDcgKzM1LDcgQEAgc3RhdGljIHZvaWQgKmFybV9ub21tdV9kbWFfYWxsb2Moc3RydWN0IGRl
dmljZSAqZGV2LCBzaXplX3Qgc2l6ZSwKPj4+IMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDC
oMKgwqDCoCB1bnNpZ25lZCBsb25nIGF0dHJzKQo+Pj4gwqAgwqAgewo+Pj4gLcKgwqDCoCB2b2lk
ICpyZXQgPSBkbWFfYWxsb2NfZnJvbV9nbG9iYWxfY29oZXJlbnQoc2l6ZSwgZG1hX2hhbmRsZSk7
Cj4+PiArwqDCoMKgIHZvaWQgKnJldCA9IGRtYV9hbGxvY19mcm9tX2dsb2JhbF9jb2hlcmVudChk
ZXYsIHNpemUsIGRtYV9oYW5kbGUpOwo+Pj4gwqAgwqDCoMKgwqDCoCAvKgo+Pj4gwqDCoMKgwqDC
oMKgICogZG1hX2FsbG9jX2Zyb21fZ2xvYmFsX2NvaGVyZW50KCkgbWF5IGZhaWwgYmVjYXVzZToK
Pj4+IGRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1tYXBwaW5nLmggYi9pbmNsdWRlL2xp
bnV4L2RtYS1tYXBwaW5nLmgKPj4+IGluZGV4IDRhMWM0ZmMuLjEwOTE4YzUgMTAwNjQ0Cj4+PiAt
LS0gYS9pbmNsdWRlL2xpbnV4L2RtYS1tYXBwaW5nLmgKPj4+ICsrKyBiL2luY2x1ZGUvbGludXgv
ZG1hLW1hcHBpbmcuaAo+Pj4gQEAgLTE2Miw3ICsxNjIsNyBAQCBpbnQgZG1hX3JlbGVhc2VfZnJv
bV9kZXZfY29oZXJlbnQoc3RydWN0IGRldmljZSAqZGV2LCBpbnQgb3JkZXIsIHZvaWQgKnZhZGRy
KTsKPj4+IMKgIGludCBkbWFfbW1hcF9mcm9tX2Rldl9jb2hlcmVudChzdHJ1Y3QgZGV2aWNlICpk
ZXYsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLAo+Pj4gwqDCoMKgwqDCoMKgwqDCoMKgwqDC
oMKgwqDCoMKgwqDCoCB2b2lkICpjcHVfYWRkciwgc2l6ZV90IHNpemUsIGludCAqcmV0KTsKPj4+
IMKgIC12b2lkICpkbWFfYWxsb2NfZnJvbV9nbG9iYWxfY29oZXJlbnQoc3NpemVfdCBzaXplLCBk
bWFfYWRkcl90ICpkbWFfaGFuZGxlKTsKPj4+ICt2b2lkICpkbWFfYWxsb2NfZnJvbV9nbG9iYWxf
Y29oZXJlbnQoc3RydWN0IGRldmljZSAqZGV2LCBzc2l6ZV90IHNpemUsIGRtYV9hZGRyX3QgKmRt
YV9oYW5kbGUpOwo+Pj4gwqAgaW50IGRtYV9yZWxlYXNlX2Zyb21fZ2xvYmFsX2NvaGVyZW50KGlu
dCBvcmRlciwgdm9pZCAqdmFkZHIpOwo+Pj4gwqAgaW50IGRtYV9tbWFwX2Zyb21fZ2xvYmFsX2Nv
aGVyZW50KHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLCB2b2lkICpjcHVfYWRkciwKPj4+IMKg
wqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgIHNpemVfdCBzaXplLCBpbnQgKnJl
dCk7Cj4+PiBAQCAtMTcyLDcgKzE3Miw3IEBAIGludCBkbWFfbW1hcF9mcm9tX2dsb2JhbF9jb2hl
cmVudChzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwgdm9pZCAqY3B1X2FkZHIsCj4+PiDCoCAj
ZGVmaW5lIGRtYV9yZWxlYXNlX2Zyb21fZGV2X2NvaGVyZW50KGRldiwgb3JkZXIsIHZhZGRyKSAo
MCkKPj4+IMKgICNkZWZpbmUgZG1hX21tYXBfZnJvbV9kZXZfY29oZXJlbnQoZGV2LCB2bWEsIHZh
ZGRyLCBvcmRlciwgcmV0KSAoMCkKPj4+IMKgIC1zdGF0aWMgaW5saW5lIHZvaWQgKmRtYV9hbGxv
Y19mcm9tX2dsb2JhbF9jb2hlcmVudChzc2l6ZV90IHNpemUsCj4+PiArc3RhdGljIGlubGluZSB2
b2lkICpkbWFfYWxsb2NfZnJvbV9nbG9iYWxfY29oZXJlbnQoc3RydWN0IGRldmljZSAqZGV2LCBz
c2l6ZV90IHNpemUsCj4+PiDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKg
wqDCoMKgwqDCoMKgwqDCoCBkbWFfYWRkcl90ICpkbWFfaGFuZGxlKQo+Pj4gwqAgewo+Pj4gwqDC
oMKgwqDCoCByZXR1cm4gTlVMTDsKPj4+IGRpZmYgLS1naXQgYS9rZXJuZWwvZG1hL2NvaGVyZW50
LmMgYi9rZXJuZWwvZG1hL2NvaGVyZW50LmMKPj4+IGluZGV4IDU0NWUzODYuLjU1MWIwZWIgMTAw
NjQ0Cj4+PiAtLS0gYS9rZXJuZWwvZG1hL2NvaGVyZW50LmMKPj4+ICsrKyBiL2tlcm5lbC9kbWEv
Y29oZXJlbnQuYwo+Pj4gQEAgLTEyMyw4ICsxMjMsOSBAQCBpbnQgZG1hX2RlY2xhcmVfY29oZXJl
bnRfbWVtb3J5KHN0cnVjdCBkZXZpY2UgKmRldiwgcGh5c19hZGRyX3QgcGh5c19hZGRyLAo+Pj4g
wqDCoMKgwqDCoCByZXR1cm4gcmV0Owo+Pj4gwqAgfQo+Pj4gwqAgLXN0YXRpYyB2b2lkICpfX2Rt
YV9hbGxvY19mcm9tX2NvaGVyZW50KHN0cnVjdCBkbWFfY29oZXJlbnRfbWVtICptZW0sCj4+PiAt
wqDCoMKgwqDCoMKgwqAgc3NpemVfdCBzaXplLCBkbWFfYWRkcl90ICpkbWFfaGFuZGxlKQo+Pj4g
K3N0YXRpYyB2b2lkICpfX2RtYV9hbGxvY19mcm9tX2NvaGVyZW50KHN0cnVjdCBkZXZpY2UgKmRl
diwKPj4+ICvCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoCBzdHJ1
Y3QgZG1hX2NvaGVyZW50X21lbSAqbWVtLAo+Pj4gK8KgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKg
wqDCoMKgwqDCoMKgwqDCoMKgIHNzaXplX3Qgc2l6ZSwgZG1hX2FkZHJfdCAqZG1hX2hhbmRsZSkK
Pj4+IMKgIHsKPj4+IMKgwqDCoMKgwqAgaW50IG9yZGVyID0gZ2V0X29yZGVyKHNpemUpOwo+Pj4g
wqDCoMKgwqDCoCB1bnNpZ25lZCBsb25nIGZsYWdzOwo+Pj4gQEAgLTE0Myw3ICsxNDQsNyBAQCBz
dGF0aWMgdm9pZCAqX19kbWFfYWxsb2NfZnJvbV9jb2hlcmVudChzdHJ1Y3QgZG1hX2NvaGVyZW50
X21lbSAqbWVtLAo+Pj4gwqDCoMKgwqDCoCAvKgo+Pj4gwqDCoMKgwqDCoMKgICogTWVtb3J5IHdh
cyBmb3VuZCBpbiB0aGUgY29oZXJlbnQgYXJlYS4KPj4+IMKgwqDCoMKgwqDCoCAqLwo+Pj4gLcKg
wqDCoCAqZG1hX2hhbmRsZSA9IG1lbS0+ZGV2aWNlX2Jhc2UgKyAocGFnZW5vIDw8IFBBR0VfU0hJ
RlQpOwo+Pj4gK8KgwqDCoCAqZG1hX2hhbmRsZSA9IGRtYV9nZXRfZGV2aWNlX2Jhc2UoZGV2LCBt
ZW0pICsgKHBhZ2VubyA8PCBQQUdFX1NISUZUKTsKPj4+IMKgwqDCoMKgwqAgcmV0ID0gbWVtLT52
aXJ0X2Jhc2UgKyAocGFnZW5vIDw8IFBBR0VfU0hJRlQpOwo+Pj4gwqDCoMKgwqDCoCBzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZtZW0tPnNwaW5sb2NrLCBmbGFncyk7Cj4+PiDCoMKgwqDCoMKgIG1l
bXNldChyZXQsIDAsIHNpemUpOwo+Pj4gQEAgLTE3NSwxNyArMTc2LDE4IEBAIGludCBkbWFfYWxs
b2NfZnJvbV9kZXZfY29oZXJlbnQoc3RydWN0IGRldmljZSAqZGV2LCBzc2l6ZV90IHNpemUsCj4+
PiDCoMKgwqDCoMKgIGlmICghbWVtKQo+Pj4gwqDCoMKgwqDCoMKgwqDCoMKgIHJldHVybiAwOwo+
Pj4gwqAgLcKgwqDCoCAqcmV0ID0gX19kbWFfYWxsb2NfZnJvbV9jb2hlcmVudChtZW0sIHNpemUs
IGRtYV9oYW5kbGUpOwo+Pj4gK8KgwqDCoCAqcmV0ID0gX19kbWFfYWxsb2NfZnJvbV9jb2hlcmVu
dChkZXYsIG1lbSwgc2l6ZSwgZG1hX2hhbmRsZSk7Cj4+PiDCoMKgwqDCoMKgIHJldHVybiAxOwo+
Pj4gwqAgfQo+Pj4gwqAgLXZvaWQgKmRtYV9hbGxvY19mcm9tX2dsb2JhbF9jb2hlcmVudChzc2l6
ZV90IHNpemUsIGRtYV9hZGRyX3QgKmRtYV9oYW5kbGUpCj4+PiArdm9pZCAqZG1hX2FsbG9jX2Zy
b21fZ2xvYmFsX2NvaGVyZW50KHN0cnVjdCBkZXZpY2UgKmRldiwgc3NpemVfdCBzaXplLAo+Pj4g
K8KgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqAgZG1hX2FkZHJfdCAqZG1h
X2hhbmRsZSkKPj4+IMKgIHsKPj4+IMKgwqDCoMKgwqAgaWYgKCFkbWFfY29oZXJlbnRfZGVmYXVs
dF9tZW1vcnkpCj4+PiDCoMKgwqDCoMKgwqDCoMKgwqAgcmV0dXJuIE5VTEw7Cj4+PiDCoCAtwqDC
oMKgIHJldHVybiBfX2RtYV9hbGxvY19mcm9tX2NvaGVyZW50KGRtYV9jb2hlcmVudF9kZWZhdWx0
X21lbW9yeSwgc2l6ZSwKPj4+IC3CoMKgwqDCoMKgwqDCoMKgwqDCoMKgIGRtYV9oYW5kbGUpOwo+
Pj4gK8KgwqDCoCByZXR1cm4gX19kbWFfYWxsb2NfZnJvbV9jb2hlcmVudChkZXYsIGRtYV9jb2hl
cmVudF9kZWZhdWx0X21lbW9yeSwgc2l6ZSwKPj4+ICvCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDC
oMKgwqDCoMKgwqDCoMKgIGRtYV9oYW5kbGUpOwo+Pj4gwqAgfQo+Pj4gwqAgwqAgc3RhdGljIGlu
dCBfX2RtYV9yZWxlYXNlX2Zyb21fY29oZXJlbnQoc3RydWN0IGRtYV9jb2hlcmVudF9tZW0gKm1l
bSwKPj4KPj4KPj4gVGhhbmtzCj4+IFZsYWRpbWlyCj4+CgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwppb21tdSBtYWlsaW5nIGxpc3QKaW9tbXVAbGlzdHMu
bGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21h
aWxtYW4vbGlzdGluZm8vaW9tbXU=
