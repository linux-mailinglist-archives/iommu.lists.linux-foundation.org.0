Return-Path: <iommu-bounces@lists.linux-foundation.org>
X-Original-To: lists.iommu@lfdr.de
Delivered-To: lists.iommu@lfdr.de
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id CC9AC2F8AB7
	for <lists.iommu@lfdr.de>; Sat, 16 Jan 2021 03:24:19 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by whitealder.osuosl.org (Postfix) with ESMTP id 61BB48690B;
	Sat, 16 Jan 2021 02:24:18 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id ZPGEepJwmMOM; Sat, 16 Jan 2021 02:24:16 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by whitealder.osuosl.org (Postfix) with ESMTP id 8E04F8691D;
	Sat, 16 Jan 2021 02:24:16 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 738E7C013A;
	Sat, 16 Jan 2021 02:24:16 +0000 (UTC)
X-Original-To: iommu@lists.linux-foundation.org
Delivered-To: iommu@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 736A0C013A
 for <iommu@lists.linux-foundation.org>; Sat, 16 Jan 2021 02:24:14 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id 58963872A6
 for <iommu@lists.linux-foundation.org>; Sat, 16 Jan 2021 02:24:14 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id s-z9KiNQR0F5 for <iommu@lists.linux-foundation.org>;
 Sat, 16 Jan 2021 02:24:12 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from szxga07-in.huawei.com (szxga07-in.huawei.com [45.249.212.35])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 5881F8722F
 for <iommu@lists.linux-foundation.org>; Sat, 16 Jan 2021 02:24:12 +0000 (UTC)
Received: from DGGEMS401-HUB.china.huawei.com (unknown [172.30.72.60])
 by szxga07-in.huawei.com (SkyGuard) with ESMTP id 4DHhfd6TSPz7TyV;
 Sat, 16 Jan 2021 10:23:05 +0800 (CST)
Received: from [127.0.0.1] (10.40.193.166) by DGGEMS401-HUB.china.huawei.com
 (10.3.19.201) with Microsoft SMTP Server id 14.3.498.0; Sat, 16 Jan 2021
 10:24:00 +0800
Subject: Re: [PATCH v13 08/15] iommu/smmuv3: Implement cache_invalidate
To: <iommu@lists.linux-foundation.org>
References: <20201118112151.25412-1-eric.auger@redhat.com>
 <20201118112151.25412-9-eric.auger@redhat.com>
From: "chenxiang (M)" <chenxiang66@hisilicon.com>
Message-ID: <c405d689-aea5-c9eb-d418-ec5a30a97fa6@hisilicon.com>
Date: Sat, 16 Jan 2021 10:24:00 +0800
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:45.0) Gecko/20100101
 Thunderbird/45.2.0
MIME-Version: 1.0
In-Reply-To: <20201118112151.25412-9-eric.auger@redhat.com>
X-Originating-IP: [10.40.193.166]
X-CFilter-Loop: Reflected
Cc: linuxarm@openeuler.org
X-BeenThere: iommu@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Development issues for Linux IOMMU support
 <iommu.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/iommu/>
List-Post: <mailto:iommu@lists.linux-foundation.org>
List-Help: <mailto:iommu-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: iommu-bounces@lists.linux-foundation.org
Sender: "iommu" <iommu-bounces@lists.linux-foundation.org>

SGkgRXJpYywKCgrlnKggMjAyMC8xMS8xOCAxOToyMSwgRXJpYyBBdWdlciDlhpnpgZM6Cj4gSW1w
bGVtZW50IGRvbWFpbi1zZWxlY3RpdmUgYW5kIHBhZ2Utc2VsZWN0aXZlIElPVExCIGludmFsaWRh
dGlvbnMuCj4KPiBTaWduZWQtb2ZmLWJ5OiBFcmljIEF1Z2VyIDxlcmljLmF1Z2VyQHJlZGhhdC5j
b20+Cj4KPiAtLS0KPiB2NyAtPiB2ODoKPiAtIEFTSUQgYmFzZWQgaW52YWxpZGF0aW9uIHVzaW5n
IGlvbW11X2ludl9wYXNpZF9pbmZvCj4gLSBjaGVjayBBUkNISUQvUEFTSUQgZmxhZ3MgaW4gYWRk
ciBiYXNlZCBpbnZhbGlkYXRpb24KPiAtIHVzZSBfX2FybV9zbW11X3RsYl9pbnZfY29udGV4dCBh
bmQgX19hcm1fc21tdV90bGJfaW52X3JhbmdlX25vc3luYwo+Cj4gdjYgLT4gdjcKPiAtIGNoZWNr
IHRoZSB1YXBpIHZlcnNpb24KPgo+IHYzIC0+IHY0Ogo+IC0gYWRhcHQgdG8gY2hhbmdlcyBpbiB0
aGUgdWFwaQo+IC0gYWRkIHN1cHBvcnQgZm9yIGxlYWYgcGFyYW1ldGVyCj4gLSBkbyBub3QgdXNl
IGFybV9zbW11X3RsYl9pbnZfcmFuZ2Vfbm9zeW5jIG9yIGFybV9zbW11X3RsYl9pbnZfY29udGV4
dAo+ICAgIGFueW1vcmUKPgo+IHYyIC0+IHYzOgo+IC0gcmVwbGFjZSBfX2FybV9zbW11X3RsYl9z
eW5jIGJ5IGFybV9zbW11X2NtZHFfaXNzdWVfc3luYwo+Cj4gdjEgLT4gdjI6Cj4gLSBwcm9wZXJs
eSBwYXNzIHRoZSBhc2lkCj4gLS0tCj4gICBkcml2ZXJzL2lvbW11L2FybS9hcm0tc21tdS12My9h
cm0tc21tdS12My5jIHwgNTMgKysrKysrKysrKysrKysrKysrKysrCj4gICAxIGZpbGUgY2hhbmdl
ZCwgNTMgaW5zZXJ0aW9ucygrKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvaW9tbXUvYXJtL2Fy
bS1zbW11LXYzL2FybS1zbW11LXYzLmMgYi9kcml2ZXJzL2lvbW11L2FybS9hcm0tc21tdS12My9h
cm0tc21tdS12My5jCj4gaW5kZXggZmRlY2M5ZjE3YjM2Li4yNDEyNDM2MWRkM2IgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9pb21tdS9hcm0vYXJtLXNtbXUtdjMvYXJtLXNtbXUtdjMuYwo+ICsrKyBi
L2RyaXZlcnMvaW9tbXUvYXJtL2FybS1zbW11LXYzL2FybS1zbW11LXYzLmMKPiBAQCAtMjc3MSw2
ICsyNzcxLDU4IEBAIHN0YXRpYyB2b2lkIGFybV9zbW11X2RldGFjaF9wYXNpZF90YWJsZShzdHJ1
Y3QgaW9tbXVfZG9tYWluICpkb21haW4pCj4gICAJbXV0ZXhfdW5sb2NrKCZzbW11X2RvbWFpbi0+
aW5pdF9tdXRleCk7Cj4gICB9Cj4gICAKPiArc3RhdGljIGludAo+ICthcm1fc21tdV9jYWNoZV9p
bnZhbGlkYXRlKHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbiwgc3RydWN0IGRldmljZSAqZGV2
LAo+ICsJCQkgIHN0cnVjdCBpb21tdV9jYWNoZV9pbnZhbGlkYXRlX2luZm8gKmludl9pbmZvKQo+
ICt7Cj4gKwlzdHJ1Y3QgYXJtX3NtbXVfZG9tYWluICpzbW11X2RvbWFpbiA9IHRvX3NtbXVfZG9t
YWluKGRvbWFpbik7Cj4gKwlzdHJ1Y3QgYXJtX3NtbXVfZGV2aWNlICpzbW11ID0gc21tdV9kb21h
aW4tPnNtbXU7Cj4gKwo+ICsJaWYgKHNtbXVfZG9tYWluLT5zdGFnZSAhPSBBUk1fU01NVV9ET01B
SU5fTkVTVEVEKQo+ICsJCXJldHVybiAtRUlOVkFMOwo+ICsKPiArCWlmICghc21tdSkKPiArCQly
ZXR1cm4gLUVJTlZBTDsKPiArCj4gKwlpZiAoaW52X2luZm8tPnZlcnNpb24gIT0gSU9NTVVfQ0FD
SEVfSU5WQUxJREFURV9JTkZPX1ZFUlNJT05fMSkKPiArCQlyZXR1cm4gLUVJTlZBTDsKPiArCj4g
KwlpZiAoaW52X2luZm8tPmNhY2hlICYgSU9NTVVfQ0FDSEVfSU5WX1RZUEVfSU9UTEIpIHsKPiAr
CQlpZiAoaW52X2luZm8tPmdyYW51bGFyaXR5ID09IElPTU1VX0lOVl9HUkFOVV9QQVNJRCkgewo+
ICsJCQlzdHJ1Y3QgaW9tbXVfaW52X3Bhc2lkX2luZm8gKmluZm8gPQo+ICsJCQkJJmludl9pbmZv
LT5ncmFudS5wYXNpZF9pbmZvOwo+ICsKPiArCQkJaWYgKCEoaW5mby0+ZmxhZ3MgJiBJT01NVV9J
TlZfUEFTSURfRkxBR1NfQVJDSElEKSB8fAo+ICsJCQkgICAgIChpbmZvLT5mbGFncyAmIElPTU1V
X0lOVl9QQVNJRF9GTEFHU19QQVNJRCkpCj4gKwkJCQlyZXR1cm4gLUVJTlZBTDsKPiArCj4gKwkJ
CV9fYXJtX3NtbXVfdGxiX2ludl9jb250ZXh0KHNtbXVfZG9tYWluLCBpbmZvLT5hcmNoaWQpOwo+
ICsKPiArCQl9IGVsc2UgaWYgKGludl9pbmZvLT5ncmFudWxhcml0eSA9PSBJT01NVV9JTlZfR1JB
TlVfQUREUikgewo+ICsJCQlzdHJ1Y3QgaW9tbXVfaW52X2FkZHJfaW5mbyAqaW5mbyA9ICZpbnZf
aW5mby0+Z3JhbnUuYWRkcl9pbmZvOwo+ICsJCQlzaXplX3Qgc2l6ZSA9IGluZm8tPm5iX2dyYW51
bGVzICogaW5mby0+Z3JhbnVsZV9zaXplOwo+ICsJCQlib29sIGxlYWYgPSBpbmZvLT5mbGFncyAm
IElPTU1VX0lOVl9BRERSX0ZMQUdTX0xFQUY7Cj4gKwo+ICsJCQlpZiAoIShpbmZvLT5mbGFncyAm
IElPTU1VX0lOVl9BRERSX0ZMQUdTX0FSQ0hJRCkgfHwKPiArCQkJICAgICAoaW5mby0+ZmxhZ3Mg
JiBJT01NVV9JTlZfQUREUl9GTEFHU19QQVNJRCkpCj4gKwkJCQlyZXR1cm4gLUVJTlZBTDsKPiAr
Cj4gKwkJCV9fYXJtX3NtbXVfdGxiX2ludl9yYW5nZShpbmZvLT5hZGRyLCBzaXplLAo+ICsJCQkJ
CQkgaW5mby0+Z3JhbnVsZV9zaXplLCBsZWFmLAo+ICsJCQkJCQkgIHNtbXVfZG9tYWluLCBpbmZv
LT5hcmNoaWQpOwoKV2hlbiBkZWJ1Z2dpbmcgd2l0aCB2U01NVSBvbiBBUk02NCBodWF3ZWkgcGxh
dGZvcm0sICB0aGVyZSBpcyBhIGlzc3VlOiAgClJJTCBmZWF0dXJlIGlzIGVuYWJsZWQgb24gZ3Vl
c3QgT1Mgd2hpbGUgaXQgaXMgbm90IHN1cHBvcnRlZCBvbiBob3N0IApPUywgIHdpdGggc29tZSBv
cGVyYXRpb25zCihzdWNoIGFzIHJtbW9kIGRyaXZlciBkdXJpbmcgaXBlcmYgYmV0d2VlbiBndWVz
dCBhbmQgaG9zdCksIFNNTVUgCnRyYW5zbGF0aW9uIGVycm9yIG9jY3VycyBmcmVxdWVudGx5LCBh
bmQgaXQgd29ya3Mgd2VsbCBpZiBSSUwgZmVhdHVyZSBpcyAKZGlzYWJsZWQgb24gZ3Vlc3QgT1Mu
CldlIGZpbmQgdGhhdCBpbiBmdW5jdGlvbiB2ZmlvX2lvbW11X3VubWFwX25vdGlmeSgpIChxZW11
IGNvZGUpIGl0IHBhc3NlcyAKdG90YWwgc2l6ZSBvZiB0bGIgKG51bV9wYWdlcyAqIGdyYW51bGVf
c2l6ZSkgYXMgZ3JhbnVsZSBzaXplIHRvIGhvc3QgT1MgOgphZGRyX2luZm8tPmdyYW51bGVzX3Np
emUgPSBzaXplCmFkZHJfaW5mby0+bmJfZ3JhbnVsZSA9IDEKU28gdG90YWwgc2l6ZSAobnVtX3Bh
Z2VzICogZ3JhbnVsZV9zaXplKSBpcyBwYXNzZWQgYXMgZ3JhbnVsZSBzaXplIHRvIApmdW5jdGlv
biBfX2FybV9zbW11X2ludl9yYW5nZSgpLCBpZiBSSUwgZmVhdHVyZSBpcyBub3Qgc3VwcG9ydGVk
LCB0aGVuIAp0b3RhbCBzaXplIG1heSBiZSBub3QKdGhlIGdyYW51bGUgc2l6ZSB0aGF0IGhvc3Qg
T1MgY2FuIHJlY29uZ2l6ZSwgaSB3aWxsIG9ubHkgaW52YWxpZGF0ZSBwYXJ0IApvZiB0bGIgaXQg
d2FudHMgdG8gaW52YWxpZGF0ZSAoZm9yIGV4YW1wbGUsIDRLLzJNLzFHIHBhZ2VzaXplIGlzIApz
dXBwb3J0ZWQgb24gaG9zdCBPUywgIGlmIHRvdGFsX3NpemUgPSA4SywgdGhlbiBhZGRyX2luZm8t
PmdyYW51bGVfc2l6ZSAKPSA4SywKYWRkcl9pbmZvLT5uYl9ncmFudWxlID0gMSwgYXMgUklMIGZl
YXR1cmUgaXMgbm90IHN1cHBvcnRlZCwgaXQgCmludmFsaWRhdGVzIGp1c3QgNEsgb25lIHRpbWUg
YnV0IGl0IHRob3VnaHQgaXQgaGFkIGludmFsaWRhdGVkIDhLKS4KUGxlYXNlIGhhdmUgYSBjaGVj
ayBvZiB0aGUgaXNzdWUsIGFuZCB3ZSBoYXZlIGEgdGVtcG9yYXJ5IGZpeCBhcyBmb2xsb3dzIApv
biB0aGUgaXNzdWUuCgpody9hcm0vc21tdXYzLmMgICAgICAgfCAzICsrLQogIGh3L3ZmaW8vY29t
bW9uLmMgICAgICB8IDYgKysrLS0tCiAgaW5jbHVkZS9leGVjL21lbW9yeS5oIHwgMSArCiAgMyBm
aWxlcyBjaGFuZ2VkLCA2IGluc2VydGlvbnMoKyksIDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvaHcvYXJtL3NtbXV2My5jIGIvaHcvYXJtL3NtbXV2My5jCmluZGV4IDY3MjUwMTkuLjg5MWE2
NWQgMTAwNjQ0Ci0tLSBhL2h3L2FybS9zbW11djMuYworKysgYi9ody9hcm0vc21tdXYzLmMKQEAg
LTgyMSw3ICs4MjEsOCBAQCBzdGF0aWMgdm9pZCBzbW11djNfbm90aWZ5X2lvdmEoSU9NTVVNZW1v
cnlSZWdpb24gKm1yLAoKICAgICAgZW50cnkudGFyZ2V0X2FzID0gJmFkZHJlc3Nfc3BhY2VfbWVt
b3J5OwogICAgICBlbnRyeS5pb3ZhID0gaW92YTsKLSAgICBlbnRyeS5hZGRyX21hc2sgPSBudW1f
cGFnZXMgKiAoMSA8PCBncmFudWxlKSAtIDE7CisgICAgZW50cnkuYWRkcl9tYXNrID0gKDEgPDwg
Z3JhbnVsZSkgLSAxOworICAgIGVudHJ5Lm51bV9wYWdlcyA9IG51bV9wYWdlczsKICAgICAgZW50
cnkucGVybSA9IElPTU1VX05PTkU7CiAgICAgIGVudHJ5LmFyY2hfaWQgPSBhc2lkOwogICAgICBl
bnRyeS5mbGFncyA9IElPTU1VX0lOVl9HUkFOVV9BRERSOwpkaWZmIC0tZ2l0IGEvaHcvdmZpby9j
b21tb24uYyBiL2h3L3ZmaW8vY29tbW9uLmMKaW5kZXggNWQzNjVlMC4uYzAxNjRiMSAxMDA2NDQK
LS0tIGEvaHcvdmZpby9jb21tb24uYworKysgYi9ody92ZmlvL2NvbW1vbi5jCkBAIC02MDQsNyAr
NjA0LDcgQEAgc3RhdGljIHZvaWQgdmZpb19pb21tdV91bm1hcF9ub3RpZnkoSU9NTVVOb3RpZmll
ciAKKm4sIElPTU1VVExCRW50cnkgKmlvdGxiKQogICAgICBod2FkZHIgc3RhcnQgPSBpb3RsYi0+
aW92YSArIGdpb21tdS0+aW9tbXVfb2Zmc2V0OwogICAgICBWRklPQ29udGFpbmVyICpjb250YWlu
ZXIgPSBnaW9tbXUtPmNvbnRhaW5lcjsKICAgICAgc3RydWN0IHZmaW9faW9tbXVfdHlwZTFfY2Fj
aGVfaW52YWxpZGF0ZSB1c3RydWN0ID0ge307Ci0gICAgc2l6ZV90IHNpemUgPSBpb3RsYi0+YWRk
cl9tYXNrICsgMTsKKyAgICBzaXplX3Qgc2l6ZSA9IGlvdGxiLT5udW1fcGFnZXMgKiAoaW90bGIt
PmFkZHJfbWFzayArIDEpOwogICAgICBpbnQgcmV0OwoKICAgICAgYXNzZXJ0KGlvdGxiLT5wZXJt
ID09IElPTU1VX05PTkUpOwpAQCAtNjMyLDggKzYzMiw4IEBAIHN0YXRpYyB2b2lkIHZmaW9faW9t
bXVfdW5tYXBfbm90aWZ5KElPTU1VTm90aWZpZXIgCipuLCBJT01NVVRMQkVudHJ5ICppb3RsYikK
ICAgICAgICAgIH0KICAgICAgICAgIGFkZHJfaW5mby0+YXJjaGlkID0gaW90bGItPmFyY2hfaWQ7
CiAgICAgICAgICBhZGRyX2luZm8tPmFkZHIgPSBzdGFydDsKLSAgICAgICAgYWRkcl9pbmZvLT5n
cmFudWxlX3NpemUgPSBzaXplOwotICAgICAgICBhZGRyX2luZm8tPm5iX2dyYW51bGVzID0gMTsK
KyAgICAgICAgYWRkcl9pbmZvLT5ncmFudWxlX3NpemUgPSBpb3RsYi0+YWRkcl9tYXNrICsgMTsK
KyAgICAgICAgYWRkcl9pbmZvLT5uYl9ncmFudWxlcyA9IGlvdGxiLT5udW1fcGFnZXM7CiAgICAg
IH0KICAgICAgdHJhY2VfdmZpb19pb21tdV9hZGRyX2ludl9pb3RsYihpb3RsYi0+YXJjaF9pZCwg
c3RhcnQsIHNpemUsIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW90
bGItPmxlYWYpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9leGVjL21lbW9yeS5oIGIvaW5jbHVkZS9l
eGVjL21lbW9yeS5oCmluZGV4IDIxOTU5YTcuLmFhOGQ0M2UgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
ZXhlYy9tZW1vcnkuaAorKysgYi9pbmNsdWRlL2V4ZWMvbWVtb3J5LmgKQEAgLTEwMyw2ICsxMDMs
NyBAQCBzdHJ1Y3QgSU9NTVVUTEJFbnRyeSB7CiAgICAgIGh3YWRkciAgICAgICAgICAgaW92YTsK
ICAgICAgaHdhZGRyICAgICAgICAgICB0cmFuc2xhdGVkX2FkZHI7CiAgICAgIGh3YWRkciAgICAg
ICAgICAgYWRkcl9tYXNrOworICAgIHVpbnQ2NF90ICAgICAgICAgbnVtX3BhZ2VzOwogICAgICBJ
T01NVUFjY2Vzc0ZsYWdzIHBlcm07CiAgICAgIHVpbnQzMl90ICAgICAgICAgYXJjaF9pZDsKICAg
ICAgdWludDMyX3QgICAgICAgICBmbGFnczsKCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KaW9tbXUgbWFpbGluZyBsaXN0CmlvbW11QGxpc3RzLmxpbnV4
LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2lvbW11
