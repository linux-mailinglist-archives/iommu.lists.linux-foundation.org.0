Return-Path: <iommu-bounces@lists.linux-foundation.org>
X-Original-To: lists.iommu@lfdr.de
Delivered-To: lists.iommu@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
	by mail.lfdr.de (Postfix) with ESMTPS id 6046640B29E
	for <lists.iommu@lfdr.de>; Tue, 14 Sep 2021 17:10:51 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id D41D86061A;
	Tue, 14 Sep 2021 15:10:49 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id mUyVIiPphCF9; Tue, 14 Sep 2021 15:10:47 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 85C036073D;
	Tue, 14 Sep 2021 15:10:47 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 55413C001E;
	Tue, 14 Sep 2021 15:10:47 +0000 (UTC)
X-Original-To: iommu@lists.linux-foundation.org
Delivered-To: iommu@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id B570DC000D
 for <iommu@lists.linux-foundation.org>; Tue, 14 Sep 2021 15:10:45 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id A39C260715
 for <iommu@lists.linux-foundation.org>; Tue, 14 Sep 2021 15:10:45 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id FE7-DCekt1Um for <iommu@lists.linux-foundation.org>;
 Tue, 14 Sep 2021 15:10:42 +0000 (UTC)
X-Greylist: whitelisted by SQLgrey-1.8.0
Received: from mail-lj1-x230.google.com (mail-lj1-x230.google.com
 [IPv6:2a00:1450:4864:20::230])
 by smtp3.osuosl.org (Postfix) with ESMTPS id 9CD136061A
 for <iommu@lists.linux-foundation.org>; Tue, 14 Sep 2021 15:10:41 +0000 (UTC)
Received: by mail-lj1-x230.google.com with SMTP id s3so24514159ljp.11
 for <iommu@lists.linux-foundation.org>; Tue, 14 Sep 2021 08:10:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20210112;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=+K8MjtcnJXfpNCRFyMCdqNnPKrcaeccqs3rzyDDn0vU=;
 b=IaMh1odM3L3VhmQ1m9aeZoRN0SQqI1qWvuDoZWK+kGl0yYbfmDEi7D0j2oLe14UX2F
 rpjUo3lsxP5Ys1zoUPhUxacNkXBGHhKp/VWLcn3VaR1IZbD/wkmOEHytFa0NiO1XV0aE
 O1GlE5Y2v46M+6SUc2NpFvRok3ihp3e/rfYBP921FLdN2x2npuwD6bPz9uzlrrgVeYu9
 m+iuYgMs/d2E2Nt8Vhc0NLSoGg6tG917T7wzGKqoVsqJs2NYLv7TzW6UM3OszHB4dLXY
 pfJbHa0qySjo55aBIDzrsH27D5ycEHqJnZOlX1euImWJ1nEKFy+itmgG9ixUnlRxJzzs
 +oDA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=+K8MjtcnJXfpNCRFyMCdqNnPKrcaeccqs3rzyDDn0vU=;
 b=WlO37x9YDajWbgD2Xp1yT+5yDSFiqEpSgZXHZqWzizedfDtWlcESWV4H9ZX9n2uyA1
 x763YNvts/XORjBW0Hi9TafwTETLURCYhxVBtThbhIZi/jgpkJcGnBJr4d9JfsPTTWtB
 XNI5xDVMh0GZxyFbkds7UXc9xc5f2hnB3FjSoV+g8AwD0hp2wLHtYUJRXieWivmONH74
 QSsudLAfNbbGKi/+VoRJhjS+GaSOLh/dXzu2JWN9FMGDJ48SFJQxqzFFnMaG/XmDuudM
 0K/mZLabF4d3GC/kNUMQ6X5g4ki6ydLmfXnxpG4LQ4T8gZOPF+QhUa3AM4ZbhIdD7GNv
 xU0w==
X-Gm-Message-State: AOAM532RzhPLsMDWhupWciI6F0S9zBM4YR5U7a6e5GD54HanBALbzD4X
 Doqx9N9B8OOZlemK1ER9/kU=
X-Google-Smtp-Source: ABdhPJzf6vLVIOTdmCQu5RbgpN6oC/S/5GVuhLuSFjpLP9tVLZKCDmzH0tCMHS1catjmI7HUw5NlUA==
X-Received: by 2002:a05:651c:1410:: with SMTP id
 u16mr15749408lje.435.1631632239102; 
 Tue, 14 Sep 2021 08:10:39 -0700 (PDT)
Received: from localhost ([178.151.124.169])
 by smtp.gmail.com with ESMTPSA id z13sm1380486ljo.37.2021.09.14.08.10.37
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Tue, 14 Sep 2021 08:10:38 -0700 (PDT)
From: Roman Skakun <rm.skakun@gmail.com>
X-Google-Original-From: Roman Skakun <Roman_Skakun@epam.com>
To: xen-devel@lists.xenproject.org, linux-mips@vger.kernel.org,
 linuxppc-dev@lists.ozlabs.org, linux-doc@vger.kernel.org,
 linux-kernel@vger.kernel.org, iommu@lists.linux-foundation.org
Subject: [PATCH] swiotlb: set IO TLB segment size via cmdline
Date: Tue, 14 Sep 2021 18:10:11 +0300
Message-Id: <20210914151016.3174924-1-Roman_Skakun@epam.com>
X-Mailer: git-send-email 2.27.0
MIME-Version: 1.0
Cc: Roman Skakun <rm.skakun@gmail.com>, Peter Zijlstra <peterz@infradead.org>,
 Viresh Kumar <viresh.kumar@linaro.org>, Paul Mackerras <paulus@samba.org>,
 Will Deacon <will@kernel.org>, Boris Ostrovsky <boris.ostrovsky@oracle.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Jonathan Corbet <corbet@lwn.net>,
 Michael Ellerman <mpe@ellerman.id.au>, Christoph Hellwig <hch@lst.de>,
 Benjamin Herrenschmidt <benh@kernel.crashing.org>,
 "Paul E. McKenney" <paulmck@kernel.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 Muchun Song <songmuchun@bytedance.com>, Thomas Gleixner <tglx@linutronix.de>,
 Juergen Gross <jgross@suse.com>,
 Thomas Bogendoerfer <tsbogend@alpha.franken.de>,
 Andrii Anisov <andrii_anisov@epam.com>, Randy Dunlap <rdunlap@infradead.org>,
 Roman Skakun <roman_skakun@epam.com>,
 Andrew Morton <akpm@linux-foundation.org>, Robin Murphy <robin.murphy@arm.com>,
 Mike Rapoport <rppt@kernel.org>, "Maciej W. Rozycki" <macro@orcam.me.uk>
X-BeenThere: iommu@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Development issues for Linux IOMMU support
 <iommu.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/iommu/>
List-Post: <mailto:iommu@lists.linux-foundation.org>
List-Help: <mailto:iommu-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: iommu-bounces@lists.linux-foundation.org
Sender: "iommu" <iommu-bounces@lists.linux-foundation.org>

RnJvbTogUm9tYW4gU2tha3VuIDxyb21hbl9za2FrdW5AZXBhbS5jb20+CgpJdCBpcyBwb3NzaWJs
ZSB3aGVuIGRlZmF1bHQgSU8gVExCIHNpemUgaXMgbm90CmVub3VnaCB0byBmaXQgYSBsb25nIGJ1
ZmZlcnMgYXMgZGVzY3JpYmVkIGhlcmUgWzFdLgoKVGhpcyBwYXRjaCBtYWtlcyBhIHdheSB0byBz
ZXQgdGhpcyBwYXJhbWV0ZXIKdXNpbmcgY21kbGluZSBpbnN0ZWFkIG9mIHJlY29tcGlsaW5nIGEg
a2VybmVsLgoKWzFdIGh0dHBzOi8vd3d3LnhpbGlueC5jb20vc3VwcG9ydC9hbnN3ZXJzLzcyNjk0
Lmh0bWwKClNpZ25lZC1vZmYtYnk6IFJvbWFuIFNrYWt1biA8cm9tYW5fc2tha3VuQGVwYW0uY29t
PgotLS0KIC4uLi9hZG1pbi1ndWlkZS9rZXJuZWwtcGFyYW1ldGVycy50eHQgICAgICAgICB8ICA1
ICstCiBhcmNoL21pcHMvY2F2aXVtLW9jdGVvbi9kbWEtb2N0ZW9uLmMgICAgICAgICAgfCAgMiAr
LQogYXJjaC9wb3dlcnBjL3BsYXRmb3Jtcy9wc2VyaWVzL3N2bS5jICAgICAgICAgIHwgIDIgKy0K
IGRyaXZlcnMveGVuL3N3aW90bGIteGVuLmMgICAgICAgICAgICAgICAgICAgICB8ICA3ICstLQog
aW5jbHVkZS9saW51eC9zd2lvdGxiLmggICAgICAgICAgICAgICAgICAgICAgIHwgIDEgKwoga2Vy
bmVsL2RtYS9zd2lvdGxiLmMgICAgICAgICAgICAgICAgICAgICAgICAgIHwgNTEgKysrKysrKysr
KysrKystLS0tLQogNiBmaWxlcyBjaGFuZ2VkLCA0OCBpbnNlcnRpb25zKCspLCAyMCBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL2FkbWluLWd1aWRlL2tlcm5lbC1wYXJh
bWV0ZXJzLnR4dCBiL0RvY3VtZW50YXRpb24vYWRtaW4tZ3VpZGUva2VybmVsLXBhcmFtZXRlcnMu
dHh0CmluZGV4IDkxYmEzOTFmOWIzMi4uZjg0MmE1MjNhNDg1IDEwMDY0NAotLS0gYS9Eb2N1bWVu
dGF0aW9uL2FkbWluLWd1aWRlL2tlcm5lbC1wYXJhbWV0ZXJzLnR4dAorKysgYi9Eb2N1bWVudGF0
aW9uL2FkbWluLWd1aWRlL2tlcm5lbC1wYXJhbWV0ZXJzLnR4dApAQCAtNTU1OCw4ICs1NTU4LDkg
QEAKIAkJCWl0IGlmIDAgaXMgZ2l2ZW4gKFNlZSBEb2N1bWVudGF0aW9uL2FkbWluLWd1aWRlL2Nn
cm91cC12MS9tZW1vcnkucnN0KQogCiAJc3dpb3RsYj0JW0FSTSxJQS02NCxQUEMsTUlQUyxYODZd
Ci0JCQlGb3JtYXQ6IHsgPGludD4gfCBmb3JjZSB8IG5vZm9yY2UgfQotCQkJPGludD4gLS0gTnVt
YmVyIG9mIEkvTyBUTEIgc2xhYnMKKwkJCUZvcm1hdDogeyA8c2xhYnM+IFssPGlvX3RsYl9zZWdt
ZW50X3NpemU+XSBbLGZvcmNlIHwgbm9mb3JjZV3igIsgfQorCQkJPHNsYWJzPiAtLSBOdW1iZXIg
b2YgSS9PIFRMQiBzbGFicworCQkJPGlvX3RsYl9zZWdtZW50X3NpemU+IC0tIE1heCBJTyBUTEIg
c2VnbWVudCBzaXplCiAJCQlmb3JjZSAtLSBmb3JjZSB1c2luZyBvZiBib3VuY2UgYnVmZmVycyBl
dmVuIGlmIHRoZXkKIAkJCSAgICAgICAgIHdvdWxkbid0IGJlIGF1dG9tYXRpY2FsbHkgdXNlZCBi
eSB0aGUga2VybmVsCiAJCQlub2ZvcmNlIC0tIE5ldmVyIHVzZSBib3VuY2UgYnVmZmVycyAoZm9y
IGRlYnVnZ2luZykKZGlmZiAtLWdpdCBhL2FyY2gvbWlwcy9jYXZpdW0tb2N0ZW9uL2RtYS1vY3Rl
b24uYyBiL2FyY2gvbWlwcy9jYXZpdW0tb2N0ZW9uL2RtYS1vY3Rlb24uYwppbmRleCBkZjcwMzA4
ZGIwZTYuLjQ0NmM3M2JjOTM2ZSAxMDA2NDQKLS0tIGEvYXJjaC9taXBzL2Nhdml1bS1vY3Rlb24v
ZG1hLW9jdGVvbi5jCisrKyBiL2FyY2gvbWlwcy9jYXZpdW0tb2N0ZW9uL2RtYS1vY3Rlb24uYwpA
QCAtMjM3LDcgKzIzNyw3IEBAIHZvaWQgX19pbml0IHBsYXRfc3dpb3RsYl9zZXR1cCh2b2lkKQog
CQlzd2lvdGxic2l6ZSA9IDY0ICogKDE8PDIwKTsKICNlbmRpZgogCXN3aW90bGJfbnNsYWJzID0g
c3dpb3RsYnNpemUgPj4gSU9fVExCX1NISUZUOwotCXN3aW90bGJfbnNsYWJzID0gQUxJR04oc3dp
b3RsYl9uc2xhYnMsIElPX1RMQl9TRUdTSVpFKTsKKwlzd2lvdGxiX25zbGFicyA9IEFMSUdOKHN3
aW90bGJfbnNsYWJzLCBzd2lvdGxiX2lvX3NlZ19zaXplKCkpOwogCXN3aW90bGJzaXplID0gc3dp
b3RsYl9uc2xhYnMgPDwgSU9fVExCX1NISUZUOwogCiAJb2N0ZW9uX3N3aW90bGIgPSBtZW1ibG9j
a19hbGxvY19sb3coc3dpb3RsYnNpemUsIFBBR0VfU0laRSk7CmRpZmYgLS1naXQgYS9hcmNoL3Bv
d2VycGMvcGxhdGZvcm1zL3BzZXJpZXMvc3ZtLmMgYi9hcmNoL3Bvd2VycGMvcGxhdGZvcm1zL3Bz
ZXJpZXMvc3ZtLmMKaW5kZXggODdmMDAxYjRjNGU0Li4yYTFmMDljNzIyYWMgMTAwNjQ0Ci0tLSBh
L2FyY2gvcG93ZXJwYy9wbGF0Zm9ybXMvcHNlcmllcy9zdm0uYworKysgYi9hcmNoL3Bvd2VycGMv
cGxhdGZvcm1zL3BzZXJpZXMvc3ZtLmMKQEAgLTQ3LDcgKzQ3LDcgQEAgdm9pZCBfX2luaXQgc3Zt
X3N3aW90bGJfaW5pdCh2b2lkKQogCXVuc2lnbmVkIGxvbmcgYnl0ZXMsIGlvX3RsYl9uc2xhYnM7
CiAKIAlpb190bGJfbnNsYWJzID0gKHN3aW90bGJfc2l6ZV9vcl9kZWZhdWx0KCkgPj4gSU9fVExC
X1NISUZUKTsKLQlpb190bGJfbnNsYWJzID0gQUxJR04oaW9fdGxiX25zbGFicywgSU9fVExCX1NF
R1NJWkUpOworCWlvX3RsYl9uc2xhYnMgPSBBTElHTihpb190bGJfbnNsYWJzLCBzd2lvdGxiX2lv
X3NlZ19zaXplKCkpOwogCiAJYnl0ZXMgPSBpb190bGJfbnNsYWJzIDw8IElPX1RMQl9TSElGVDsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy94ZW4vc3dpb3RsYi14ZW4uYyBiL2RyaXZlcnMveGVuL3N3
aW90bGIteGVuLmMKaW5kZXggNjQzZmU0NDBjNDZlLi4wZmM5YzZjYjY4MTUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMveGVuL3N3aW90bGIteGVuLmMKKysrIGIvZHJpdmVycy94ZW4vc3dpb3RsYi14ZW4u
YwpAQCAtMTEwLDEyICsxMTAsMTMgQEAgc3RhdGljIGludCB4ZW5fc3dpb3RsYl9maXh1cCh2b2lk
ICpidWYsIHVuc2lnbmVkIGxvbmcgbnNsYWJzKQogCWludCBkbWFfYml0czsKIAlkbWFfYWRkcl90
IGRtYV9oYW5kbGU7CiAJcGh5c19hZGRyX3QgcCA9IHZpcnRfdG9fcGh5cyhidWYpOworCXVuc2ln
bmVkIGxvbmcgdGxiX3NlZ21lbnRfc2l6ZSA9IHN3aW90bGJfaW9fc2VnX3NpemUoKTsKIAotCWRt
YV9iaXRzID0gZ2V0X29yZGVyKElPX1RMQl9TRUdTSVpFIDw8IElPX1RMQl9TSElGVCkgKyBQQUdF
X1NISUZUOworCWRtYV9iaXRzID0gZ2V0X29yZGVyKHRsYl9zZWdtZW50X3NpemUgPDwgSU9fVExC
X1NISUZUKSArIFBBR0VfU0hJRlQ7CiAKIAlpID0gMDsKIAlkbyB7Ci0JCWludCBzbGFicyA9IG1p
bihuc2xhYnMgLSBpLCAodW5zaWduZWQgbG9uZylJT19UTEJfU0VHU0laRSk7CisJCWludCBzbGFi
cyA9IG1pbihuc2xhYnMgLSBpLCAodW5zaWduZWQgbG9uZyl0bGJfc2VnbWVudF9zaXplKTsKIAog
CQlkbyB7CiAJCQlyYyA9IHhlbl9jcmVhdGVfY29udGlndW91c19yZWdpb24oCkBAIC0xNTMsNyAr
MTU0LDcgQEAgc3RhdGljIGNvbnN0IGNoYXIgKnhlbl9zd2lvdGxiX2Vycm9yKGVudW0geGVuX3N3
aW90bGJfZXJyIGVycikKIAlyZXR1cm4gIiI7CiB9CiAKLSNkZWZpbmUgREVGQVVMVF9OU0xBQlMJ
CUFMSUdOKFNaXzY0TSA+PiBJT19UTEJfU0hJRlQsIElPX1RMQl9TRUdTSVpFKQorI2RlZmluZSBE
RUZBVUxUX05TTEFCUwkJQUxJR04oU1pfNjRNID4+IElPX1RMQl9TSElGVCwgc3dpb3RsYl9pb19z
ZWdfc2l6ZSgpKQogCiBpbnQgX19yZWYgeGVuX3N3aW90bGJfaW5pdCh2b2lkKQogewpkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9saW51eC9zd2lvdGxiLmggYi9pbmNsdWRlL2xpbnV4L3N3aW90bGIuaApp
bmRleCBiMGNiMmE5OTczZjQuLjM1YzNmZmVkYTlmYSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51
eC9zd2lvdGxiLmgKKysrIGIvaW5jbHVkZS9saW51eC9zd2lvdGxiLmgKQEAgLTU5LDYgKzU5LDcg
QEAgdm9pZCBzd2lvdGxiX3N5bmNfc2luZ2xlX2Zvcl9jcHUoc3RydWN0IGRldmljZSAqZGV2LCBw
aHlzX2FkZHJfdCB0bGJfYWRkciwKIAkJc2l6ZV90IHNpemUsIGVudW0gZG1hX2RhdGFfZGlyZWN0
aW9uIGRpcik7CiBkbWFfYWRkcl90IHN3aW90bGJfbWFwKHN0cnVjdCBkZXZpY2UgKmRldiwgcGh5
c19hZGRyX3QgcGh5cywKIAkJc2l6ZV90IHNpemUsIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRp
ciwgdW5zaWduZWQgbG9uZyBhdHRycyk7Cit1bnNpZ25lZCBsb25nIHN3aW90bGJfaW9fc2VnX3Np
emUodm9pZCk7CiAKICNpZmRlZiBDT05GSUdfU1dJT1RMQgogZXh0ZXJuIGVudW0gc3dpb3RsYl9m
b3JjZSBzd2lvdGxiX2ZvcmNlOwpkaWZmIC0tZ2l0IGEva2VybmVsL2RtYS9zd2lvdGxiLmMgYi9r
ZXJuZWwvZG1hL3N3aW90bGIuYwppbmRleCA4N2M0MDUxN2U4MjIuLjZiNTA1MjA2ZmMxMyAxMDA2
NDQKLS0tIGEva2VybmVsL2RtYS9zd2lvdGxiLmMKKysrIGIva2VybmVsL2RtYS9zd2lvdGxiLmMK
QEAgLTcyLDYgKzcyLDExIEBAIGVudW0gc3dpb3RsYl9mb3JjZSBzd2lvdGxiX2ZvcmNlOwogCiBz
dHJ1Y3QgaW9fdGxiX21lbSBpb190bGJfZGVmYXVsdF9tZW07CiAKKy8qCisgKiBNYXhpbXVtIElP
IFRMQiBzZWdtZW50IHNpemUuCisgKi8KK3N0YXRpYyB1bnNpZ25lZCBsb25nIGlvX3RsYl9zZWdf
c2l6ZSA9IElPX1RMQl9TRUdTSVpFOworCiAvKgogICogTWF4IHNlZ21lbnQgdGhhdCB3ZSBjYW4g
cHJvdmlkZSB3aGljaCAoaWYgcGFnZXMgYXJlIGNvbnRpbmdvdXMpIHdpbGwKICAqIG5vdCBiZSBi
b3VuY2VkICh1bmxlc3MgU1dJT1RMQl9GT1JDRSBpcyBzZXQpLgpAQCAtODEsMTUgKzg2LDMwIEBA
IHN0YXRpYyB1bnNpZ25lZCBpbnQgbWF4X3NlZ21lbnQ7CiBzdGF0aWMgdW5zaWduZWQgbG9uZyBk
ZWZhdWx0X25zbGFicyA9IElPX1RMQl9ERUZBVUxUX1NJWkUgPj4gSU9fVExCX1NISUZUOwogCiBz
dGF0aWMgaW50IF9faW5pdAotc2V0dXBfaW9fdGxiX25wYWdlcyhjaGFyICpzdHIpCitzZXR1cF9p
b190bGJfcGFyYW1zKGNoYXIgKnN0cikKIHsKKwl1bnNpZ25lZCBsb25nIHRtcDsKKwogCWlmIChp
c2RpZ2l0KCpzdHIpKSB7Ci0JCS8qIGF2b2lkIHRhaWwgc2VnbWVudCBvZiBzaXplIDwgSU9fVExC
X1NFR1NJWkUgKi8KLQkJZGVmYXVsdF9uc2xhYnMgPQotCQkJQUxJR04oc2ltcGxlX3N0cnRvdWwo
c3RyLCAmc3RyLCAwKSwgSU9fVExCX1NFR1NJWkUpOworCQlkZWZhdWx0X25zbGFicyA9IHNpbXBs
ZV9zdHJ0b3VsKHN0ciwgJnN0ciwgMCk7CiAJfQogCWlmICgqc3RyID09ICcsJykKIAkJKytzdHI7
CisKKwkvKiBnZXQgbWF4IElPIFRMQiBzZWdtZW50IHNpemUgKi8KKwlpZiAoaXNkaWdpdCgqc3Ry
KSkgeworCQl0bXAgPSBzaW1wbGVfc3RydG91bChzdHIsICZzdHIsIDApOworCQlpZiAodG1wKQor
CQkJaW9fdGxiX3NlZ19zaXplID0gQUxJR04odG1wLCBJT19UTEJfU0VHU0laRSk7CisJfQorCWlm
ICgqc3RyID09ICcsJykKKwkJKytzdHI7CisKKwkvKiB1cGRhdGUgaW9fdGxiX25zbGFicyBhZnRl
ciBhcHBseWluZyBhIG5ldyBzZWdtZW50IHNpemUgYW5kCisJICogYXZvaWQgdGFpbCBzZWdtZW50
IG9mIHNpemUgPCBJTyBUTEIgc2VnbWVudCBzaXplCisJICovCisJZGVmYXVsdF9uc2xhYnMgPSBB
TElHTihkZWZhdWx0X25zbGFicywgaW9fdGxiX3NlZ19zaXplKTsKKwogCWlmICghc3RyY21wKHN0
ciwgImZvcmNlIikpCiAJCXN3aW90bGJfZm9yY2UgPSBTV0lPVExCX0ZPUkNFOwogCWVsc2UgaWYg
KCFzdHJjbXAoc3RyLCAibm9mb3JjZSIpKQpAQCAtOTcsNyArMTE3LDcgQEAgc2V0dXBfaW9fdGxi
X25wYWdlcyhjaGFyICpzdHIpCiAKIAlyZXR1cm4gMDsKIH0KLWVhcmx5X3BhcmFtKCJzd2lvdGxi
Iiwgc2V0dXBfaW9fdGxiX25wYWdlcyk7CitlYXJseV9wYXJhbSgic3dpb3RsYiIsIHNldHVwX2lv
X3RsYl9wYXJhbXMpOwogCiB1bnNpZ25lZCBpbnQgc3dpb3RsYl9tYXhfc2VnbWVudCh2b2lkKQog
ewpAQCAtMTE4LDYgKzEzOCwxMSBAQCB1bnNpZ25lZCBsb25nIHN3aW90bGJfc2l6ZV9vcl9kZWZh
dWx0KHZvaWQpCiAJcmV0dXJuIGRlZmF1bHRfbnNsYWJzIDw8IElPX1RMQl9TSElGVDsKIH0KIAor
dW5zaWduZWQgbG9uZyBzd2lvdGxiX2lvX3NlZ19zaXplKHZvaWQpCit7CisJcmV0dXJuIGlvX3Rs
Yl9zZWdfc2l6ZTsKK30KKwogdm9pZCBfX2luaXQgc3dpb3RsYl9hZGp1c3Rfc2l6ZSh1bnNpZ25l
ZCBsb25nIHNpemUpCiB7CiAJLyoKQEAgLTEyOCw3ICsxNTMsNyBAQCB2b2lkIF9faW5pdCBzd2lv
dGxiX2FkanVzdF9zaXplKHVuc2lnbmVkIGxvbmcgc2l6ZSkKIAlpZiAoZGVmYXVsdF9uc2xhYnMg
IT0gSU9fVExCX0RFRkFVTFRfU0laRSA+PiBJT19UTEJfU0hJRlQpCiAJCXJldHVybjsKIAlzaXpl
ID0gQUxJR04oc2l6ZSwgSU9fVExCX1NJWkUpOwotCWRlZmF1bHRfbnNsYWJzID0gQUxJR04oc2l6
ZSA+PiBJT19UTEJfU0hJRlQsIElPX1RMQl9TRUdTSVpFKTsKKwlkZWZhdWx0X25zbGFicyA9IEFM
SUdOKHNpemUgPj4gSU9fVExCX1NISUZULCBpb190bGJfc2VnX3NpemUpOwogCXByX2luZm8oIlNX
SU9UTEIgYm91bmNlIGJ1ZmZlciBzaXplIGFkanVzdGVkIHRvICVsdU1CIiwgc2l6ZSA+PiAyMCk7
CiB9CiAKQEAgLTE0Nyw3ICsxNzIsNyBAQCB2b2lkIHN3aW90bGJfcHJpbnRfaW5mbyh2b2lkKQog
CiBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGxvbmcgaW9fdGxiX29mZnNldCh1bnNpZ25lZCBsb25n
IHZhbCkKIHsKLQlyZXR1cm4gdmFsICYgKElPX1RMQl9TRUdTSVpFIC0gMSk7CisJcmV0dXJuIHZh
bCAmIChpb190bGJfc2VnX3NpemUgLSAxKTsKIH0KIAogc3RhdGljIGlubGluZSB1bnNpZ25lZCBs
b25nIG5yX3Nsb3RzKHU2NCB2YWwpCkBAIC0xOTIsNyArMjE3LDcgQEAgc3RhdGljIHZvaWQgc3dp
b3RsYl9pbml0X2lvX3RsYl9tZW0oc3RydWN0IGlvX3RsYl9tZW0gKm1lbSwgcGh5c19hZGRyX3Qg
c3RhcnQsCiAKIAlzcGluX2xvY2tfaW5pdCgmbWVtLT5sb2NrKTsKIAlmb3IgKGkgPSAwOyBpIDwg
bWVtLT5uc2xhYnM7IGkrKykgewotCQltZW0tPnNsb3RzW2ldLmxpc3QgPSBJT19UTEJfU0VHU0la
RSAtIGlvX3RsYl9vZmZzZXQoaSk7CisJCW1lbS0+c2xvdHNbaV0ubGlzdCA9IGlvX3RsYl9zZWdf
c2l6ZSAtIGlvX3RsYl9vZmZzZXQoaSk7CiAJCW1lbS0+c2xvdHNbaV0ub3JpZ19hZGRyID0gSU5W
QUxJRF9QSFlTX0FERFI7CiAJCW1lbS0+c2xvdHNbaV0uYWxsb2Nfc2l6ZSA9IDA7CiAJfQpAQCAt
MjYxLDcgKzI4Niw3IEBAIGludAogc3dpb3RsYl9sYXRlX2luaXRfd2l0aF9kZWZhdWx0X3NpemUo
c2l6ZV90IGRlZmF1bHRfc2l6ZSkKIHsKIAl1bnNpZ25lZCBsb25nIG5zbGFicyA9Ci0JCUFMSUdO
KGRlZmF1bHRfc2l6ZSA+PiBJT19UTEJfU0hJRlQsIElPX1RMQl9TRUdTSVpFKTsKKwkJQUxJR04o
ZGVmYXVsdF9zaXplID4+IElPX1RMQl9TSElGVCwgaW9fdGxiX3NlZ19zaXplKTsKIAl1bnNpZ25l
ZCBsb25nIGJ5dGVzOwogCXVuc2lnbmVkIGNoYXIgKnZzdGFydCA9IE5VTEw7CiAJdW5zaWduZWQg
aW50IG9yZGVyOwpAQCAtNTIyLDcgKzU0Nyw3IEBAIHN0YXRpYyBpbnQgc3dpb3RsYl9maW5kX3Ns
b3RzKHN0cnVjdCBkZXZpY2UgKmRldiwgcGh5c19hZGRyX3Qgb3JpZ19hZGRyLAogCQkJYWxsb2Nf
c2l6ZSAtIChvZmZzZXQgKyAoKGkgLSBpbmRleCkgPDwgSU9fVExCX1NISUZUKSk7CiAJfQogCWZv
ciAoaSA9IGluZGV4IC0gMTsKLQkgICAgIGlvX3RsYl9vZmZzZXQoaSkgIT0gSU9fVExCX1NFR1NJ
WkUgLSAxICYmCisJICAgICBpb190bGJfb2Zmc2V0KGkpICE9IGlvX3RsYl9zZWdfc2l6ZSAtIDEg
JiYKIAkgICAgIG1lbS0+c2xvdHNbaV0ubGlzdDsgaS0tKQogCQltZW0tPnNsb3RzW2ldLmxpc3Qg
PSArK2NvdW50OwogCkBAIC02MDAsNyArNjI1LDcgQEAgc3RhdGljIHZvaWQgc3dpb3RsYl9yZWxl
YXNlX3Nsb3RzKHN0cnVjdCBkZXZpY2UgKmRldiwgcGh5c19hZGRyX3QgdGxiX2FkZHIpCiAJICog
d2l0aCBzbG90cyBiZWxvdyBhbmQgYWJvdmUgdGhlIHBvb2wgYmVpbmcgcmV0dXJuZWQuCiAJICov
CiAJc3Bpbl9sb2NrX2lycXNhdmUoJm1lbS0+bG9jaywgZmxhZ3MpOwotCWlmIChpbmRleCArIG5z
bG90cyA8IEFMSUdOKGluZGV4ICsgMSwgSU9fVExCX1NFR1NJWkUpKQorCWlmIChpbmRleCArIG5z
bG90cyA8IEFMSUdOKGluZGV4ICsgMSwgaW9fdGxiX3NlZ19zaXplKSkKIAkJY291bnQgPSBtZW0t
PnNsb3RzW2luZGV4ICsgbnNsb3RzXS5saXN0OwogCWVsc2UKIAkJY291bnQgPSAwOwpAQCAtNjIw
LDcgKzY0NSw3IEBAIHN0YXRpYyB2b2lkIHN3aW90bGJfcmVsZWFzZV9zbG90cyhzdHJ1Y3QgZGV2
aWNlICpkZXYsIHBoeXNfYWRkcl90IHRsYl9hZGRyKQogCSAqIGF2YWlsYWJsZSAobm9uIHplcm8p
CiAJICovCiAJZm9yIChpID0gaW5kZXggLSAxOwotCSAgICAgaW9fdGxiX29mZnNldChpKSAhPSBJ
T19UTEJfU0VHU0laRSAtIDEgJiYgbWVtLT5zbG90c1tpXS5saXN0OworCSAgICAgaW9fdGxiX29m
ZnNldChpKSAhPSBpb190bGJfc2VnX3NpemUgLSAxICYmIG1lbS0+c2xvdHNbaV0ubGlzdDsKIAkg
ICAgIGktLSkKIAkJbWVtLT5zbG90c1tpXS5saXN0ID0gKytjb3VudDsKIAltZW0tPnVzZWQgLT0g
bnNsb3RzOwpAQCAtNjk4LDcgKzcyMyw3IEBAIGRtYV9hZGRyX3Qgc3dpb3RsYl9tYXAoc3RydWN0
IGRldmljZSAqZGV2LCBwaHlzX2FkZHJfdCBwYWRkciwgc2l6ZV90IHNpemUsCiAKIHNpemVfdCBz
d2lvdGxiX21heF9tYXBwaW5nX3NpemUoc3RydWN0IGRldmljZSAqZGV2KQogewotCXJldHVybiAo
KHNpemVfdClJT19UTEJfU0laRSkgKiBJT19UTEJfU0VHU0laRTsKKwlyZXR1cm4gKChzaXplX3Qp
SU9fVExCX1NJWkUpICogaW9fdGxiX3NlZ19zaXplOwogfQogCiBib29sIGlzX3N3aW90bGJfYWN0
aXZlKHN0cnVjdCBkZXZpY2UgKmRldikKLS0gCjIuMjcuMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KaW9tbXUgbWFpbGluZyBsaXN0CmlvbW11QGxpc3Rz
LmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2lvbW11
