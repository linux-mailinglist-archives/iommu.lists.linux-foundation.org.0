Return-Path: <iommu-bounces@lists.linux-foundation.org>
X-Original-To: lists.iommu@lfdr.de
Delivered-To: lists.iommu@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id A62ED327F4C
	for <lists.iommu@lfdr.de>; Mon,  1 Mar 2021 14:20:34 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id 060DF4F23B;
	Mon,  1 Mar 2021 13:20:33 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id dVLMRZBUJg6o; Mon,  1 Mar 2021 13:20:31 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTP id 914834F22F;
	Mon,  1 Mar 2021 13:20:31 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 5E840C0001;
	Mon,  1 Mar 2021 13:20:31 +0000 (UTC)
X-Original-To: iommu@lists.linux-foundation.org
Delivered-To: iommu@lists.linuxfoundation.org
Received: from smtp4.osuosl.org (smtp4.osuosl.org [140.211.166.137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 08070C0001
 for <iommu@lists.linux-foundation.org>; Mon,  1 Mar 2021 13:20:30 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp4.osuosl.org (Postfix) with ESMTP id EA59C4F23C
 for <iommu@lists.linux-foundation.org>; Mon,  1 Mar 2021 13:20:29 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
 by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id n7rHWQXB6xWq for <iommu@lists.linux-foundation.org>;
 Mon,  1 Mar 2021 13:20:28 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by smtp4.osuosl.org (Postfix) with ESMTP id 790E64F22D
 for <iommu@lists.linux-foundation.org>; Mon,  1 Mar 2021 13:20:28 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 9B38C1FB;
 Mon,  1 Mar 2021 05:20:27 -0800 (PST)
Received: from [10.57.48.219] (unknown [10.57.48.219])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 0845A3F70D;
 Mon,  1 Mar 2021 05:20:25 -0800 (PST)
Subject: Re: [PATCH 1/1] Revert "iommu/iova: Retry from last rb tree node if
 iova search fails"
To: John Garry <john.garry@huawei.com>,
 "Leizhen (ThunderTown)" <thunder.leizhen@huawei.com>,
 Will Deacon <will@kernel.org>, Joerg Roedel <joro@8bytes.org>,
 iommu <iommu@lists.linux-foundation.org>,
 linux-kernel <linux-kernel@vger.kernel.org>
References: <20210129092120.1482-1-thunder.leizhen@huawei.com>
 <5505b1e5-2450-d5c4-6d77-5bb21fd0b6a1@huawei.com>
 <e8ff095f-7b7c-da38-3675-cd3c1ee84b1a@arm.com>
 <7e18829a-3e7e-cc82-9d33-366cf2025624@huawei.com>
From: Robin Murphy <robin.murphy@arm.com>
Message-ID: <4c634a22-7168-b51c-a012-2009fc03e6c3@arm.com>
Date: Mon, 1 Mar 2021 13:20:19 +0000
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101
 Thunderbird/78.7.1
MIME-Version: 1.0
In-Reply-To: <7e18829a-3e7e-cc82-9d33-366cf2025624@huawei.com>
Content-Language: en-GB
Cc: Vijayanand Jitta <vjitta@codeaurora.org>, Linuxarm <linuxarm@huawei.com>
X-BeenThere: iommu@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Development issues for Linux IOMMU support
 <iommu.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/iommu/>
List-Post: <mailto:iommu@lists.linux-foundation.org>
List-Help: <mailto:iommu-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/iommu>,
 <mailto:iommu-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: iommu-bounces@lists.linux-foundation.org
Sender: "iommu" <iommu-bounces@lists.linux-foundation.org>

T24gMjAyMS0wMi0yNSAxMzo1NCwgSm9obiBHYXJyeSB3cm90ZToKPiBPbiAyOS8wMS8yMDIxIDEy
OjAzLCBSb2JpbiBNdXJwaHkgd3JvdGU6Cj4+IE9uIDIwMjEtMDEtMjkgMDk6NDgsIExlaXpoZW4g
KFRodW5kZXJUb3duKSB3cm90ZToKPj4+Cj4+PiBDdXJyZW50bHksIHdlIGFyZSB0aGlua2luZyBh
Ym91dCB0aGUgc29sdXRpb24gdG8gdGhlIHByb2JsZW0uIAo+Pj4gSG93ZXZlciwgYmVjYXVzZSB0
aGUgZW5kIHRpbWUgb2YgdjUuMTEgaXMgYXBwcm9hY2hpbmcsIHRoaXMgcGF0Y2ggaXMgCj4+PiBz
ZW50IGZpcnN0Lgo+Pgo+PiBIb3dldmVyLCB0aGF0IGNvbW1pdCB3YXMgbWFkZSBmb3IgYSByZWFz
b24gLSBob3cgZG8gd2UganVzdGlmeSB0aGF0IAo+PiBvbmUgdGhpbmcgYmVpbmcgc2xvdyBpcyBt
b3JlIGltcG9ydGFudCB0aGFuIGFub3RoZXIgdGhpbmcgYmVpbmcgCj4+IGNvbXBsZXRlbHkgYnJv
a2VuPyBJdCdzIG5vdCBwcmFjdGljYWwgdG8ganVzdCBrZWVwIGRvaW5nIHRoZSBwYXRjaCAKPj4g
aG9rZXktY29rZXkgYmFzZWQgb24gd2hvZXZlciBzaG91dHMgbG91ZGVzdCA6KAo+Pgo+Pj4gT24g
MjAyMS8xLzI5IDE3OjIxLCBaaGVuIExlaSB3cm90ZToKPj4+PiBUaGlzIHJldmVydHMgY29tbWl0
IDRlODlkY2U3MjUyMTNkM2QwYjA0NzUyMTFiNTAwZWRhNGVmNGJmMmYuCj4+Pj4KPj4+PiBXZSBm
aW5kIHRoYXQgdGhpcyBwYXRjaCBoYXMgYSBncmVhdCBpbXBhY3Qgb24gcGVyZm9ybWFuY2UuIEFj
Y29yZGluZyB0bwo+Pj4+IG91ciB0ZXN0OiB0aGUgaW9wcyBkZWNyZWFzZXMgZnJvbSAxNjU1LjZL
IHRvIDg5My41SywgYWJvdXQgaGFsZi4KPj4+Pgo+Pj4+IEhhcmR3YXJlOiAxIFNBUyBleHBhbmRl
ciB3aXRoIDEyIFNBUyBTU0QKPj4+PiBDb21tYW5kOsKgIE9ubHkgdGhlIG1haW4gcGFyYW1ldGVy
cyBhcmUgbGlzdGVkLgo+Pj4+IMKgwqDCoMKgwqDCoMKgwqDCoMKgIGZpbyBicz00ayBydz1yZWFk
IGlvZGVwdGg9MTI4IGNwdXNfYWxsb3dlZD0wLTEyNwo+Pgo+PiBGV0lXLCBJJ20gOTklIHN1cmUg
dGhhdCB3aGF0IHlvdSByZWFsbHkgd2FudCBpcyBbMV0sIGJ1dCB0aGVuIHlvdSBnZXQgCj4+IHRv
IGJhdHRsZSBhZ2FpbnN0IGFuIHVua25vd24gcXVhbnRpdHkgb2YgZG9kZ3kgZmlybXdhcmUgaW5z
dGVhZC4KPj4KPiAKPiBTb21ldGhpbmcgd2hpY2ggaGFzIG5vdCBiZWVuIHNhaWQgYmVmb3JlIGlz
IHRoYXQgdGhpcyBvbmx5IGhhcHBlbnMgZm9yIAo+IHN0cmljdCBtb2RlLgoKSSB0aGluayB0aGF0
IG1ha2VzIHNlbnNlIC0gb25jZSB5b3UgKmhhdmUqIGFjdHVhbGx5IGZhaWxlZCB0byBhbGxvY2F0
ZSAKZnJvbSB0aGUgMzItYml0IHNwYWNlLCBtYXgzMl9hbGxvY19zaXplIHdpbGwgbWFrZSBzdWJz
ZXF1ZW50IGF0dGVtcHRzIApmYWlsIGltbWVkaWF0ZWx5LiBJbiBub24tc3RyaWN0IG1vZGUgeW91
J3JlIG1vc3QgbGlrZWx5IGZyZWVpbmcgMzItYml0IApJT1ZBcyBiYWNrIHRvIHRoZSB0cmVlIC0g
YW5kIHRodXMgcmVzZXQgbWF4MzJfYWxsb2Nfc2l6ZSAtIG11Y2ggbGVzcyAKb2Z0ZW4sIGFuZCB5
b3UnbGwgbWFrZSBtb3JlIHRvdGFsIHNwYWNlIGF2YWlsYWJsZSBlYWNoIHRpbWUsIGJvdGggb2Yg
CndoaWNoIHdpbGwgYW1vcnRpc2UgdGhlIGNvc3Qgb2YgZ2V0dGluZyBiYWNrIGludG8gdGhhdCBm
YWlsZWQgc3RhdGUgCmFnYWluLiBDb252ZXJzZWx5LCB0aGUgd29yc3QgY2FzZSBpbiBzdHJpY3Qg
bW9kZSBpcyB0byBoYXZlIG11bHRpcGxlIAp0aHJlYWRzIGdldHRpbmcgaW50byB0aGlzIHBhdGhv
bG9naWNhbCBjeWNsZToKCjE6IGFsbG9jYXRlLCBnZXQgbGFzdCBhdmFpbGFibGUgSU9WQQoyOiBh
bGxvY2F0ZSwgZmFpbCBhbmQgc2V0IG1heDMyX2FsbG9jX3NpemUKMzogZnJlZSBvbmUgSU9WQSwg
cmVzZXQgbWF4MzJfYWxsb2Nfc2l6ZSwgZ290byAxCgpOb3csIGdpdmVuIHRoZSBicm9rZW4gYmVo
YXZpb3VyIHdoZXJlIHRoZSBjYWNoZWQgUEZOIGNhbiBnZXQgc3R1Y2sgbmVhciAKdGhlIGJvdHRv
bSBvZiB0aGUgYWRkcmVzcyBzcGFjZSwgc3RlcCAyIG1pZ2h0IHdlbGwgaGF2ZSBiZWVuIGZhc3Rl
ciBhbmQgCm1vcmUgcHJlbWF0dXJlIHRoYW4gaXQgc2hvdWxkIGhhdmUsIGJ1dCBJIGhvcGUgeW91
IGNhbiBhcHByZWNpYXRlIHRoYXQgCnJlbHlpbmcgb24gYW4gYWxsb2NhdG9yIGJlaW5nIGJyb2tl
biBhdCBpdHMgZnVuZGFtZW50YWwgcHVycG9zZSBvZiAKYWxsb2NhdGluZyBpcyBub3QgYSBnb29k
IG9yIHN1c3RhaW5hYmxlIHRoaW5nIHRvIGRvLgoKV2hpbGUgbWF4MzJfYWxsb2Nfc2l6ZSBpbmRp
cmVjdGx5IHRyYWNrcyB0aGUgbGFyZ2VzdCAqY29udGlndW91cyogCmF2YWlsYWJsZSBzcGFjZSwg
b25lIG9mIHRoZSBpZGVhcyBmcm9tIHdoaWNoIGl0IGdyZXcgd2FzIHRvIHNpbXBseSBrZWVwIApj
b3VudCBvZiB0aGUgdG90YWwgbnVtYmVyIG9mIGZyZWUgUEZOcy4gSWYgeW91J3JlIHJlYWxseSBz
cGVuZGluZyAKc2lnbmlmaWNhbnQgdGltZSBkZXRlcm1pbmluZyB0aGF0IHRoZSB0cmVlIGlzIGZ1
bGwsIGFzIG9wcG9zZWQgdG8ganVzdCAKdGFraW5nIGxvbmdlciB0byBldmVudHVhbGx5IHN1Y2Nl
ZWQsIHRoZW4gaXQgbWlnaHQgYmUgcmVsYXRpdmVseSAKaW5ub2N1b3VzIHRvIHRhY2sgb24gdGhh
dCBzZW1pLXJlZHVuZGFudCBleHRyYSBhY2NvdW50aW5nIGFzIGEgCnNlbGYtY29udGFpbmVkIHF1
aWNrIGZpeCBmb3IgdGhhdCB3b3JzdCBjYXNlLgoKPiBBbnl3YXksIHdlIHNlZSB+NTAlIHRocm91
Z2hwdXQgcmVncmVzc2lvbiwgd2hpY2ggaXMgaW50b2xlcmFibGUuIEFzIHNlZW4gCj4gaW4gWzBd
LCBJIHB1dCB0aGlzIGRvd24gdG8gdGhlIGZhY3QgdGhhdCB3ZSBoYXZlIHNvIG1hbnkgSU9WQSBy
ZXF1ZXN0cyAKPiB3aGljaCBleGNlZWQgdGhlIHJjYWNoZSBzaXplIGxpbWl0LCB3aGljaCBtZWFu
cyBtYW55IFJCIHRyZWUgYWNjZXNzZXMgCj4gZm9yIG5vbi1jYWNoZWJsZSBJT1ZBcywgd2hpY2gg
YXJlIG5vdyBzbG93ZXIuCj4gCj4gT24gYW5vdGhlciBwb2ludCwgYXMgZm9yIGxvbmd0ZXJtIElP
VkEgYWdpbmcgaXNzdWUsIGl0IHNlZW1zIHRoYXQgdGhlcmUgCj4gaXMgbm8gY29uY2x1c2lvbiB0
aGVyZS4gSG93ZXZlciBJIGRpZCBtZW50aW9uIHRoZSBpc3N1ZSBvZiBJT1ZBIHNpemVzIAo+IGV4
Y2VlZGluZyByY2FjaGUgc2l6ZSBmb3IgdGhhdCBpc3N1ZSwgc28gbWF5YmUgd2UgY2FuIGZpbmQg
YSBjb21tb24gCj4gc29sdXRpb24uIFNpbWlsYXIgdG8gYSBmaXhlZCByY2FjaGUgZGVwb3Qgc2l6
ZSwgaXQgc2VlbXMgdGhhdCBoYXZpbmcgYSAKPiBmaXhlZCByY2FjaGUgbWF4IHNpemUgcmFuZ2Ug
dmFsdWUgKGF0IDYpIGRvZXNuJ3Qgc2NhbGUgZWl0aGVyLgoKV2VsbCwgSSdkIHNheSB0aGF0J3Mg
bW9yZSBvZiBhIHdvcmtsb2FkIHR1bmluZyB0aGluZyB0aGFuIGEgc2NhbGFiaWxpdHkgCm9uZSAt
IGEgbWFzc2l2ZSBzeXN0ZW0gd2l0aCBodW5kcmVkcyBvZiBDUFVzIHRoYXQgc3BlbmRzIGFsbCBk
YXkgCmZsaW5naW5nIDE1MDAtYnl0ZSBuZXR3b3JrIHBhY2tldHMgYXJvdW5kIGFzIGZhc3QgYXMg
aXQgY2FuIG1pZ2h0IGJlIApoYXBweSB3aXRoIGFuIGV2ZW4gc21hbGxlciB2YWx1ZSBhbmQgdXNp
bmcgdGhlIHNhdmVkIG1lbW9yeSBmb3IgCnNvbWV0aGluZyBlbHNlLiBJSVJDIHRoZSB2YWx1ZSBv
ZiA2IGlzIGEgZmFpcmx5IGFyYml0cmFyeSBjaG9pY2UgZm9yIGEgCnRyYWRlb2ZmIGJldHdlZW4g
ZXhwZWN0ZWQgdXRpbGl0eSBhbmQgbWVtb3J5IGNvbnN1bXB0aW9uLCBzbyBtYWtpbmcgaXQgYSAK
S2NvbmZpZyBvciBjb21tYW5kLWxpbmUgdHVuZWFibGUgZG9lcyBzZWVtIGxpa2UgYSBzZW5zaWJs
ZSB0aGluZyB0byBleHBsb3JlLgoKPiBBcyBmb3IgNGU4OWRjZTcyNTIxLCBzbyBldmVuIGlmIGl0
J3MgcHJvcGVyIHRvIHJldHJ5IGZvciBhIGZhaWxlZCBhbGxvYywgCj4gaXQgaXMgbm90IGFsd2F5
cyBuZWNlc3NhcnkuIEkgbWVhbiwgaWYgd2UncmUgbGltaXRpbmcgb3Vyc2VsdmVzIHRvIDMyYiAK
PiBzdWJzcGFjZSBmb3IgdGhpcyBTQUMgdHJpY2sgYW5kIHdlIGZhaWwgdGhlIGFsbG9jLCB0aGVu
IHdlIGNhbiB0cnkgdGhlIAo+IHNwYWNlIGFib3ZlIDMyYiBmaXJzdCAoaWYgdXNhYmxlKS4gSWYg
dGhhdCBmYWlscywgdGhlbiByZXRyeSB0aGVyZS4gSSAKPiBkb24ndCBzZWUgYSBuZWVkIHRvIHJl
dHJ5IHRoZSAzMmIgc3Vic3BhY2UgaWYgd2UncmUgbm90IGxpbWl0ZWQgdG8gaXQuIAo+IEhvdyBh
Ym91dCBpdD8gV2UgdHJpZWQgdGhhdCBpZGVhIGFuZCBpdCBsb29rcyB0byBqdXN0IGFib3V0IHJl
c3RvcmUgCj4gcGVyZm9ybWFuY2UuCgpUaGUgdGhpbmcgaXMsIGlmIHlvdSBkbyBoYXZlIGFuIGFj
dHVhbCBQQ0kgZGV2aWNlIHdoZXJlIERBQyBtaWdodCBtZWFuIGEgCjMzJSB0aHJvdWdocHV0IGxv
c3MgYW5kIHlvdSdyZSBtYXBwaW5nIGEgbG9uZy1saXZlZCBidWZmZXIsIG9yIHlvdSdyZSBvbiAK
b25lIG9mIHRoZXNlIHN5c3RlbXMgd2hlcmUgZmlybXdhcmUgZmFpbHMgdG8gZG9jdW1lbnQgYWRk
cmVzcyBsaW1pdHMgYW5kIAp1c2luZyB0aGUgZnVsbCBJT01NVSBhZGRyZXNzIHdpZHRoIHF1aWV0
bHkgYnJlYWtzIHRoaW5ncywgdGhlbiB5b3UgCmFsbW9zdCBjZXJ0YWlubHkgKmRvKiB3YW50IHRo
ZSBhbGxvY2F0b3IgdG8gYWN0dWFsbHkgZG8gYSBwcm9wZXIgam9iIG9mIAp0cnlpbmcgdG8gc2F0
aXNmeSB0aGUgZ2l2ZW4gcmVxdWVzdC4KCkZ1cnRoZXJtb3JlLCB3aGF0IHlvdSBwcm9wb3NlIGlz
IHN0aWxsIGZyYWdpbGUgZm9yIHlvdXIgb3duIHVzZS1jYXNlIAphbnl3YXkuIElmIHNvbWVvbmUg
bWFrZXMgaW50ZXJuYWwgY2hhbmdlcyB0byB0aGUgYWxsb2NhdG9yIC0gY29udmVydHMgaXQgCnRv
IGEgZGlmZmVyZW50IHRyZWUgc3RydWN0dXJlLCBpbXBsZW1lbnRzIHNwbGl0IGxvY2tpbmcgZm9y
IGNvbmN1cnJlbmN5LCAKdGhhdCBzb3J0IG9mIHRoaW5nIC0gYW5kIGl0IGZ1bmRhbWVudGFsbHkg
bG9zZXMgdGhlIGRvZGd5IGNhY2hlZDMyX25vZGUgCmJlaGF2aW91ciB3aGljaCBtYWtlcyB0aGUg
aW5pdGlhbCBmYWlsdXJlIHVuaW50ZW50aW9uYWxseSBmYXN0IGZvciB5b3VyIAp3b3JrbG9hZCdz
IGFsbG9jYXRpb24gcGF0dGVybiwgdGhhdCBleHRyYSBjb21wbGV4aXR5IHdpbGwgc3VkZGVubHkg
anVzdCAKYmUgZGVhZCB3ZWlnaHQgYW5kIHlvdSdsbCBwcm9iYWJseSBiZSBjb21wbGFpbmluZyBv
ZiBhIHBlcmZvcm1hbmNlIApyZWdyZXNzaW9uIGFnYWluLgoKV2UncmUgdGFsa2luZyBhYm91dCBh
biBhbGxvY2F0aW9uIHRoYXQgeW91IGtub3cgeW91IGRvbid0IG5lZWQgdG8gbWFrZSwgCmFuZCB0
aGF0IHlvdSBldmVuIGV4cGVjdCB0byBmYWlsLCBzbyBJIHN0aWxsIG1haW50YWluIHRoYXQgaXQn
cyBhYnN1cmQgCnRvIGZvY3VzIG9uIG9wdGltaXNpbmcgZm9yIGZhaWx1cmU7IGZvY3VzIG9uICpu
b3QgZXZlbiBkb2luZyBpdCBhdCBhbGwqLiAKSXQganVzdCBuZWVkcyBhbiBhcHByb2FjaCB0aGF0
J3Mgbm90IGdvaW5nIHRvIG1lc3MgdXAgdGhlIHVua25vd24gYnV0IAphcHBhcmVudGx5IG5vbnpl
cm8gbnVtYmVyIG9mIHN5c3RlbXMgaW5hZHZlcnRlbnRseSByZWx5aW5nIG9uIDMyLWJpdCAKSU9W
QXMgZm9yIGNvcnJlY3RuZXNzLgoKUm9iaW4uCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmlvbW11IG1haWxpbmcgbGlzdAppb21tdUBsaXN0cy5saW51eC1m
b3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pb21tdQ==
